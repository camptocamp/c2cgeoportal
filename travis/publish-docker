#!/bin/bash

docker login --username ${DOCKER_USERNAME} --password ${DOCKER_PASSWORD}

for IMAGE in geomapfish-build-dev geomapfish-commons geomapfish-build geomapfish-qgisserver
do
    if [ "${TRAVIS_TAG}" != "" ]
    then
        docker tag camptocamp/${IMAGE}:${MAJOR_VERSION} camptocamp/${IMAGE}:${TRAVIS_TAG}
        docker push camptocamp/${IMAGE}:${TRAVIS_TAG}
    elif [ "${TRAVIS_BRANCH}" != "master" ]
    then
        docker tag camptocamp/${IMAGE}:${MAJOR_VERSION} camptocamp/${IMAGE}:${TRAVIS_BRANCH/\//_}
        docker push camptocamp/${IMAGE}:${TRAVIS_BRANCH/\//_}
    else
        docker push camptocamp/${IMAGE}:${MAJOR_VERSION}
    fi
done
