
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Customizing the Application using Functionalities &#8212; c2cgeoportal  documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Digital Elevation Tools" href="raster.html" />
    <link rel="prev" title="Customise the application" href="customise.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="customizing-the-application-using-functionalities">
<span id="integrator-functionality"></span><h1>Customizing the Application using Functionalities<a class="headerlink" href="#customizing-the-application-using-functionalities" title="Permalink to this headline">¶</a></h1>
<p>c2cgeoportal provides the concept of <em>functionality</em> that can be used to customize
the application according to the user’s permissions.</p>
<p>A functionality may be associated to users through different ways:</p>
<ol class="arabic simple">
<li>Functionalities for anonymous users are defined through the
<code class="docutils literal"><span class="pre">functionalities:anonymous</span></code> variable in the <code class="docutils literal"><span class="pre">vars_&lt;project&gt;.yaml</span></code>
configuration file.</li>
<li>Functionalities for authenticated users are defined through the
<code class="docutils literal"><span class="pre">functionalities:registered</span></code> variable in the <code class="docutils literal"><span class="pre">vars_&lt;project&gt;.yaml</span></code>
configuration file.</li>
<li>Functionalities for specific roles are defined in the database through the
administration interface.</li>
<li>Functionalities for specific users are defined in the database through the
administration interface.</li>
</ol>
<p>Each level overrides the previous ones in the same order as indicated above.
For example, if the user is authenticated and has associated functionalities in
the <code class="docutils literal"><span class="pre">user</span></code> database table, then the <code class="docutils literal"><span class="pre">functionalities:anonymous</span></code> and
<code class="docutils literal"><span class="pre">functionalities:registered</span></code> configuration variables, as well as any
functionality associated with his/her role, will be ignored.</p>
<div class="section" id="configuration">
<span id="integrator-functionality-configuration"></span><h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">vars_&lt;project&gt;.yaml</span></code> file includes variables for managing <em>functionalities</em>.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">admin_interface</span></code>/<code class="docutils literal"><span class="pre">available_functionalities</span></code></dt>
<dd><p class="first">List of functionality types that should be available in the
administration interface (and added to the <code class="docutils literal"><span class="pre">functionality</span></code> table in the
database).</p>
<p>For example:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">admin_interface</span><span class="p">:</span>
    <span class="n">available_functionalities</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">default_basemap</span>
    <span class="o">-</span> <span class="n">print_template</span>
    <span class="o">-</span> <span class="n">mapserver_substitution</span>
</pre></div>
</div>
<p>The following syntax is also accepted:</p>
<div class="code yaml last highlight-default"><div class="highlight"><pre><span></span><span class="n">admin_interface</span><span class="p">:</span>
    <span class="n">available_functionalities</span><span class="p">:</span> <span class="p">[</span><span class="n">default_basemap</span><span class="p">,</span> <span class="n">print_template</span><span class="p">,</span> <span class="n">mapserver_substitution</span><span class="p">]</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">functionalities:anonymous</span></code></dt>
<dd><p class="first">Functionalities accessible to anonymous users. This is a list of
key/value pairs, whose values are either arrays or scalars.</p>
<p>For example:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">functionalities</span><span class="p">:</span>
    <span class="n">anonymous</span><span class="p">:</span>
        <span class="n">print_template</span><span class="p">:</span>
        <span class="o">-</span> <span class="mi">1</span> <span class="n">A4</span> <span class="n">portrait</span>
        <span class="o">-</span> <span class="mi">2</span> <span class="n">A3</span> <span class="n">landscape</span>
        <span class="n">default_basemap</span><span class="p">:</span> <span class="n">plan</span>
</pre></div>
</div>
<p class="last">In this example anonymous users can print maps using the <code class="docutils literal"><span class="pre">1</span> <span class="pre">A4</span> <span class="pre">portrait</span></code>
and <code class="docutils literal"><span class="pre">2</span> <span class="pre">A3</span> <span class="pre">landscape</span></code> layouts only. And their default base layer is the
<code class="docutils literal"><span class="pre">plan</span></code> layer.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">functionalities:registered</span></code></dt>
<dd>Functionalities accessible to any authenticated user. This is a list of
key/value pairs, of the same form as for <code class="docutils literal"><span class="pre">functionalities:anonymous</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">functionalities:available_in_templates</span></code></dt>
<dd><p class="first">Functionalities that are made available to Mako templates (e.g.
<code class="docutils literal"><span class="pre">viewer.js</span></code>) through the <code class="docutils literal"><span class="pre">functionality</span></code> template variable.</p>
<p>For example with:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">functionalities</span><span class="p">:</span>
    <span class="n">available_in_templates</span><span class="p">:</span>
    <span class="o">-</span> <span class="o">&lt;</span><span class="n">functionality_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p class="last">if a user is associated to, say,
<code class="docutils literal"><span class="pre">&lt;functionality_name&gt;</span></code>/<code class="docutils literal"><span class="pre">value1</span></code> and <code class="docutils literal"><span class="pre">&lt;functionality_name&gt;</span></code>/<code class="docutils literal"><span class="pre">value2</span></code>,
then the <code class="docutils literal"><span class="pre">functionality</span></code> template variable will be set to a dict with one
key/value pair: <code class="docutils literal"><span class="pre">&quot;&lt;functionality_name&gt;&quot;:</span> <span class="pre">[&quot;value1&quot;,&quot;value2&quot;]</span></code>.</p>
</dd>
</dl>
</div>
<div class="section" id="using-functionalities-in-templates">
<h2>Using Functionalities in Templates<a class="headerlink" href="#using-functionalities-in-templates" title="Permalink to this headline">¶</a></h2>
<p>As explained in the <a class="reference internal" href="#integrator-functionality-configuration"><span class="std std-ref">Configuration</span></a> section above,
a functionality can be used in the Mako templates as long as it has been
enabled using the <code class="docutils literal"><span class="pre">functionalities:available_in_templates</span></code> parameter in the
<code class="docutils literal"><span class="pre">vars_&lt;project&gt;.yaml</span></code> configuration file.</p>
<p>Functionalities may be used in templates for various purposes. The examples
below explain how to set the default basemap and how to limit access to some
plugins according to the user’s permissions.</p>
<div class="section" id="example-of-the-default-basemap-functionality">
<h3>Example of the default_basemap Functionality<a class="headerlink" href="#example-of-the-default-basemap-functionality" title="Permalink to this headline">¶</a></h3>
<p>Using functionalities, it is easy to set the default basemap that will be
displayed when a user loads the application depending on whether he/she is
anonymous, authenticated or has some specific role.</p>
<p>First make sure that <code class="docutils literal"><span class="pre">default_basemap</span></code> is made available in the templates
using the <code class="docutils literal"><span class="pre">functionalities:available_in_templates</span></code> parameter in the
<code class="docutils literal"><span class="pre">vars_&lt;project&gt;.yaml</span></code> configuration file:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">functionalities</span><span class="p">:</span>
    <span class="n">available_in_templates</span><span class="p">:</span> <span class="p">[</span><span class="n">default_basemap</span><span class="p">]</span>
</pre></div>
</div>
<p>Then indicate (still in <code class="docutils literal"><span class="pre">vars_&lt;project&gt;.yaml</span></code>) what default basemap should be used
for anonymous users:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">functionalities</span><span class="p">:</span>
    <span class="n">anonymous</span><span class="p">:</span>
        <span class="c1"># some other configs...</span>
        <span class="n">default_basemap</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">some_basemap</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Optionally you may also indicate what basemap to use for authenticated users
(if omitted, the anonymous <code class="docutils literal"><span class="pre">default_basemap</span></code> value will be used):</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">functionalities</span><span class="p">:</span>
    <span class="n">anonymous</span><span class="p">:</span>
        <span class="c1"># ...</span>
    <span class="n">registered</span><span class="p">:</span>
        <span class="n">default_basemap</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">some_other_basemap</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Finally you may link <code class="docutils literal"><span class="pre">default_basemap</span></code> functionalities to some roles or
users in the administration interface.</p>
<p>So that the <code class="docutils literal"><span class="pre">default_basemap</span></code> is actually provided to the
<code class="docutils literal"><span class="pre">cgxp_mapopacityslider</span></code> plugin, use the following configuration in your
project’s <code class="docutils literal"><span class="pre">viewer.js</span></code> template:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">ptype</span><span class="p">:</span> <span class="s2">&quot;cgxp_mapopacityslider&quot;</span><span class="p">,</span>
    <span class="n">defaultBaseLayerRef</span><span class="p">:</span> <span class="s2">&quot;${functionality[&#39;default_basemap&#39;][0] | n}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="limiting-access-to-some-cgxp-plugins-using-functionalities">
<h3>Limiting Access to some CGXP Plugins using Functionalities<a class="headerlink" href="#limiting-access-to-some-cgxp-plugins-using-functionalities" title="Permalink to this headline">¶</a></h3>
<p>Functionalities may also be used to enable some CGXP plugins only for users
with specific roles.</p>
<p>To do so, add <code class="docutils literal"><span class="pre">authorized_plugins</span></code> to the list of functionalities that must be
available in the administration interface and to the list of functionalities
provided to the templates. Set also <code class="docutils literal"><span class="pre">authorized_plugins</span></code> as an empty list for
anonymous users. In <code class="docutils literal"><span class="pre">vars_&lt;project&gt;.yaml</span></code>:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">admin_interface</span><span class="p">:</span>
    <span class="c1"># ...</span>
    <span class="n">available_functionalities</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">default_basemap</span>
        <span class="o">-</span> <span class="n">print_template</span>
        <span class="o">-</span> <span class="n">mapserver_substitution</span>
        <span class="o">-</span> <span class="n">authorized_plugins</span>

<span class="n">functionalities</span><span class="p">:</span>
    <span class="c1"># ...</span>
    <span class="n">anonymous</span><span class="p">:</span>
        <span class="c1"># ...</span>
        <span class="n">default_basemap</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">some_basemap</span><span class="o">&gt;</span>
        <span class="n">authorized_plugins</span><span class="p">:</span> <span class="p">[]</span>

    <span class="n">available_in_templates</span><span class="p">:</span> <span class="p">[</span><span class="n">default_basemap</span><span class="p">,</span> <span class="n">authorized_plugins</span><span class="p">]</span>
</pre></div>
</div>
<p>Then you may test in your project’s <code class="docutils literal"><span class="pre">viewer.js</span></code> template if the current user
has been granted access to some protected plugins:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">new</span> <span class="n">gxp</span><span class="o">.</span><span class="n">Viewer</span><span class="p">({</span>
    <span class="o">//</span> <span class="o">...</span>
    <span class="n">tools</span><span class="p">:</span> <span class="p">[{</span>
        <span class="o">//...</span>
    <span class="p">},</span>
    <span class="o">%</span> <span class="k">if</span> <span class="s1">&#39;&lt;some_protected_plugin&gt;&#39;</span> <span class="ow">in</span> <span class="n">functionality</span><span class="p">[</span><span class="s1">&#39;authorized_plugins&#39;</span><span class="p">]:</span>
    <span class="p">{</span>
        <span class="n">ptype</span><span class="p">:</span> <span class="o">...</span>
        <span class="o">//...</span>
    <span class="p">},</span>
    <span class="o">%</span> <span class="n">endif</span>
    <span class="p">{</span>
        <span class="o">//...</span>
    <span class="p">}]</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="using-functionalities-list-to-configure-the-layers-in-the-querybuilder">
<h3>Using Functionalities list to configure the layers in the QueryBuilder<a class="headerlink" href="#using-functionalities-list-to-configure-the-layers-in-the-querybuilder" title="Permalink to this headline">¶</a></h3>
<p>Add the new <code class="docutils literal"><span class="pre">querybuilder_layer</span></code> functionality to the list of
<code class="docutils literal"><span class="pre">available_functionalities</span></code> in your <code class="docutils literal"><span class="pre">vars_&lt;project&gt;.yaml</span></code> file:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">admin_interface</span><span class="p">:</span>
    <span class="n">available_functionalities</span><span class="p">:</span>
        <span class="o">...</span>
        <span class="o">-</span> <span class="n">querybuilder_layer</span>
</pre></div>
</div>
<p>Make sure that the <code class="docutils literal"><span class="pre">dumps</span></code> function is imported in
<code class="docutils literal"><span class="pre">&lt;package&gt;/templates/viewer.js</span></code> using:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;%</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="k">import</span> <span class="n">dumps</span>
<span class="o">%&gt;</span>
</pre></div>
</div>
<p>And configure your plugin like that:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span>{
    ptype: &quot;cgxp_querier&quot;,
    featureTypes: ${dumps(functionality[&#39;querybuilder_layer&#39;]) | n},
    ...
}
</pre></div>
</div>
<p>This way you may assign more than one layer per role using functionalities.</p>
</div>
<div class="section" id="using-functionalities-to-configure-the-basemap-to-use-for-each-theme">
<h3>Using Functionalities to configure the basemap to use for each theme<a class="headerlink" href="#using-functionalities-to-configure-the-basemap-to-use-for-each-theme" title="Permalink to this headline">¶</a></h3>
<p>A default basemap may be automatically loaded when the user selects a given
theme.</p>
<p>To do so make sure that the <code class="docutils literal"><span class="pre">MapOpacitySlider</span></code> plugin has a reference to the
layertree plugin. For instance:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">ptype</span><span class="p">:</span> <span class="s2">&quot;cgxp_mapopacityslider&quot;</span><span class="p">,</span>
    <span class="n">layerTreeId</span><span class="p">:</span> <span class="s2">&quot;layertree&quot;</span><span class="p">,</span>
    <span class="n">defaultBaseLayerRef</span><span class="p">:</span> <span class="s2">&quot;${functionality[&#39;default_basemap&#39;][0] | n}&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, in the administration interface, if not available yet, define a
<code class="docutils literal"><span class="pre">default_basemap</span></code> functionality containing the basemap reference. Edit the
theme and select the basemap to load in the <code class="docutils literal"><span class="pre">default_basemap</span></code> list. If
several <code class="docutils literal"><span class="pre">default_basemap</span></code> items are selected, only the first one will be
taken into account.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/camptocamp.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Customizing the Application using Functionalities</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#using-functionalities-in-templates">Using Functionalities in Templates</a><ul>
<li><a class="reference internal" href="#example-of-the-default-basemap-functionality">Example of the default_basemap Functionality</a></li>
<li><a class="reference internal" href="#limiting-access-to-some-cgxp-plugins-using-functionalities">Limiting Access to some CGXP Plugins using Functionalities</a></li>
<li><a class="reference internal" href="#using-functionalities-list-to-configure-the-layers-in-the-querybuilder">Using Functionalities list to configure the layers in the QueryBuilder</a></li>
<li><a class="reference internal" href="#using-functionalities-to-configure-the-basemap-to-use-for-each-theme">Using Functionalities to configure the basemap to use for each theme</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Integrator Guide</a><ul>
      <li>Previous: <a href="customise.html" title="previous chapter">Customise the application</a></li>
      <li>Next: <a href="raster.html" title="next chapter">Digital Elevation Tools</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/integrator/functionality.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2016, Camptocamp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/integrator/functionality.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/camptocamp/c2cgeoportal" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>