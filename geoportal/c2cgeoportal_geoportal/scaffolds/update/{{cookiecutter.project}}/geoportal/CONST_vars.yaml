---
vars:
  # The package name
  package: '{{cookiecutter.package}}'
  main_ogc_server: MapServer

  srid: EPSG:-1

  # Sqlalchemy schema
  schema: '{PGSCHEMA}'
  # Sqlalchemy static schema
  schema_static: '{PGSCHEMA_STATIC}'

  dbsessions: {}

  enable_admin_interface: True

  # Database information
  sqlalchemy:
    url: postgresql://{PGUSER}:{PGPASSWORD}@{PGHOST}:{PGPORT}/{PGDATABASE}?sslmode={PGSSLMODE}
    pool_recycle: '{SQLALCHEMY_POOL_RECYCLE}'
    pool_size: '{SQLALCHEMY_POOL_SIZE}'
    max_overflow: '{SQLALCHEMY_MAX_OVERFLOW}'
    executemany_mode: values_plus_batch
  sqlalchemy_slave:
    url: postgresql://{PGUSER}:{PGPASSWORD}@{PGHOST_SLAVE}:{PGPORT_SLAVE}/{PGDATABASE}?sslmode={PGSSLMODE}
    pool_recycle: '{SQLALCHEMY_SLAVE_POOL_RECYCLE}'
    pool_size: '{SQLALCHEMY_SLAVE_POOL_SIZE}'
    max_overflow: '{SQLALCHEMY_SLAVE_MAX_OVERFLOW}'
    executemany_mode: values_plus_batch

  # Session backend
  session:
    type: 'ext:redis'
    url: 'redis://{REDIS_HOST}:{REDIS_PORT}/{REDIS_DB}'

  # 10 days of default cache
  default_max_age: 864000

  authentication:
    two_factor: false
    two_factor_issuer_name: '{{cookiecutter.project}}'
    oauth2_token_expire_minutes: 60
    oauth2_authorization_expire_minutes: 10
    max_consecutive_failures: 10
    openid_connect:
      enabled: '{OPENID_CONNECT_ENABLED}'

  intranet:
    networks: []

  i18next:
    ns:
      - geomapfish
    defaultNS: geomapfish
    debug: false
    detection:
      order:
        - querystring
        - cookie
        - localStorage
        - sessionStorage
        - navigator
        - htmlTag
      lookupQuerystring: lang
      lookupCookie: i18next
      lookupLocalStorage: i18nextLng
      lookupSessionStorage: i18nextLng
      caches:
        - localStorage
      excludeCacheFor:
        - cimode
    fallbackLng: false
    interpolation:
      escapeValue: false
    backend: {}

  static_files:
    favicon.ico: /etc/geomapfish/static/images/favicon.ico
    robot.txt: /etc/geomapfish/static/robot.txt
    api.js: /etc/static-ngeo/api.js
    api.js.map: /etc/static-ngeo/api.js.map
    api.css: /etc/static-ngeo/api.css
    apihelp.html: /etc/geomapfish/static/apihelp/index.html

  interfaces_config:
    default:
      constants:
        gmfProjectionsOptions: &projections
          'EPSG:21781':
            definition:
              - +proj=somerc
              - +lat_0=46.95240555555556
              - +lon_0=7.439583333333333
              - +k_0=1
              - +x_0=600000
              - +y_0=200000
              - +ellps=bessel
              - +towgs84=674.374,15.056,405.346,0,0,0,0
              - +units=m
              - +no_defs
            extent: [420000, 30000, 900000, 350000]
          'EPSG:2056':
            definition:
              - +proj=somerc
              - +lat_0=46.95240555555556
              - +lon_0=7.439583333333333
              - +k_0=1
              - +x_0=2600000
              - +y_0=1200000
              - +ellps=bessel
              - +towgs84=674.374,15.056,405.346,0,0,0,0
              - +units=m
              - +no_defs
            extent: [2420000, 1030000, 2900000, 1350000]
        sentryOptions:
          dsn: '{SENTRY_URL}'
          release: '{SENTRY_CLIENT_RELEASE}'
          environment: '{SENTRY_CLIENT_ENVIRONMENT}'
          attachStacktrace: True
          tags:
            service: js
        gmfAuthenticationConfig:
          allowPasswordChange: true
          allowPasswordReset: true
        ngeoWfsPermalinkOptions:
          wfsTypes: []
          defaultFeatureNS: http://mapserver.gis.umn.edu/mapserver
          defaultFeaturePrefix: feature
          crosshairStyle:
            - regularShape:
                stroke:
                  color: white
                  width: 5
                points: 4
                radius: 10
                radius2: 0
                angle: 0
            - regularShape:
                stroke:
                  color: red
                  width: 2
                points: 4
                radius: 10
                radius2: 0
                angle: 0
        ngeoScaleSelectorOptions:
          values: [1000000, 500000, 200000, 100000, 50000, 20000, 10000, 5000, 2000, 1000, 500, 200]
          dropup: True
        ngeoStringToHtmlReplacements:
          # Hyperlink
          - expression: ^(https?:\/\/.+)$
            tags: gm
            template: <a target="_blank" href="$1">$1</a>
          # Mailto
          - expression: ^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\\\.[A-Z]{2,}$
            tags: gim
            template: <a href="mailto:$1">$1</a>
        ngeoTilesPreloadingLimit:
        ngeoUsedKeyRegexp:
          - .*
        ngeoQueryOptions:
          limit: 20
        ngeoMeasurePrecision: 3
        ngeoMeasureDecimals: 0
        ngeoMeasureSpherical: False
        gmfSnappingConfig: {}
        gmfSnappingOptions:
          maxFeatures: 50
        ngeoSnappingTolerance: 20
        gmfObjectEditingToolsOptions: {}
        gmfTreeManagerModeFlush: True
        gmfThemesOptions: {}
        ngeoPointfilter:
        gmfAuthenticationNoReloadRole:
        ngeoNominatimSearchDefaultParams: {}
        ngeoNominatimUrl: https://nominatim.openstreetmap.org/
        ngeoCsvEncoding: utf-8
        ngeoCsvExtension: .csv
        ngeoCsvIncludeHeader: True
        ngeoCsvQuote: '"'
        ngeoCsvSeparator: ','
        gmfCsvFilename: query-results.csv
        gmfDisplayQueryWindowOptions:
          featuresStyle: &featureStyle
            fill:
              color: [255, 170, 0, 0.6]
            stroke:
              color: [255, 170, 0, 1]
              width: 2
            zIndex: 10
            circle:
              fill:
                color: [255, 170, 0, 0.6]
              stroke:
                color: [255, 170, 0, 1]
                width: 2
              radius: 5
          selectedFeatureStyle: &selectedFeatureStyle
            fill:
              color: [255, 0, 0, 0.6]
            stroke:
              color: [255, 0, 0, 1]
              width: 2
            zIndex: 10
            circle:
              fill:
                color: [255, 0, 0, 0.6]
              stroke:
                color: [255, 0, 0, 1]
                width: 2
              radius: 5
        gmfLayerTreeOptions:
          openLinksInNewWindow: False
          isExpanded: False
          layerIcon:
            width: 20
            height: 20
        gmfDisclaimerOptions: {}
        gmfBackgroundLayerSelectorOptions: {}
        defaultTheme: Demo
        defaultLang: en
        gmfOptions: &gmfOptions
          map: {}
          view:
            srid: '{srid}'
            center: [2600000, 1200000]
            zoom: 3
            resolutions: [250, 100, 50, 20, 10, 5, 2, 1, 0.5, 0.25, 0.1, 0.05]
            extent: [2420000, 1030000, 2900000, 1350000]
            constrainRotation: false
            constrainResolution: true
        gmfSearchOptions:
          styles:
            default:
              fill:
                color: [65, 134, 240, 0.5]
              stroke:
                color: [65, 134, 240, 1]
                width: 2
              circle:
                fill:
                  color: [65, 134, 240, 0.5]
                stroke:
                  color: [65, 134, 240, 1]
                  width: 2
                radius: 5
            gmfCoordinatesLayerName:
              regularShape:
                stroke:
                  color: [0, 0, 0, 0.7]
                  width: 2
                points: 4
                radius: 8
                radius2: 0
                angle: 0
          datasources:
            - labelKey: label
              groupActions:
                - action: add_theme
                  title: Add a theme
                - action: add_group
                  title: Add a sub theme
                - action: add_layer
                  title: Add a layer
              projection: EPSG:{srid}
        gmfPermalinkOptions:
          crosshairStyle:
            - regularShape:
                stroke:
                  color: white
                  width: 5
                points: 4
                radius: 10
                radius2: 0
                angle: 0
            - regularShape:
                stroke:
                  color: red
                  width: 2
                points: 4
                radius: 10
                radius2: 0
                angle: 0
          crosshairEnabledByDefault: False
          useLocalStorage: False
          pointRecenterZoom:
        gmfElevationOptions:
          layers: []
          layersConfig: {}
        gmfVectorTilesOptions:
          projection: EPSG:{srid}
          tileGrid: {}
        ngeoGeolocationOptions:
          positionFeatureStyle:
            circle:
              radius: 6
              fill:
                color: rgba(230, 100, 100, 1)
              stroke:
                color: rgba(230, 40, 40, 1)
                width: 2
          accuracyFeatureStyle:
            fill:
              color: rgba(100, 100, 230, 0.3)
            stroke:
              color: rgba(40, 40, 230, 1)
              width: 2
          zoom:
          autoRotate: False
        gmfWMSSourceOptions:
          # The default value is 1.5 but it add a slight blur on the layer,
          # 1 is also possible but the application will do a getMap on all the pan.
          ratio: 2

      dynamic_constants:
        interface: interface
        cacheVersion: cache_version
        langUrls: lang_urls
        gmfI18nextConfiguration: i18next_configuration
        gmfTwoFactorAuth: two_factor
        gmfSearchGroups: fulltextsearch_groups
      static:
        angularLocaleScript:
          name: '/etc/static-ngeo/'
          append: angular-locale_{{'{{'}}locale{{'}}'}}.js
      routes:
        currentInterfaceUrl:
          currentInterface: True
        authenticationBaseUrl:
          name: base
        gmfOidcLoginUrl:
          name: oidc_login
        gmfLayersUrl:
          name: layers_root
        gmfRasterUrl:
          name: raster
        gmfShortenerCreateUrl:
          name: shortener_create
        ngeoPermalinkOgcserverUrl:
          name: mapserverproxy
          params:
            ogcserver: '{main_ogc_server}'
        fulltextsearchUrl:
          name: fulltextsearch
          params:
            limit: 30
            partitionlimit: 5
          dynamic_params:
            interface: interface
        gmfTreeUrl:
          name: themes
          params:
            background: background
          dynamic_params:
            interface: interface
        gmfVectorTilesUrl:
          name: vector_tiles_root
    desktop:
      extends: default
      redirect_interface: mobile
      do_redirect: True
      constants:
        gmfOptions: *gmfOptions
        ngeoProfileOptions: {}
        ngeoStreetviewOptions:
          viewer: 'mapillary'
        gmfPrintOptions:
          legend:
            # See:
            # https://www.mapserver.org/development/rfc/ms-rfc-101.html
            # https://docs.qgis.org/testing/en/docs/user_manual/working_with_ogc/server/services.html#getlegendgraphics
            useBbox: true
            label:
              qgis: false
            params:
              # See:
              # https://docs.qgis.org/testing/en/docs/user_manual/working_with_ogc/server/services.html#getlegendgraphics
              qgis:
                LAYERFONTFAMILY: DejaVu Sans
                ITEMFONTFAMILY: DejaVu Sans
                LAYERFONTSIZE: '10'
                ITEMFONTSIZE: '8'
          hiddenAttributes:
            - debug
            - timezone
            - username
        gmfDisplayQueryGridOptions:
          featuresStyle: *featureStyle
          selectedFeatureStyle: *selectedFeatureStyle
        gmfEditFeatureOptions:
          tolerance: 10
          closeAfterSave: false
          highlightStyle:
            circle:
              radius: 7
              fill:
                color: [255, 139, 139, 0.6]
              stroke:
                color: [255, 0, 0, 1]
                width: 3
            fill:
              color: [255, 139, 139, 0.6]
            stroke:
              color: [255, 0, 0, 1]
              width: 3
        gmfProfileOptions:
          linesConfiguration: {}
          hoverPointStyle:
            circle:
              fill:
                color: '#ffffff'
                radius: 3
        gmfShareOptions:
          enableEmail: True
        gmfFitOptions:
          # Padding (in pixels) to be correctly fitted inside the view. Values in the array are top, right, bottom and left padding.
          padding: [50, 10, 50, 50]
      routes:
        gmfProfileJsonUrl:
          name: profile.json
        gmfPrintUrl:
          name: printproxy

    mobile:
      extends: default
      redirect_interface: desktop
      constants:
        gmfOptions: *gmfOptions
        gmfMobileMeasureAreaOptions:
          precision: 2
          sketchStyle: &mobileMeasureStyle
            fill:
              color: rgba(255, 128, 128, 0.2)
            stroke:
              color: rgba(255, 0, 0, 0.5)
              lineDash: [10, 10]
              width: 2
            regularShape:
              stroke:
                color: rgba(0, 0, 0, 0.7)
                width: 2
              points: 4
              radius: 8
              radius2: 0
              angle: 0
        gmfMobileMeasureLengthOptions:
          precision: 2
          sketchStyle: *mobileMeasureStyle
        gmfMobileMeasurePointOptions:
          decimals: 0
          rasterLayers: []
          format: '{x}, {y}'
          sketchStyle:
            fill:
              color: rgba(255, 255, 255, 0.2)
            stroke:
              color: rgba(0, 0, 0, 0.5)
              lineDash: [10, 10]
              width: 2
            regularShape:
              stroke:
                color: rgba(0, 0, 0, 0.7)
                width: 2
              points: 4
              radius: 8
              radius2: 0
              angle: 0
        gmfFitOptions:
          # Padding (in pixels) to be correctly fitted inside the view. Values in the array are top, right, bottom and left padding.
          padding: [60, 60, 42, 10]

    iframe_api:
      extends: default
      constants:
        gmfOptions: *gmfOptions
        gmfSearchGroups: []
        gmfFitOptions:
          # Padding (in pixels) to be correctly fitted inside the view. Values in the array are top, right, bottom and left padding.
          padding: [20, 20, 20, 20]

    api:
      constants:
        projections: *projections
        # The projection of the map
        projection: EPSG:{srid}
      routes:
        themesUrl:
          name: themes
          params:
            background: background
          dynamic_params:
            interface: interface
        localeUrl:
          name: localejson
        searchUrl:
          name: fulltextsearch
          params:
            limit: 30
            partitionlimit: 5
          dynamic_params:
            interface: interface

  cache:
    std:
      backend: c2cgeoportal.hybridsentinel
      arguments: &redis-cache-arguments
        lock_timeout: '{REDIS_LOCK_TIMEOUT}' # seconds
        redis_expiration_time: '{REDIS_EXPIRATION_TIME}' # seconds
        distributed_lock: True
        thread_local_lock: False
        service_name: '{REDIS_SERVICENAME}'
        socket_timeout: '{REDIS_TIMEOUT}' # seconds
        db: 0
    obj:
      backend: dogpile.cache.memory
    ogc-server:
      backend: c2cgeoportal.hybridsentinel
      arguments: *redis-cache-arguments

  admin_interface:
    layer_tree_max_nodes: 1000

    exclude_pages:
      - layers-cog

    # The list of available variable names for the `Metadatas` form.
    available_metadata:
      # TreeItem
      - name: searchAlias
        type: list
        description: >
          Comma-separated list of search aliases (keywords) to be added to the tsearch.ts field for
          the specified tree item (theme, layer group or layer). The tree item will match when
          searching for any of these aliases.
        relevant_for:
          - treeitem
      - name: searchLabelPattern
        description: >
          Template string for the label of tree items in search results, for example:
          <code>{name} ({theme})</code>.
          Supported parameters:
          <ul>
            <li>name (name of the tree item)</li>
            <li>parent (parent of the item, may be a group, block or theme)</li>
            <li>block (name of the block to which the item belongs)</li>
            <li>theme (name of the theme to which the item belongs)</li>
          </ul>
        relevant_for:
          - treeitem
      # Layers group
      - name: exclusiveGroup
        type: boolean
        description: >
          Indicate that the group has mutually exclusive layers or groups, meaning only one can be activated
          at a time.
        relevant_for:
          - layergroup
      - name: isExpanded
        type: boolean
        description: >
          Indicates that the layer group should be expanded by default.
        relevant_for:
          - layergroup
      - name: printNativeAngle
        type: boolean
        description: >
          Indicate that the print should preserve symbol rotation.
        relevant_for:
          - layergroup
      # Layer
      - name: copyable
        type: boolean
        description: >
          Indicate that geometries from this data source can be copied to other data sources.
        relevant_for:
          - layer_wms
      - name: legend
        type: boolean
        description: >
          Indicates whether to display the legend for this layer.
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
      - name: isLegendExpanded
        type: boolean
        description: >
          Indicate that the legend should be expanded by default.
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
      - name: legendRule
        description: >
          The WMS <code>RULE</code> parameter used to display the icon in the layer tree. This is a
          "short version" of the <code>iconURL</code> metadata.
        relevant_for:
          - layer_wms
      - name: legendImage
        type: url
        description: >
          URL of the image to use as legend in the layer tree.
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
      - name: hiDPILegendImages
        type: json
        description: >
          URLs of hi-DPI images used to print the layer legend.
          JSON mapping object with DPI as key and URL as value.
          Note: URLs cannot use the config scheme.
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
      - name: iconUrl
        type: url
        description: >
          URL of the icon to display in the layer tree.
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
      - name: metadataUrl
        type: url
        description: >
          URL link to information about this layer.
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
          - layergroup
      - name: disclaimer
        translate: True
        description: >
          Disclaimer text for this element.
        relevant_for:
          - treeitem
      - name: isChecked
        type: boolean
        description: >
          Indicate that the layer is checked by default.
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
      - name: identifierAttributeField
        description: >
          Field to use as feature title in the display query window.
        relevant_for:
          - layer_wms
      - name: maxResolution
        type: float
        description: >
          Maximum resolution at which the layer is visible. On WMTS layers, affects
          the layertree node but not the layer itself.
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
      - name: minResolution
        type: float
        description: >
          Minimum resolution at which the layer is visible. On WMTS layers, affects
          the layertree node but not the layer itself.
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
      - name: opacity
        type: float
        description: >
          Layer opacity from <code>0</code> (invisible) to <code>1.0</code> (fully visible).
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
      - name: thumbnail
        type: url
        description: >
          Icon URL to display in the background selector.
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
      - name: timeAttribute
        description: >
          Name of the time attribute for WMS(-T) layers.
        relevant_for:
          - layer_wms
      - name: geotablePrimaryKey
        description: >
          Name of the primary key field used for editing.
        relevant_for:
          - layer_wms
      - name: lastUpdateDateColumn
        description: >
          Column to be automatically updated with the last modification date.
        relevant_for:
          - layer_wms
      - name: lastUpdateUserColumn
        description: >
          Column to be automatically updated with the user who made the last edit.
        relevant_for:
          - layer_wms
      - name: snappingConfig
        type: json
        description: >
          Snapping configuration for the layer. If defined (even if empty), the layer becomes
          snappable with snapping enabled by default. Set <code>activated</code> to <code>false</code>
          to disable default snapping. Example: <code>{"tolerance": 50, "edge": false}</code>.
        relevant_for:
          - layer_wms
      - name: geometryValidation
        type: boolean
        description: >
          Enable geometry validation according to layer type (point, line, polygon).
          For example, prevents creation of 2-point polygons.
        relevant_for:
          - layer_wms
      - name: customOpenLayersOptions
        type: json
        description: >
          Custom OpenLayers options for WMS layers.
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
      - name: editingAttributesOrder
        type: list
        description: >
          Specify the order of editable attributes in the edit interface.
        relevant_for:
          - layer_wms
      - name: editingEnumerations
        type: json
        description: >
          Specify value column and order column for enumeration relationships.
        relevant_for:
          - layer_wms
      - name: readonlyAttributes
        type: list
        description: >
          Comma separated list of attributes to make read-only in the editing form.
        relevant_for:
          - layer_wms
      - name: queryIconPosition
        type: list
        description: >
          Define query shape (bbox) padding values similar to CSS:
          <code>all</code> or <code>top-bottom, left-right</code> or <code>top, right-left, bottom</code>
          or <code>top, right, bottom, left</code>.
        relevant_for:
          - layer_wms
          - layer_wmts
          - layer_cog
      - name: editingSelectionAttribute
        description: >
          Field shown in selector tooltip to identify the layer when multiple layers are selected.
        relevant_for:
          - layer_wms
      # WMS
      - name: directedFilterAttributes
        type: list
        description: >
          Comma separated list of attributes names which should have rules already ready when using the
          filter tools.
        relevant_for:
          - layer_wms
      - name: enumeratedAttributes
        type: list
        description: >
          Comma separated list of attributes that have enumerated values (for filtering).
        relevant_for:
          - layer_wms
      - name: protectedAttributes
        type: list
        description: >
          For QGIS server: Comma separated list of protected attributes for use with the
          <code>allowed_attributes</code> functionality.
        relevant_for:
          - layer_wms
      # WMTS layers
      - name: ogcServer
        description: >
          The associated OGC server for WMTS layers, to be used with <code>wmsLayers</code>,
          <code>printLayers</code> or <code>queryLayers</code>.
        relevant_for:
          - layer_wmts
          - layer_cog
      - name: wmsLayers
        description: >
          Comma-separated list of WMS/WFS layers used instead of the WMTS layer for queries and printing.
          Requires <code>OGCServer</code> metadata with server name.
          See also <code>printLayers</code> and <code>queryLayers</code> for separate options.
        relevant_for:
          - layer_wmts
          - layer_cog
      - name: queryLayers
        description: >
          Comma-separated list or WFS layers used instead of the WMTS layer for queries.
          Requires <code>OGCServer</code> metadata with server name.
        relevant_for:
          - layer_wmts
          - layer_cog
      - name: printLayers
        description: >
          Comma-separated list of WMS layers used instead of the WMTS layer for printing.
          Improves print quality with native rotation and hi-DPI support.
          Requires <code>OGCServer</code> metadata with server name.
        relevant_for:
          - layer_wmts
          - layer_cog
      - name: maxQueryResolution
        type: float
        description: >
          Maximum resolution at which the layer is queryable.
        relevant_for:
          - layer_wmts
          - layer_cog
      - name: minQueryResolution
        type: float
        description: >
          Minimum resolution at which the layer is queryable.
        relevant_for:
          - layer_wmts
          - layer_cog
      - name: timeout
        type: float
        description: Fetch capabilities timeout in seconds (default <code>300</code>).
        relevant_for:
          - layer_wmts

    # The list of functionalities that can be configured
    # through the admin interface.
    available_functionalities:
      - name: default_basemap
        single: true
        description: >
          Background layer to load when this theme is selected.
        relevant_for:
          - theme
      - name: default_theme
        single: true
        description: >
          Theme to load when user logs in.
        relevant_for:
          - role
      - name: print_template
        description: >
          Grant access to specific print templates.
        relevant_for:
          - role
      - name: mapserver_substitution
        relevant_for:
          - role
        description: >
          MapServer variable substitution in mapfile.
          Documentation: https://camptocamp.github.io/c2cgeoportal/{{cookiecutter.geomapfish_main_version}}/administrator/mapfile.html?highlight=mapserver_substitution#variable-substitution
      - name: filterable_layers
        description: >
          Grant filtering access to specific layers.
        relevant_for:
          - role
      - name: preset_layer_filter
        single: true
        description: >
          Name of layer to pre-select in filter tool when loading application.
        relevant_for:
          - role
      - name: open_panel
        single: true
        description: >
          Name of panel to open when loading application.
        relevant_for:
          - role
      - name: allowed_attributes
        description: >
          For QGIS server: List of protected attributes (use with `protectedAttributes` metadata).
          Format: `<WMS layer name>:<attribute name>,<attribute name>,...`
        relevant_for:
          - role

  getitfixed:
    enabled: false

  functionalities:
    # Functionalities that are made available to Mako templates and loginuser.
    available_in_templates:
      - default_basemap
      - default_theme
      - filterable_layers
      - print_template
      - preset_layer_filter
      - open_panel

  urllogin: {}

  http_options:
    timeout: 300

  tinyowsproxy:
    # URL to internal TinyOWS instance
    tinyows_url: '{TINYOWS_URL}'
    ogc_server: '{main_ogc_server}'

    # If the `online_resource` url in the TinyOWS configuration is not set
    # to the TinyOWS proxy url (e.g. when the service is also used without
    # the proxy), the proxy can replace the original `online_resource`
    # url with the proxy url.
    # proxy_online_resource: {VISIBLE_WEB_PROTOCOL}://{VISIBLE_WEB_HOST}{VISIBLE_ENTRY_POINT}tinyows_proxy
    # online_resource: http://localhost{VISIBLE_ENTRY_POINT}tinyows
    #
    # When running a c2cgeoportal appl. in debug mode (with `make serve`)
    # the host has to be set explicitly in a vhost environment.
    # tinyows_host: {VISIBLE_WEB_HOST}

  api:
    ogc_server: '{main_ogc_server}'

  resourceproxy:
    # List of urls from which it is safe to load content
    targets: {}
    #   exempletargetname: https://www.camptocamp.com/?param1=%s&param2=%s

    # List of allowed headers
    allowed_headers:
      - Cache-Control
      - Content-Encoding
      - Content-Language
      - Content-Type
      - Date
      - ETag
      - Vary

  fulltextsearch:
    defaultlimit: 30
    maxlimit: 200
    languages:
      fr: french
      en: english
      de: german

  servers:
    internal: http://localhost/
    local: '{VISIBLE_WEB_PROTOCOL}://{VISIBLE_WEB_HOST}{VISIBLE_ENTRY_POINT}'
    mapserver: '{MAPSERVER_URL}'
    qgisserver: '{QGISSERVER_URL}'

  host_forward_host: []
  headers_whitelist: []
  headers_blacklist: []

  # The "raster web services" configuration. See the "raster"
  # chapter in the integrator documentation.
  raster: {}

  # the "vector tiles service" configuration. See the "vector tiles"
  # chapter in the integrator documentation.
  vector_tiles: {}

  # Used by enumeration in the query builder
  layers:
    geometry_validation: True

  # Used by reset_password and shortener to send emails
  smtp:
    ssl: false
    starttls: false

  # Used to send an email on password reset
  reset_password: {}

  # The shortener base configuration
  shortener:
    # The base of created URL
    base_url: '{VISIBLE_WEB_PROTOCOL}://{VISIBLE_WEB_HOST}{VISIBLE_ENTRY_POINT}s/'
    length: 4

  # Define whether the MapServer proxy should hide the OGC capabilities.
  hide_capabilities: false

  # For print proxy
  print_url: '{PRINT_URL}'
  print_get_redirect: false # if true, redirects (302) directly to the print to fetch the report

  devserver_url: http://{DEVSERVER_HOST}{VISIBLE_ENTRY_POINT}

  pdfreport:
    print_url: '{PRINT_URL}'

  lingva_extractor: {}

  content_security_policy_main_default_src_extra: ''
  # Google Maps uses map.google.com and map.googleapis.com
  # More info: https://developers.google.com/maps/documentation/javascript/content-security-policy?hl=fr#allowlist_csp
  # Google Analytics 4 uses googletagmanager.com
  # More info: https://developers.google.com/tag-platform/tag-manager/csp?hl=fr#google_analytics_4_google_analytics
  content_security_policy_main_script_src_extra: '
    https://*.google.com/
    https://*.googleapis.com/
    https://*.googletagmanager.com/'
  content_security_policy_main_style_src_extra: '
    https://fonts.googleapis.com/'
  content_security_policy_main_img_src_extra: '
    https://*.google-analytics.com/
    https://*.googletagmanager.com/'
  content_security_policy_main_connect_src_extra: '
    https://*.google-analytics.com/
    https://*.analytics.google.com/
    https://*.googletagmanager.com/'
  content_security_policy_main_default_src: "
    'self'
    https://*
    {content_security_policy_main_default_src_extra}"
  content_security_policy_main_script_src: "
    'self'
    'unsafe-inline'
    {content_security_policy_main_script_src_extra}"
  content_security_policy_main_style_src: "
    'self'
    'unsafe-inline'
    {content_security_policy_main_style_src_extra}"
  content_security_policy_main_img_src: '
    *
    data:
    {content_security_policy_main_img_src_extra}'
  content_security_policy_main_connect_src: '
    *
    {content_security_policy_main_connect_src_extra}'

  content_security_policy_admin_default_src_extra: ''
  content_security_policy_admin_script_src_extra: ''
  content_security_policy_admin_style_src_extra: ''
  content_security_policy_admin_img_src_extra: ''
  content_security_policy_admin_worker_src_extra: ''
  content_security_policy_admin_default_src: "
    'self'
    {content_security_policy_admin_default_src_extra}"
  content_security_policy_admin_script_src: "
    'self'
    'unsafe-inline'
    {content_security_policy_admin_script_src_extra}"
  content_security_policy_admin_style_src: "
    'self'
    'unsafe-inline'
    https://cdnjs.cloudflare.com/
    {content_security_policy_admin_style_src_extra}"
  content_security_policy_admin_img_src: '
    *
    data:
    {content_security_policy_admin_img_src_extra}'
  content_security_policy_admin_worker_src: "
    'self'
    blob:
    {content_security_policy_admin_worker_src_extra}"

  content_security_policy_apihelp_default_src_extra: ''
  content_security_policy_apihelp_script_src_extra: ''
  content_security_policy_apihelp_style_src_extra: ''
  content_security_policy_apihelp_img_src_extra: ''
  content_security_policy_apihelp_connect_src_extra: ''
  content_security_policy_apihelp_default_src: "
    'self'
    https://*
    {content_security_policy_apihelp_default_src_extra}"
  content_security_policy_apihelp_script_src: "
    'self'
    'unsafe-inline'
    'unsafe-eval'
    {content_security_policy_apihelp_script_src_extra}"
  content_security_policy_apihelp_style_src: "
    'self'
    'unsafe-inline'
    https://cdnjs.cloudflare.com/
    {content_security_policy_apihelp_style_src_extra}"
  content_security_policy_apihelp_img_src: '
    *
    data:
    {content_security_policy_apihelp_img_src_extra}'
  content_security_policy_apihelp_connect_src: '
    *
    {content_security_policy_apihelp_connect_src_extra}'

  content_security_policy_c2c_default_src_extra: ''
  content_security_policy_c2c_script_src_extra: ''
  content_security_policy_c2c_style_src_extra: ''
  content_security_policy_c2c_default_src: "
    'self'
    {content_security_policy_c2c_default_src_extra}"
  content_security_policy_c2c_script_src: "
    'unsafe-inline'
    {content_security_policy_c2c_script_src_extra}"
  content_security_policy_c2c_style_src: "
    'unsafe-inline'
    https://cdnjs.cloudflare.com/
    {content_security_policy_c2c_style_src_extra}"

  content_security_policy_iframe_api_frame_ancestors: "'self'"

  global_headers:
    - pattern: '^/admin/.*'
      headers: &c2cgeoform_headers
        X-Frame-Options: SAMEORIGIN
        X-Xss-Protection: 1; mode=block
        X-Content-Type-Options: nosniff
        Referrer-Policy: same-origin
        Strict-Transport-Security: max-age=31536000; includeSubDomains
        Content-Security-Policy: 'default-src {content_security_policy_admin_default_src};
          script-src {content_security_policy_admin_script_src};
          style-src {content_security_policy_admin_style_src};
          img-src {content_security_policy_admin_img_src};
          worker-src {content_security_policy_admin_worker_src}'
    - pattern: '^/getitfixed.*'
      headers: *c2cgeoform_headers
    - pattern: '^/static/.*'
      headers:
        Access-Control-Allow-Origin: '*'
        Access-Control-Allow-Headers: X-Requested-With, Content-Type
    - pattern: '^/static-ngeo/.*'
      headers:
        Access-Control-Allow-Origin: '*'
        Access-Control-Allow-Headers: X-Requested-With, Content-Type
    - pattern: '^/static-geomapfish/.*'
      headers:
        Access-Control-Allow-Origin: '*'
        Access-Control-Allow-Headers: X-Requested-With, Content-Type
    - pattern: '^/c2c$'
      headers: &c2c_headers
        Content-Security-Policy: 'default-src {content_security_policy_c2c_default_src};
          script-src {content_security_policy_c2c_script_src};
          style-src {content_security_policy_c2c_style_src};'
    - pattern: '^/c2c/.*'
      headers: *c2c_headers
    - pattern: '^/iframe_api(/theme/.*)?$'
      headers:
        Content-Security-Policy: 'default-src {content_security_policy_main_default_src};
          script-src {content_security_policy_main_script_src};
          style-src {content_security_policy_main_style_src};
          img-src {content_security_policy_main_img_src};
          connect-src {content_security_policy_main_connect_src};
          frame-ancestors {content_security_policy_iframe_api_frame_ancestors};'

  # Control the HTTP headers
  headers:
    dynamic: &header
      cache_control_max_age: 600 # 10 minutes
      cache_control_max_age_nocache: 10 # 10 seconds, to avoid too many call
      access_control_max_age: 600 # 10 minutes
      access_control_allow_origin:
        - '*'
    index:
      <<: *header
      headers: &sec_headers
        X-Frame-Options: SAMEORIGIN
        X-Xss-Protection: 1; mode=block
        X-Content-Type-Options: nosniff
        Referrer-Policy: origin
        Strict-Transport-Security: max-age=31536000; includeSubDomains
        Content-Security-Policy: 'default-src {content_security_policy_main_default_src};
          script-src {content_security_policy_main_script_src};
          style-src {content_security_policy_main_style_src};
          img-src {content_security_policy_main_img_src};
          connect-src {content_security_policy_main_connect_src}'
    api: *header
    apihelp:
      <<: *header
      headers:
        <<: *sec_headers
        Content-Security-Policy: 'default-src {content_security_policy_apihelp_default_src};
          script-src {content_security_policy_apihelp_script_src};
          style-src {content_security_policy_apihelp_style_src};
          img-src {content_security_policy_apihelp_img_src};
          connect-src {content_security_policy_apihelp_connect_src}'
    profile: *header
    raster: *header
    vector_tiles: *header
    error: *header
    themes: &auth_header
      cache_control_max_age: 600 # 10 minutes
      cache_control_max_age_nocache: 10 # 10 seconds, to avoid too many call
      access_control_max_age: 600 # 10 minutes
      access_control_allow_origin:
        - '{VISIBLE_WEB_PROTOCOL}://{VISIBLE_WEB_HOST}'
        - '*'
      headers:
        Strict-Transport-Security: max-age=31536000; includeSubDomains
    config: *auth_header
    print: *auth_header
    fulltextsearch: *auth_header
    mapserver: *auth_header
    tinyows: *auth_header
    layers:
      <<: *auth_header
      cache_control_max_age_nocache: 0 # to refresh issue in editing
    shortener: *auth_header
    login:
      <<: *auth_header
      access_control_allow_origin:
        - '{VISIBLE_WEB_PROTOCOL}://{VISIBLE_WEB_HOST}'

  # Checker configuration
  checker_ogc_server: MapServer
  checker:
    forward_host: False
    base_internal_url: http://localhost:8080
    fulltextsearch:
      disable: False
      level: 3
      search: text to search
    lang:
      level: 3
      files: [ngeo]
    phantomjs:
      disable: []
      routes:
        - name: desktop
          params:
            no_redirect: 'true'
          environment: &phantomjs-env
            HTTP_MAP:
              https://localhost:8484/tiles/: http://localhost:8080/tiles/
          level: 6
        - name: mobile
          params:
            no_redirect: 'true'
          environment: *phantomjs-env
          level: 6
        - name: iframe_api
          params:
            no_redirect: 'true'
          environment: *phantomjs-env
          level: 6
        - name: apihelp
          environment: *phantomjs-env
          level: 6
    routes:
      disable: []
      routes:
        - name: apijs
          level: 3
          params:
            version: '2'
        - name: printproxy_capabilities
          level: 3
        - name: mapserverproxy
          checker_name: mapserverproxy_wms
          params:
            SERVICE: WMS
            VERSION: 1.1.1
            REQUEST: GetCapabilities
            ogcserver: '{checker_ogc_server}'
          level: 3
        - name: mapserverproxy
          checker_name: mapserverproxy_wfs
          params:
            SERVICE: WFS
            VERSION: 1.1.0
            REQUEST: GetCapabilities
            ogcserver: '{checker_ogc_server}'
          level: 3
    themes:
      params:
        version: '2'
      level: 4
      interfaces: {}
    print:
      level: 5

  # Check collector configuration
  check_collector:
    hosts:
      - display: Main
        url: 'http://localhost:8080{VISIBLE_ENTRY_POINT}'
    max_level: 3
    level: 10

  # What web page is authorized to use the API
  authorized_referers: []

  metrics:
    memory_maps_rss: False
    memory_maps_size: False
    memory_cache: True
    memory_cache_all: False
    raster_data: False
    total_python_object_memory: True

  # Hooks that can be called at different moments in the life of the
  # application. The value is the full python name
  # (full.module.path.function_name) of the function to call
  hooks: {}
  #   after_settings: {{cookiecutter.package}}.after_settings_hook
  # Called just after the settings have been loaded. Allows to modify
  # the settings at runtime (they are constructed at build time).
  # The function receives one parameter: the settings object.

  # Statistics are disabled by default
  stats: {}

  # The c2cwsgiutils base path
  c2c:
    base_path: /c2c

  db_chooser:
    # List of {method path} regexes to force the usage of the master, even for GET and OPTIONS
    # This supersedes the slave list.
    master:
      - GET {VISIBLE_ENTRY_POINT}s/.* # The shortener updates the last_hit column on GET
      - GET {VISIBLE_ENTRY_POINT}oauth/login # The oauth2 login when we are already logged
    # List of {method path} regexes to force the usage of the slave
    slave:
      - \w+ {VISIBLE_ENTRY_POINT}printproxy/.* # The print proxy is never writing to the DB

runtime_environment:
  - name: VISIBLE_WEB_HOST
    default: localhost
  - name: VISIBLE_WEB_PROTOCOL
    default: https
  - name: VISIBLE_ENTRY_POINT
    default: /
  - PGHOST
  - PGHOST_SLAVE
  - name: PGPORT
    default: '5432'
  - name: PGPORT_SLAVE
    default: '5432'
  - PGUSER
  - PGPASSWORD
  - name: PGDATABASE
    default: geomapfish
  - name: PGSSLMODE
    default: prefer
  - name: PGSCHEMA
    default: main
  - name: PGSCHEMA_STATIC
    default: main_static
  - name: SQLALCHEMY_POOL_RECYCLE
    default: '30'
  - name: SQLALCHEMY_POOL_SIZE
    default: '5'
  - name: SQLALCHEMY_MAX_OVERFLOW
    default: '25'
  - name: SQLALCHEMY_SLAVE_POOL_RECYCLE
    default: '30'
  - name: SQLALCHEMY_SLAVE_POOL_SIZE
    default: '5'
  - name: SQLALCHEMY_SLAVE_MAX_OVERFLOW
    default: '25'
  - name: TINYOWS_URL
    default: http://tinyows:8080/
  - name: MAPSERVER_URL
    default: http://mapserver:8080/
  - name: QGISSERVER_URL
    default: http://qgisserver:8080/
  - name: PRINT_URL
    default: http://print:8080/print/
  - name: DEVSERVER_HOST
    default: webpack-dev-server:8080
  - name: REDIS_HOST
    default: redis
  - name: REDIS_PORT
    default: '6372'
  - name: REDIS_DB
    default: '0'
  - name: REDIS_SERVICENAME
    default: 'mymaster'
  - name: REDIS_TIMEOUT
    default: '30'
  - name: REDIS_LOCK_TIMEOUT
    default: '120' # Two minutes
  - name: REDIS_PASSWORD
    default: ''
  - name: REDIS_SSL
    default: 'false'
  - name: REDIS_EXPIRATION_TIME
    default: '86400' # One day
  - name: TILEGENERATION_SQS_QUEUE
    default: queue_name
  - name: TILEGENERATION_S3_BUCKET
    default: bucket_name
  - name: SENTRY_URL
    default: ''
  - name: SENTRY_CLIENT_RELEASE
    default: ''
  - name: SENTRY_CLIENT_ENVIRONMENT
    default: ''
  - name: OPENID_CONNECT_ENABLED
    default: 'false'

runtime_postprocess:
  - expression: int({})
    vars:
      - cache.std.arguments.lock_timeout
      - cache.std.arguments.redis_expiration_time
      - cache.std.arguments.socket_timeout
      - cache.std.arguments.db
      - cache.ogc-server.arguments.lock_timeout
      - cache.ogc-server.arguments.redis_expiration_time
      - cache.ogc-server.arguments.socket_timeout
      - cache.ogc-server.arguments.db
      - sqlalchemy\.pool_recycle
      - sqlalchemy\.pool_size
      - sqlalchemy\.max_overflow
      - sqlalchemy_slave\.pool_recycle
      - sqlalchemy_slave\.pool_size
      - sqlalchemy_slave\.max_overflow
      - authentication.max_consecutive_failures
      - authentication.oauth2_authorization_expire_minutes
      - authentication.oauth2_token_expire_minutes
      - headers.login.access_control_max_age
      - headers.login.cache_control_max_age
      - headers.login.cache_control_max_age_nocache
      - headers.index.access_control_max_age
      - headers.index.cache_control_max_age
      - headers.index.cache_control_max_age_nocache
      - headers.dynamic.access_control_max_age
      - headers.dynamic.cache_control_max_age
      - headers.dynamic.cache_control_max_age_nocache
      - headers.config.access_control_max_age
      - headers.config.cache_control_max_age
      - headers.config.cache_control_max_age_nocache
      - headers.api.access_control_max_age
      - headers.api.cache_control_max_age
      - headers.api.cache_control_max_age_nocache
      - headers.apihelp.access_control_max_age
      - headers.apihelp.cache_control_max_age
      - headers.apihelp.cache_control_max_age_nocache
      - headers.themes.access_control_max_age
      - headers.themes.cache_control_max_age
      - headers.themes.cache_control_max_age_nocache
      - headers.fulltextsearch.access_control_max_age
      - headers.fulltextsearch.cache_control_max_age
      - headers.fulltextsearch.cache_control_max_age_nocache
      - headers.mapserver.access_control_max_age
      - headers.mapserver.cache_control_max_age
      - headers.mapserver.cache_control_max_age_nocache
      - headers.tinyows.access_control_max_age
      - headers.tinyows.cache_control_max_age
      - headers.tinyows.cache_control_max_age_nocache
      - headers.layers.access_control_max_age
      - headers.layers.cache_control_max_age
      - headers.layers.cache_control_max_age_nocache
      - headers.print.access_control_max_age
      - headers.print.cache_control_max_age
      - headers.print.cache_control_max_age_nocache
      - headers.profile.access_control_max_age
      - headers.profile.cache_control_max_age
      - headers.profile.cache_control_max_age_nocache
      - headers.raster.access_control_max_age
      - headers.raster.cache_control_max_age
      - headers.raster.cache_control_max_age_nocache
      - headers.shortener.access_control_max_age
      - headers.shortener.cache_control_max_age
      - headers.shortener.cache_control_max_age_nocache
      - headers.error.access_control_max_age
      - headers.error.cache_control_max_age
      - headers.error.cache_control_max_age_nocache
      - shortener.length
      - checker.fulltextsearch.level
      - checker.lang.level
      - checker.print.level
      - checker.themes.level
      - check_collector.max_level
      - check_collector.level

  - expression: str({}).lower() in ("true", "yes", "1")
    vars:
      - authentication.two_factor
      - authentication.openid_connect.enabled
      - getitfixed.enabled
      - layers.geometry_validation
      - smtp.ssl
      - smtp.starttls
      - hide_capabilities
      - checker.forward_host
      - checker.fulltextsearch.disable
      - metrics.memory_maps_rss
      - metrics.memory_maps_size
      - metrics.memory_cache
      - metrics.memory_cache_all
      - metrics.raster_data
      - metrics.total_python_object_memory

no_interpreted:
  - admin_interface.available_functionalities[].description
  - admin_interface.available_metadata[].description
  - interfaces_config.default.static.angularLocaleScript.append
  - interfaces_config.default.constants.gmfMousePositionOptions.projections[].filter
  - interfaces_config.default.constants.gmfMobileMeasurePointOptions.format
  - interfaces_config.default.constants.ngeoStringToHtmlReplacements[].expression
  - interfaces_config.mobile.constants.gmfMousePositionOptions.projections[].filter
  - interfaces_config.mobile.constants.gmfMobileMeasurePointOptions.format
  - interfaces_config.mobile.constants.ngeoStringToHtmlReplacements[].expression
  - interfaces_config.desktop.constants.gmfMousePositionOptions.projections[].filter
  - interfaces_config.desktop.constants.gmfMobileMeasurePointOptions.format
  - interfaces_config.desktop.constants.ngeoStringToHtmlReplacements[].expression
