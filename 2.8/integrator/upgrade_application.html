
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Upgrading a GeoMapFish application &#8212; c2cgeoportal  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/c2c.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Project structure" href="structure.html" />
    <link rel="prev" title="Install an existing application" href="install_application.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="upgrading-a-geomapfish-application">
<span id="integrator-upgrade-application"></span><h1>Upgrading a GeoMapFish application<a class="headerlink" href="#upgrading-a-geomapfish-application" title="Permalink to this heading">¶</a></h1>
<section id="prepare-upgrade">
<h2>Prepare upgrade<a class="headerlink" href="#prepare-upgrade" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/camptocamp/c2cgeoportal/blob/2.8/geoportal/c2cgeoportal_geoportal/scaffolds/update/{{cookiecutter.project}}/CONST_CHANGELOG.txt">Read the ‘Information to know before starting the upgrade’ chapters in the changelog</a>.
If you are currently using an LTS (Long-term support) release, you should read all the chapters,
if you are using the previous version, only the first chapter is relevant.</p>
<p>Be sure that your <code class="docutils literal notranslate"><span class="pre">managed_files</span></code> list is up-to-date in your <code class="docutils literal notranslate"><span class="pre">project.yaml</span></code> file.</p>
<p>If you are not sure whether this list is up-to-date, you can perform an update up to step 7 on your
current version and see if some files get modified by the update process.
If the update process modified files which you do not want modified, then add these files to the
<code class="docutils literal notranslate"><span class="pre">managed_files</span></code> list.</p>
</section>
<section id="prepare-the-database">
<h2>Prepare the database<a class="headerlink" href="#prepare-the-database" title="Permalink to this heading">¶</a></h2>
<p>Clone the schema with e.g.:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SET</span><span class="w"> </span><span class="n">statement_timeout</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;600s&#39;</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">clone_schema</span><span class="p">(</span><span class="s1">&#39;main_&lt;old_version&gt;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;main_&lt;new_version&gt;&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">TRUE</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">clone_schema</span><span class="p">(</span><span class="s1">&#39;static_&lt;old_version&gt;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;static_&lt;new_version&gt;&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">TRUE</span><span class="p">);</span>
</pre></div>
</div>
<p>Update the <code class="docutils literal notranslate"><span class="pre">PGSCHEMA</span></code> and the <code class="docutils literal notranslate"><span class="pre">PGSCHEMA_STATIC</span></code> in your <code class="docutils literal notranslate"><span class="pre">env.project</span></code> file.</p>
</section>
<section id="from-a-version-prior-to-2-7-x">
<h2>From a version prior to 2.7.x<a class="headerlink" href="#from-a-version-prior-to-2-7-x" title="Permalink to this heading">¶</a></h2>
<p>Upgrade your project first to 2.7, as this is the current long-term release. Migration scripts and
instructions assume that your minimal version is the current long-term release.</p>
</section>
<section id="upgrade-the-project">
<h2>Upgrade the project<a class="headerlink" href="#upgrade-the-project" title="Permalink to this heading">¶</a></h2>
<p>Start the upgrade:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1">./build<span class="w"> </span>--upgrade<span class="w"> </span>&lt;version&gt;</span>
</pre></div></div><p>Then follow the instructions.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;version&gt;</span></code> can be <code class="docutils literal notranslate"><span class="pre">x.y.z.p</span></code> to target a stable version, or <code class="docutils literal notranslate"><span class="pre">master</span></code> to target the master branch.</p>
<p>If for some reason you need to debug what happens during the upgrade see: <a class="reference internal" href="../developer/debugging.html#upgrade-debugging"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="upgrade-the-database">
<h2>Upgrade the database<a class="headerlink" href="#upgrade-the-database" title="Permalink to this heading">¶</a></h2>
<p>The database will be automatically upgraded during the upgrade process.</p>
<p>To upgrade only the database you can use alembic directly.</p>
<p>The help:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>geoportal<span class="w"> </span>alembic<span class="w"> </span>--help</span>
</pre></div></div><p>Upgrade the main schema:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>geoportal<span class="w"> </span>alembic<span class="w"> </span>--name<span class="o">=</span>main<span class="w"> </span>upgrade<span class="w"> </span>head</span>
</pre></div></div><p>Upgrade the static schema:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>geoportal<span class="w"> </span>alembic<span class="w"> </span>--name<span class="o">=</span>static<span class="w"> </span>upgrade<span class="w"> </span>head</span>
</pre></div></div></section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/camptocamp.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">c2cgeoportal</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=camptocamp&repo=c2cgeoportal&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../administrator/index.html">Administrator Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Integrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Guide</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Integrator Guide</a><ul>
      <li>Previous: <a href="install_application.html" title="previous chapter">Install an existing application</a></li>
      <li>Next: <a href="structure.html" title="next chapter">Project structure</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2023, Camptocamp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/integrator/upgrade_application.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>