
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>HTTPS &#8212; c2cgeoportal  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="https">
<h1>HTTPS<a class="headerlink" href="#https" title="Permalink to this headline">¶</a></h1>
<p>If your application is accessed in HTTPS, you have to make sure that all URLs
generated by the application (CSS and Javascript files, images, MapServer
requests, etc.) use the HTTPS scheme as well. Otherwise the browser will
prompt “unsecure content” warnings.</p>
<p>There are two ways to manage this:</p>
<ul class="simple">
<li>application behind a proxy</li>
<li>application and SSL certificate on the same server</li>
</ul>
<div class="section" id="application-behind-a-proxy">
<h2>Application behind a proxy<a class="headerlink" href="#application-behind-a-proxy" title="Permalink to this headline">¶</a></h2>
<p>If the application is placed behind some proxy that removes the SSL encryption
(plain HTTP is used between the proxy and the server) then some specific
configuration is required both on the c2cgeoportal application, and on the
proxy:</p>
<ul>
<li><p class="first">The proxy should add a specific header to the requests. For example <code class="docutils literal notranslate"><span class="pre">X-Https</span>
<span class="pre">on</span></code> (<code class="docutils literal notranslate"><span class="pre">X-Https</span></code> is the header name, and <code class="docutils literal notranslate"><span class="pre">on</span></code> is the header value).</p>
</li>
<li><p class="first">To make c2cgeoportal generate HTTPS URLs when requests with this header are
received you will set the <cite>HTTPS</cite> environment variable by adding the
following in the <code class="docutils literal notranslate"><span class="pre">apache/wsgi.conf.mako</span></code> file in the <code class="docutils literal notranslate"><span class="pre">&lt;location</span> <span class="pre">...&gt;</span></code>
section, in our example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SetEnvIf</span>    <span class="n">X</span><span class="o">-</span><span class="n">Https</span> <span class="n">on</span> <span class="n">HTTPS</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</li>
</ul>
<p>In Mako templates, if you need to know what scheme is used, you may test the
value of <code class="docutils literal notranslate"><span class="pre">request.scheme</span></code>. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">WMTS_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
<span class="o">%</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s1">&#39;https&#39;</span><span class="p">:</span>
    <span class="n">url</span><span class="p">:</span> <span class="s1">&#39;https://my.wmts.server/&#39;</span>
<span class="o">%</span> <span class="k">else</span><span class="p">:</span>
    <span class="n">url</span><span class="p">:</span> <span class="s1">&#39;http://my.wmts.server/&#39;</span>
<span class="o">%</span> <span class="n">endif</span>
<span class="o">/*</span> <span class="o">...</span> <span class="o">*/</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="application-and-ssl-certificate-on-the-same-server">
<h2>Application and SSL certificate on the same server<a class="headerlink" href="#application-and-ssl-certificate-on-the-same-server" title="Permalink to this headline">¶</a></h2>
<p>If the SSL certificate and the application are located on the same server, all
requests will be redirect to https. So you should change the scheme to https
for all url except for some parameters that should always use http (actually
all request on localhost): <em>url</em> parameter in tilegeneration configuration.</p>
<p>If you apply ssl encryption on your application, you should take care of the
tiles url to use https scheme to avoid secure and insecure contents: change
<em>tiles_url</em> in the vars_xxx.yaml file.</p>
<p>Finally, you should redirect all http request to https scheme. On Camptocamp’s
server, this should be asked to our sysadmin team.</p>
<p>In case you load http external resources into your application, you should use
resourceproxy service as described below.</p>
</div>
<div class="section" id="loading-non-https-external-resources">
<h2>Loading non https external resources<a class="headerlink" href="#loading-non-https-external-resources" title="Permalink to this headline">¶</a></h2>
<p>If you want to load non https external resources in your https application, you
must use the resourceproxy service and add the list of hosts you want to access
in your project <cite>vars_&lt;project&gt;.yaml</cite> configuration file:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span>resourceproxy:
    # list of urls from which it is safe to load content
    targets:
      #exempletargetname: http://www.camptocamp.com/?param1=%s&amp;param2=%s
      rfinfo: http://www.rfinfo.vd.ch/rfinfo.php?no_commune=%s&amp;no_immeuble=%s
</pre></div>
</div>
<p>Then you can access resources by building urls using the following schema:
<code class="docutils literal notranslate"><span class="pre">http://&lt;host&gt;/wsgi/resourceproxy?target=&lt;targetname&gt;&amp;values=(&lt;valueparam1&gt;,...)</span></code>.</p>
<p>For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">http://geoportail.camptocamp.com/main/wsgi/resourceproxy?target=rfinfo&amp;values=(175,2633)</span></code></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/camptocamp.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">HTTPS</a><ul>
<li><a class="reference internal" href="#application-behind-a-proxy">Application behind a proxy</a></li>
<li><a class="reference internal" href="#application-and-ssl-certificate-on-the-same-server">Application and SSL certificate on the same server</a></li>
<li><a class="reference internal" href="#loading-non-https-external-resources">Loading non https external resources</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/integrator/https.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2018, Camptocamp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/integrator/https.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/camptocamp/c2cgeoportal" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>