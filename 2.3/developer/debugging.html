
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Debugging &#8212; c2cgeoportal  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Development procedure" href="development_procedure.html" />
    <link rel="prev" title="Cache management" href="cache.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="debugging">
<span id="developer-debugging"></span><h1>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h1>
<p>The goal of this document is to give some troubleshooting tips.</p>
<div class="section" id="webpack">
<h2>Webpack<a class="headerlink" href="#webpack" title="Permalink to this headline">¶</a></h2>
<p>For debugging purposes, it is better to have all the JavaScript and Style Sheets in separated, non-minified
files. To achieve this, you can simply use the sources maps, function activable in the browsers debugging
tool. And to have faster build you need to use the Webpack dev server; you can achieve this as follows.</p>
<p>Add in your makefile <code class="docutils literal notranslate"><span class="pre">&lt;user&gt;.mk</span></code> (Each developer should have a different port, e.g.: 8081):</p>
<div class="code makefile highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DEV_SERVER_PORT</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">dev</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">port</span><span class="o">&gt;</span>
</pre></div>
</div>
<pre class="highlight"><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1">make serve-&lt;interface&gt;</span>
</pre><p>Open in the browser an URL like: <code class="docutils literal notranslate"><span class="pre">https://&lt;host&gt;&lt;entry-point&gt;/dev/&lt;interface&gt;.html</span></code>.</p>
</div>
<div class="section" id="browser">
<h2>Browser<a class="headerlink" href="#browser" title="Permalink to this headline">¶</a></h2>
<p>Using a browser-integrated debugging tool usually available with the <code class="docutils literal notranslate"><span class="pre">F12</span></code> key.</p>
</div>
<div class="section" id="pyramid">
<h2>Pyramid<a class="headerlink" href="#pyramid" title="Permalink to this headline">¶</a></h2>
<p>If the <code class="docutils literal notranslate"><span class="pre">pyramid_debugtoolbar</span></code> is enabled the error is directly shown in the query that fails.</p>
</div>
<div class="section" id="mapserver">
<h2>Mapserver<a class="headerlink" href="#mapserver" title="Permalink to this headline">¶</a></h2>
<p>Sometime more information are available by using this command:</p>
<pre class="highlight"><span class="prompt1">shp2img -m &lt;mapfile&gt; -o test.png -e &lt;minx&gt; &lt;miny&gt; &lt;maxx&gt; &lt;maxy&gt; -s &lt;sizex&gt; &lt;sizey&gt; -l &lt;layers&gt;</span>
</pre><p>You may also activate MapServer’s debug mode and set environment variable of the MapServer container
<code class="docutils literal notranslate"><span class="pre">MS_DEBUGLEVEL</span></code> to <code class="docutils literal notranslate"><span class="pre">5</span></code> (most verbose level, default is 0).</p>
<p><a class="reference external" href="http://mapserver.org/optimization/debugging.html?highlight=debug#debug-levels">More information</a></p>
</div>
<div class="section" id="postgresql">
<h2>PostgreSQL<a class="headerlink" href="#postgresql" title="Permalink to this headline">¶</a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">/etc/postgresql/9.*/main/postgresql.conf</span></code> configuration file
you can set <code class="docutils literal notranslate"><span class="pre">log_statement</span></code> to <code class="docutils literal notranslate"><span class="pre">all</span></code> to see all the called statements.
This file must be edited using the <code class="docutils literal notranslate"><span class="pre">postgres</span></code> user.</p>
<p>Reloading PostgreSQL is required so that the new configuration is taken into
account:</p>
<pre class="highlight"><span class="prompt1">sudo /etc/init.d/postgres reload</span>
</pre><p>Logs are available in the <code class="docutils literal notranslate"><span class="pre">/var/log/postgresql/postgresql-9.*-main.log</span></code> file.</p>
</div>
<div class="section" id="makefile">
<h2>Makefile<a class="headerlink" href="#makefile" title="Permalink to this headline">¶</a></h2>
<p>To obtain additional debug messages, you can rebuild your project as follows:</p>
<pre class="highlight"><span class="prompt1"><span class="nv">DEBUG</span><span class="o">=</span>TRUE make ...</span>
</pre><p>Actually we display the running rule and why she is running (dependence update).</p>
</div>
<div class="section" id="docker">
<h2>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h2>
<div class="section" id="multiple-dev-on-one-server">
<h3>Multiple dev on one server<a class="headerlink" href="#multiple-dev-on-one-server" title="Permalink to this headline">¶</a></h3>
<p>When you want to run multiple instances on the same server you should:</p>
<ul class="simple">
<li>Use the global front</li>
<li>Use a different docker tag for each instance</li>
<li>Use a different project name for each instance</li>
</ul>
</div>
<div class="section" id="global-front">
<h3>Global front<a class="headerlink" href="#global-front" title="Permalink to this headline">¶</a></h3>
<p>The global front will offer a unique entry point on port 80 that provide the ‘main’ project on <cite>/</cite> and the
others on <cite>/&lt;project_name&gt;/</cite>.</p>
<p>Activate it in the vars:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">vars</span><span class="p">:</span>
  <span class="n">docker_global_front</span><span class="p">:</span> <span class="n">true</span>
</pre></div>
</div>
<p>Build the project:</p>
<pre class="highlight"><span class="prompt1">./docker-run make build</span>
</pre><p>Run the global front:</p>
<pre class="highlight"><span class="prompt1"><span class="o">(</span><span class="nb">cd</span> global-front<span class="p">;</span> docker-compose --project-name<span class="o">=</span>global up --build<span class="o">)</span></span>
</pre><p>And we should defined different instance name for the build:</p>
<pre class="highlight"><span class="prompt1"><span class="nv">INSTANCE</span><span class="o">=</span>&lt;name&gt; ./docker-run make build</span>
</pre></div>
<div class="section" id="use-a-different-docker-tag">
<h3>Use a different docker tag<a class="headerlink" href="#use-a-different-docker-tag" title="Permalink to this headline">¶</a></h3>
<p>Just define an environment variable in the build:</p>
<pre class="highlight"><span class="prompt1"><span class="nv">DOCKER_TAG</span><span class="o">=</span>&lt;tag&gt; ./docker-run make build</span>
</pre></div>
<div class="section" id="use-a-different-project-name">
<h3>Use a different project name<a class="headerlink" href="#use-a-different-project-name" title="Permalink to this headline">¶</a></h3>
<p>Define the project name when you run the Docker composition:</p>
<pre class="highlight"><span class="prompt1">docker-compose --project-name<span class="o">=</span>&lt;name&gt; ...</span>
</pre></div>
<div class="section" id="run-gunicorn-to-reload-on-modifications-of-python-files">
<h3>Run gunicorn to reload on modifications of Python files<a class="headerlink" href="#run-gunicorn-to-reload-on-modifications-of-python-files" title="Permalink to this headline">¶</a></h3>
<p>Add the following environment variable to the geoportal container:</p>
<p><code class="docutils literal notranslate"><span class="pre">GUNICORN_PARAMS=&quot;-b</span> <span class="pre">:80</span> <span class="pre">--worker-class</span> <span class="pre">gthread</span> <span class="pre">--threads</span> <span class="pre">1</span> <span class="pre">--workers</span> <span class="pre">1</span> <span class="pre">--reload&quot;</span></code></p>
</div>
<div class="section" id="do-a-graceful-restart-of-the-running-geoportal-container">
<h3>Do a graceful restart of the running geoportal container<a class="headerlink" href="#do-a-graceful-restart-of-the-running-geoportal-container" title="Permalink to this headline">¶</a></h3>
<pre class="highlight"><span class="prompt1">docker-compose <span class="nb">exec</span> geoportal bash</span>
<span class="prompt1"><span class="nb">kill</span> -s HUP <span class="sb">`</span>ps aux<span class="p">|</span>grep gunicorn<span class="p">|</span>head --lines<span class="o">=</span><span class="m">1</span><span class="p">|</span>awk <span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>  <span class="c1"># graceful</span></span>
</pre></div>
<div class="section" id="mount-c2cgeoportal-in-the-container">
<h3>Mount c2cgeoportal in the container<a class="headerlink" href="#mount-c2cgeoportal-in-the-container" title="Permalink to this headline">¶</a></h3>
<p>Add in the <code class="docutils literal notranslate"><span class="pre">docker-compose.yaml</span></code> file, in the <code class="docutils literal notranslate"><span class="pre">geoportal</span></code> service the following lines:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">services</span><span class="p">:</span>
  <span class="n">geoportal</span><span class="p">:</span>
    <span class="n">volumes</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">&lt;</span><span class="n">c2cgeoportal_git_root</span><span class="o">&gt;/</span><span class="n">geoportal</span><span class="o">/</span><span class="n">c2cgeoportal_commons</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">c2cgeoportal_geoportal</span><span class="o">/</span><span class="n">c2cgeoportal_commons</span>
      <span class="o">-</span> <span class="o">&lt;</span><span class="n">c2cgeoportal_git_root</span><span class="o">&gt;/</span><span class="n">geoportal</span><span class="o">/</span><span class="n">c2cgeoportal_geoportal</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">c2cgeoportal_geoportal</span><span class="o">/</span><span class="n">c2cgeoportal_geoportal</span>
      <span class="o">-</span> <span class="o">&lt;</span><span class="n">c2cgeoportal_git_root</span><span class="o">&gt;/</span><span class="n">geoportal</span><span class="o">/</span><span class="n">c2cgeoportal_admin</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">c2cgeoportal_geoportal</span><span class="o">/</span><span class="n">c2cgeoportal_admin</span>
</pre></div>
</div>
</div>
<div class="section" id="expose-a-service">
<h3>Expose a service<a class="headerlink" href="#expose-a-service" title="Permalink to this headline">¶</a></h3>
<p>To expose a service out of the Docker composition you can add a port for the service in the vars, e.g.:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">vars</span><span class="p">:</span>
  <span class="n">docker_services</span><span class="p">:</span>
    <span class="o">&lt;</span><span class="n">service</span><span class="o">&gt;</span><span class="p">:</span>
      <span class="n">port</span><span class="p">:</span> <span class="mi">8086</span>
</pre></div>
</div>
<p>Be careful one port can be open only one time on a server.
Within the Docker composition you can access a port of a container, you can achieve this via curl.
This way, you do not need to publish this port on the main host.</p>
<pre class="highlight"><span class="prompt1">docker-compose <span class="nb">exec</span> geoportal bash</span>
<span class="prompt1">curl <span class="s2">&quot;&lt;url&gt;&quot;</span></span>
</pre></div>
<div class="section" id="use-webpack-dev-server">
<h3>Use Webpack dev server<a class="headerlink" href="#use-webpack-dev-server" title="Permalink to this headline">¶</a></h3>
<p>In the file <code class="docutils literal notranslate"><span class="pre">docker-compose-dev.yaml</span></code> set the <code class="docutils literal notranslate"><span class="pre">INTERFACE</span></code> to the wanted value.</p>
<p>Run:</p>
<pre class="highlight"><span class="prompt1">docker-compose --file<span class="o">=</span>docker-compose.yaml --file<span class="o">=</span>docker-compose-dev.yaml up</span>
</pre><p>Open the application with on the following path: <code class="docutils literal notranslate"><span class="pre">https://&lt;host&gt;/&lt;entry_point&gt;/dev/&lt;interface&gt;.html</span></code>.</p>
</div>
</div>
<div class="section" id="performance-or-network-error">
<h2>Performance or network error<a class="headerlink" href="#performance-or-network-error" title="Permalink to this headline">¶</a></h2>
<p>For performance and proxy issues make sure that all internal URLs in the config file
use localhost (use <code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">&quot;http://localhost/&lt;path&gt;&quot;</span> <span class="pre">-H</span> <span class="pre">Host:&lt;server_name&gt;</span></code>
to test it).</p>
<div class="section" id="tilecloud-chain">
<h3>Tilecloud chain<a class="headerlink" href="#tilecloud-chain" title="Permalink to this headline">¶</a></h3>
<p>Points to check with TileCloud chain:</p>
<ul class="simple">
<li>Disabling metatiles should be avoided.</li>
<li>Make sure that <code class="docutils literal notranslate"><span class="pre">empty_metatile_detection</span></code> and <code class="docutils literal notranslate"><span class="pre">empty_tile_detection</span></code> are configured correctly.</li>
<li>Make sure to not generate tiles with a higher resolution than in the raster sources.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/camptocamp.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Debugging</a><ul>
<li><a class="reference internal" href="#webpack">Webpack</a></li>
<li><a class="reference internal" href="#browser">Browser</a></li>
<li><a class="reference internal" href="#pyramid">Pyramid</a></li>
<li><a class="reference internal" href="#mapserver">Mapserver</a></li>
<li><a class="reference internal" href="#postgresql">PostgreSQL</a></li>
<li><a class="reference internal" href="#makefile">Makefile</a></li>
<li><a class="reference internal" href="#docker">Docker</a><ul>
<li><a class="reference internal" href="#multiple-dev-on-one-server">Multiple dev on one server</a></li>
<li><a class="reference internal" href="#global-front">Global front</a></li>
<li><a class="reference internal" href="#use-a-different-docker-tag">Use a different docker tag</a></li>
<li><a class="reference internal" href="#use-a-different-project-name">Use a different project name</a></li>
<li><a class="reference internal" href="#run-gunicorn-to-reload-on-modifications-of-python-files">Run gunicorn to reload on modifications of Python files</a></li>
<li><a class="reference internal" href="#do-a-graceful-restart-of-the-running-geoportal-container">Do a graceful restart of the running geoportal container</a></li>
<li><a class="reference internal" href="#mount-c2cgeoportal-in-the-container">Mount c2cgeoportal in the container</a></li>
<li><a class="reference internal" href="#expose-a-service">Expose a service</a></li>
<li><a class="reference internal" href="#use-webpack-dev-server">Use Webpack dev server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-or-network-error">Performance or network error</a><ul>
<li><a class="reference internal" href="#tilecloud-chain">Tilecloud chain</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Developer Guide</a><ul>
      <li>Previous: <a href="cache.html" title="previous chapter">Cache management</a></li>
      <li>Next: <a href="development_procedure.html" title="next chapter">Development procedure</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/developer/debugging.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2018, Camptocamp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/developer/debugging.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/camptocamp/c2cgeoportal" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>