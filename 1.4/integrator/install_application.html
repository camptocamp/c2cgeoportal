

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Install an existing application &mdash; c2cgeoportal  documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="c2cgeoportal  documentation" href="../index.html" />
    <link rel="up" title="Integrator Guide" href="index.html" />
    <link rel="next" title="Additional features" href="features.html" />
    <link rel="prev" title="Create a new application" href="create_application.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="features.html" title="Additional features"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="create_application.html" title="Create a new application"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">c2cgeoportal  documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Integrator Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="install-an-existing-application">
<span id="integrator-install-application"></span><h1>Install an existing application<a class="headerlink" href="#install-an-existing-application" title="Permalink to this headline">¶</a></h1>
<p>On this page we explain all the procedures to build an application from
only the code.</p>
<p>For example If you want to use an existing database you should ignore
all the commands concerning the database.</p>
<dl class="docutils">
<dt>This guide considers that:</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>We use a server manages by Camptocamp, meaning:</dt>
<dd><ul class="first last simple">
<li>all dependencies described in the
<a class="reference internal" href="#integrator-install-application-system-requirement"><em>system requirements</em></a>
section are installed</li>
<li>Postgres has a gis template &#8216;template_postgis&#8217; and a user &#8216;www-data&#8217;</li>
<li>Apache use the user &#8216;www-data&#8217;</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">We use Git as revision control</p>
</li>
<li><p class="first">We use a version of <tt class="docutils literal"><span class="pre">c2cgeoportal</span></tt> &gt;= 0.7</p>
</li>
</ul>
</dd>
</dl>
<p>For the others system there is some notes to give some help.</p>
<div class="section" id="system-requirements">
<span id="integrator-install-application-system-requirement"></span><h2>System requirements<a class="headerlink" href="#system-requirements" title="Permalink to this headline">¶</a></h2>
<p>To install a c2cgeoportal application you need to have the following installed
on your system:</p>
<ul>
<li><dl class="first docutils">
<dt>Git (or whatever revision control (for example Subversion)</dt>
<dd><p class="first last">is used for the application)</p>
</dd>
</dl>
</li>
<li><p class="first">Python 2.6, 2.7 (2.5 or 3.x are not supported)</p>
</li>
<li><p class="first">Oracle Java SE Development Kit 6 or 7</p>
</li>
<li><p class="first">Tomcat</p>
</li>
<li><p class="first">Apache</p>
</li>
<li><dl class="first docutils">
<dt>PostgreSQL &gt;= 9.1/PostGIS 1.5.3 (PostgreSQL 8.x and 9.0 should work but some adaptations</dt>
<dd><p class="first last">are required)</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>MapServer 6.0.x (MapServer 6.0.0 and 6.0.1 have some issue in WFS, not all versions</dt>
<dd><p class="first last">&gt;= 6.2 are compatible)</p>
</dd>
</dl>
</li>
<li><p class="first">ImageMagick</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Additional notes for Windows users:</p>
<blockquote class="last">
<div><p>For Subversion install <a class="reference external" href="http://tortoisesvn.net">Tortoises SVN</a>.</p>
<p>For Git look at GitHub&#8217;s <a class="reference external" href="http://help.github.com/win-set-up-git/">Set Up Git page</a>. You won&#8217;t need to set up SSH
keys, so you only need to follow the first section of this page.</p>
<p>Once Git is installed use Git Bash for all the shell commands provided in
this documentation. You&#8217;ll need to make sure the Turtoise, Python, and Java
folders are defined in your system <tt class="docutils literal"><span class="pre">PATH</span></tt>. For example if you have Python installed under
<tt class="docutils literal"><span class="pre">C:\Python26</span></tt> you can use <tt class="docutils literal"><span class="pre">export</span> <span class="pre">PATH=$PATH:/c/Python26</span></tt> to add Python
to your <tt class="docutils literal"><span class="pre">PATH</span></tt>.</p>
<p>You need to install the <tt class="docutils literal"><span class="pre">psycopg2</span></tt> Python package in the main Python
environment (e.g. <tt class="docutils literal"><span class="pre">C:\Python26</span></tt>). Use an installer (<tt class="docutils literal"><span class="pre">.exe</span></tt>) from the
<a class="reference external" href="http://www.stickpeople.com/projects/python/win-psycopg/">Stickpeople Project</a>.</p>
<p>When you download and configure Apache be sure that modules <tt class="docutils literal"><span class="pre">header_module</span></tt>,
<tt class="docutils literal"><span class="pre">expire_module</span></tt> and <tt class="docutils literal"><span class="pre">rewrite_module</span></tt> are uncommented. You must also download
and add modules <tt class="docutils literal"><span class="pre">mod_wsgi</span></tt> (<a class="reference external" href="http://modwsgi.readthedocs.org/">http://modwsgi.readthedocs.org/</a>) and <tt class="docutils literal"><span class="pre">mod_fcgid</span></tt>
(<a class="reference external" href="https://httpd.apache.org/mod_fcgid/">https://httpd.apache.org/mod_fcgid/</a>).</p>
</div></blockquote>
</div>
</div>
<div class="section" id="set-up-the-database">
<h2>Set up the database<a class="headerlink" href="#set-up-the-database" title="Permalink to this headline">¶</a></h2>
<p>Any c2cgeoportal application requires a PostgreSQL/PostGIS database. The
application works with its own tables, which store users, layers, etc. These
tables are located in a specific schema of the database.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Multiple specific schemas are actually used in a parent/child architecture.</p>
</div>
<p>If the application has MapServer layers linked to PostGIS tables, these tables
and the application-specific tables must be in the same database, preferably in
separate schemas. This is required for layer access control (<em>restricted
layers</em>), where joining user/role tables to PostGIS layer tables is necessary.</p>
<div class="section" id="create-the-database">
<h3>Create the database<a class="headerlink" href="#create-the-database" title="Permalink to this headline">¶</a></h3>
<p>To create the database you can use:</p>
<div class="highlight-python"><pre>$ sudo -u postgres createdb &lt;db_name&gt; -T template_postgis</pre>
</div>
<p>with <tt class="docutils literal"><span class="pre">&lt;db_name&gt;</span></tt> replaced by the actual database name.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>if you don&#8217;t have the template_postgis you can use:</p>
<div class="highlight-python"><pre>sudo -u postgres createdb -E UTF8 -T template0 &lt;db_name&gt;
sudo -u postgres psql -d &lt;db_name&gt; -f /usr/share/postgresql/9.1/contrib/postgis-1.5/postgis.sql
sudo -u postgres psql -d &lt;db_name&gt; -f /usr/share/postgresql/9.1/contrib/postgis-1.5/spatial_ref_sys.sql</pre>
</div>
<p class="last">Note that the path of the postgis scripts and the template name can
differ on your host.</p>
</div>
</div>
<div class="section" id="create-the-schema">
<span id="integrator-install-application-create-schema"></span><h3>Create the schema<a class="headerlink" href="#create-the-schema" title="Permalink to this headline">¶</a></h3>
<p>Each parent or child needs two application-specific schemas,
then to create it use:</p>
<div class="highlight-python"><pre>sudo -u postgres psql -c "CREATE SCHEMA &lt;schema_name&gt;;" &lt;db_name&gt;
sudo -u postgres psql -c "CREATE SCHEMA &lt;schema_name&gt;_static;" &lt;db_name&gt;</pre>
</div>
<p>with <tt class="docutils literal"><span class="pre">&lt;db_name&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;schema_name&gt;</span></tt> replaced by the actual database name,
and schema name (&#8216;main&#8217; by default), respectively.</p>
</div>
<div class="section" id="create-a-database-user">
<span id="integrator-install-application-create-user"></span><h3>Create a database user<a class="headerlink" href="#create-a-database-user" title="Permalink to this headline">¶</a></h3>
<p>We use a specific user for the application, <tt class="docutils literal"><span class="pre">www-data</span></tt> by default.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It the user doesn&#8217;t already exist in your database, create it first:</p>
<div class="last highlight-python"><pre>sudo -u postgres createuser -P &lt;db_user&gt;
sudo -u postgres psql -c 'GRANT SELECT ON TABLE spatial_ref_sys TO &lt;db_user&gt;' &lt;db_name&gt;
sudo -u postgres psql -c 'GRANT ALL ON TABLE geometry_columns TO &lt;db_user&gt;' &lt;db_name&gt;</pre>
</div>
</div>
<p>Give the rights to the user:</p>
<div class="highlight-python"><pre>sudo -u postgres psql -c 'GRANT ALL ON SCHEMA &lt;schema_name&gt; TO "www-data"' &lt;db_name&gt;
sudo -u postgres psql -c 'GRANT ALL ON SCHEMA &lt;schema_name&gt;_static TO "www-data"' &lt;db_name&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you don&#8217;t use the www-data user for Apache replace it by the right user.</p>
</div>
</div>
</div>
<div class="section" id="install-the-application">
<h2>Install the application<a class="headerlink" href="#install-the-application" title="Permalink to this headline">¶</a></h2>
<div class="section" id="get-the-application-source-tree">
<h3>Get the application source tree<a class="headerlink" href="#get-the-application-source-tree" title="Permalink to this headline">¶</a></h3>
<p>If Git is used for the application use the following command to get the
application source tree:</p>
<div class="highlight-python"><pre>git clone git@github.com:camptocamp/&lt;my_project&gt;.git &lt;my_project&gt;</pre>
</div>
<p>c2cgeoportal applications include a Git submodule for CGXP. The following
commands should be used to download CGXP and its dependencies:</p>
<div class="highlight-python"><pre>cd &lt;my_project&gt;
git submodule update --init
git submodule foreach git submodule update --init</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">foreach</span></tt> command aims to init and update CGXP&#8217;s own submodules, for GXP,
OpenLayers and GeoExt.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We don&#8217;t just use <tt class="docutils literal"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span> <span class="pre">--init</span> <span class="pre">--recursive</span></tt> here because
that would also download GXP&#8217;s submodules. We don&#8217;t want that because we
don&#8217;t need GXP&#8217;s submodules. CGXP indeed has its own submodules for
OpenLayers and GeoExt.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">If you want other people than you to be able to run <tt class="docutils literal"><span class="pre">buildout</span></tt> from an
application clone created by you then you need to change the application
directory&#8217;s permissions using <tt class="docutils literal"><span class="pre">chmod</span> <span class="pre">-R</span> <span class="pre">g+w</span></tt>.  You certainly want to do
that if the application has been cloned in a shared directory like
<tt class="docutils literal"><span class="pre">/var/www/&lt;vhost&gt;/private</span></tt>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you still use SVN:</p>
<div class="last highlight-python"><pre>svn co https://project.camptocamp.com/svn/&lt;my_project&gt;/trunk &lt;my_project&gt;</pre>
</div>
</div>
</div>
<div class="section" id="windows-specific-configuration">
<h3>Windows Specific Configuration<a class="headerlink" href="#windows-specific-configuration" title="Permalink to this headline">¶</a></h3>
<p>Some changes in the apache wsgi and mapserver configurations are required to make
c2cgeoportal work on Windows.</p>
<div class="section" id="apache-wsgi-conf-in">
<h4>apache/wsgi.conf.in<a class="headerlink" href="#apache-wsgi-conf-in" title="Permalink to this headline">¶</a></h4>
<p>WSGIDaemonProcess and WSGIProcessGroup are not supported on windows.</p>
<p>(<a class="reference external" href="http://code.google.com/p/modwsgi/wiki/ConfigurationDirectives#WSGIDaemonProcess">WSGIDaemonProcess ConfigurationDirective</a>
&#8220;Note that the WSGIDaemonProcess directive and corresponding features are not
available on Windows or when running Apache 1.3.&#8221;)</p>
<p>The following lines must be commented/removed:</p>
<div class="highlight-python"><pre>WSGIDaemonProcess c2cgeoportal:${vars:instanceid} display-name=%{GROUP} user=${vars:modwsgi_user}
...
WSGIProcessGroup c2cgeoportal:${vars:instanceid}</pre>
</div>
</div>
<div class="section" id="apache-mapserver-conf-in">
<h4>apache/mapserver.conf.in<a class="headerlink" href="#apache-mapserver-conf-in" title="Permalink to this headline">¶</a></h4>
<p>The path to Mapserver executable must be modified:</p>
<div class="highlight-python"><pre>ScriptAlias /${vars:instanceid}/mapserv C:/path/to/ms4w/Apache/cgi-bin/mapserv.exe</pre>
</div>
</div>
<div class="section" id="const-buildout-cfg">
<span id="integrator-install-application-bootstrap-buildout"></span><h4>CONST_buildout.cfg<a class="headerlink" href="#const-buildout-cfg" title="Permalink to this headline">¶</a></h4>
<p>Some outputs paths must be modified for the print:</p>
<div class="highlight-python"><pre>basedir = print\
...
output = C:\path\to\tomcat\webapps\print-c2cgeoportal-${vars:instanceid}.war</pre>
</div>
</div>
<div class="section" id="buildout-cfg">
<h4>buildout.cfg<a class="headerlink" href="#buildout-cfg" title="Permalink to this headline">¶</a></h4>
<p>It may be better to create a specific buildout file for Windows (for
instance <tt class="docutils literal"><span class="pre">buildout_windows.cfg</span></tt>) that extends the buildout.cfg file.</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Under <tt class="docutils literal"><span class="pre">[buildout]</span></tt> add <tt class="docutils literal"><span class="pre">exec-sitecustomize</span> <span class="pre">=</span> <span class="pre">true</span></tt> to use our eggs.</p>
</li>
<li><p class="first">Under <tt class="docutils literal"><span class="pre">[template]</span></tt> add <tt class="docutils literal"><span class="pre">extends</span> <span class="pre">-=</span> <span class="pre">facts</span></tt> to ignore facts that are specific to Unix.</p>
</li>
<li><dl class="first docutils">
<dt>Under <tt class="docutils literal"><span class="pre">[version]</span></tt> add these two lines to pick the installed version (It may be</dt>
<dd><p class="first">preferable to specify the version that you&#8217;ve installed):</p>
<ul class="last simple">
<li><tt class="docutils literal"><span class="pre">distribute</span> <span class="pre">=</span></tt></li>
<li><tt class="docutils literal"><span class="pre">psycopg2</span> <span class="pre">=</span></tt></li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Under <tt class="docutils literal"><span class="pre">[print-war]</span></tt> add <tt class="docutils literal"><span class="pre">mod</span> <span class="pre">=</span> <span class="pre">create</span></tt> because update seems not to work on Windows.</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="mapserver-c2cgeoportal-map-in">
<h4>mapserver/c2cgeoportal.map.in<a class="headerlink" href="#mapserver-c2cgeoportal-map-in" title="Permalink to this headline">¶</a></h4>
<p>You must specify the path to the mapserver&#8217;s epsg file by uncommenting and adapting
this line under <tt class="docutils literal"><span class="pre">MAP</span></tt> (use regular slash <tt class="docutils literal"><span class="pre">/</span></tt>)</p>
<div class="highlight-python"><pre>PROJ_LIB" "C:/PATH/TO/ms4w/proj/nad"</pre>
</div>
</div>
</div>
<div class="section" id="rhel-6-specific-configuration">
<h3>RHEL 6 Specific Configuration<a class="headerlink" href="#rhel-6-specific-configuration" title="Permalink to this headline">¶</a></h3>
<p>Specific settings are required when the c2cgeoportal application is to be run
on RedHat Enterprise Linux (RHEL) 6.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>First of all, note that, with RHEL, you cannot install the c2cgeoportal
application in your homedir. If you do so, you will get the following error
in the Apache logs:</p>
<div class="highlight-python"><pre>(13)Permission denied: access to /~elemoine/ denied</pre>
</div>
<p class="last">So always install the application in an Apache-accessible directory. On
Camptocamp <em>puppetized</em> servers you will typically install the application
in <tt class="docutils literal"><span class="pre">/var/www/vhosts/&lt;vhost&gt;/private/dev/&lt;username&gt;/</span></tt>, where <tt class="docutils literal"><span class="pre">&lt;vhost&gt;</span></tt>
is the name of the Apache virtual host, and <tt class="docutils literal"><span class="pre">&lt;username&gt;</span></tt> is your Unix
login name.</p>
</div>
<div class="section" id="id1">
<h4>buildout.cfg<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>By default, <tt class="docutils literal"><span class="pre">mod_wsgi</span></tt> processes are executed under the <tt class="docutils literal"><span class="pre">www-data</span></tt> Unix
user, which is the Apache user. In RHEL 6, there&#8217;s no user <tt class="docutils literal"><span class="pre">www-data</span></tt>, and
the Apache user is <tt class="docutils literal"><span class="pre">apache</span></tt>. To accomodate that edit <tt class="docutils literal"><span class="pre">buildout.cfg</span></tt> and
set <tt class="docutils literal"><span class="pre">modwsgi_user</span></tt> to <tt class="docutils literal"><span class="pre">apache</span></tt> in the <tt class="docutils literal"><span class="pre">[vars]</span></tt> section:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">vars</span><span class="p">]</span>
<span class="o">...</span>
<span class="n">modwsgi_user</span> <span class="o">=</span> <span class="n">apache</span>
</pre></div>
</div>
<p>Also, by default, the path to Tomcat&#8217;s <tt class="docutils literal"><span class="pre">webapps</span></tt> directory is
<tt class="docutils literal"><span class="pre">/srv/tomcat/tomcat1/webapps</span></tt>. On RHEL 6, Tomcat is located in
<tt class="docutils literal"><span class="pre">/var/lib/tomcat6/</span></tt>. To accomodate that the <tt class="docutils literal"><span class="pre">output</span></tt> path of the
<tt class="docutils literal"><span class="pre">[print-war]</span></tt> part should be changed:</p>
<div class="highlight-python"><pre>[print-war]
output = /var/lib/tomcat6/webapps/print-c2cgeoportal-${vars:instanceid}.war</pre>
</div>
</div>
<div class="section" id="id2">
<h4>apache/mapserver.conf.in<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>On RHEL 6 the <tt class="docutils literal"><span class="pre">mapserv</span></tt> binary is located in <tt class="docutils literal"><span class="pre">/usr/libexec/</span></tt>. The
<tt class="docutils literal"><span class="pre">mapserver.conf.in</span></tt> Apache config file assumes that <tt class="docutils literal"><span class="pre">mapserv</span></tt> is located in
<tt class="docutils literal"><span class="pre">/usr/lib/cgi-bin/</span></tt>, and should therefore be changed:</p>
<div class="highlight-python"><pre>ScriptAlias /${vars:instanceid}/mapserv /usr/libexec/mapserv</pre>
</div>
</div>
</div>
<div class="section" id="apache2ctl">
<h3>apache2ctl<a class="headerlink" href="#apache2ctl" title="Permalink to this headline">¶</a></h3>
<p>On RedHat the commands hasn&#8217;t the &#8216;2&#8217;!
Then to graceful apache do:</p>
<div class="highlight-python"><pre>/usr/sbin/apachectl graceful</pre>
</div>
</div>
<div class="section" id="buildout-bootstrap">
<h3>Buildout bootstrap<a class="headerlink" href="#buildout-bootstrap" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://pypi.python.org/pypi/zc.buildout/1.5.2">Buildout</a> tool is used to
build, install, and deploy c2cgeoportal applications.</p>
<p>Prior to using Buildout, its <tt class="docutils literal"><span class="pre">bootstrap.py</span></tt> script should be run at the root
of the application:</p>
<div class="highlight-python"><pre>$ python bootstrap.py --version 1.5.2 --distribute --download-base \
      http://pypi.camptocamp.net/distribute-0.6.22_fix-issue-227/ --setup-source \
      http://pypi.camptocamp.net/distribute-0.6.22_fix-issue-227/distribute_setup.py</pre>
</div>
<p>This step is done only once for installation/instance of the application.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you have permissions issues on Windows you can try to set the TMP
path variable to a folder that you created (like <tt class="docutils literal"><span class="pre">C:\tmp</span></tt>). If
the problem persists don&#8217;t use the proxy by using this command instead
(where buildout_windows.cfg is your specific buildout for Windows
as configured above):</p>
<div class="last highlight-python"><pre>$ python bootstrap.py --version 1.5.2 --distribute -c buildout_windows.cfg</pre>
</div>
</div>
</div>
<div class="section" id="integrator-install-application-install-application">
<span id="id3"></span><h3>Install the application<a class="headerlink" href="#integrator-install-application-install-application" title="Permalink to this headline">¶</a></h3>
<p>If it doesn&#8217;t already exist, create a <tt class="docutils literal"><span class="pre">buildout_&lt;user&gt;.cfg</span></tt> file
(where <tt class="docutils literal"><span class="pre">&lt;user&gt;</span></tt> is for example your username),
that will contain your application special
configuration:</p>
<div class="highlight-python"><pre>[buildout]
extends = buildout.cfg
parts -= fix-perm

[vars]
instanceid = &lt;instanceid&gt;

[jsbuild]
compress = False

[jsbuild-mobile]
compress = False

[cssbuild]
compress = false</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The <tt class="docutils literal"><span class="pre">&lt;instanceid&gt;</span></tt> should be unique on the server, the username is a good
choice or something like <tt class="docutils literal"><span class="pre">&lt;user&gt;-&lt;sub-project&gt;</span></tt> in case of parent/children project.</p>
<p class="last"><tt class="docutils literal"><span class="pre">parts</span> <span class="pre">-=</span> <span class="pre">fix-perm</span></tt> disables the <tt class="docutils literal"><span class="pre">fix-perm</span></tt> task that may take some
time whereas it is not needed in a personal environment.</p>
</div>
<p>Add it to Git:</p>
<div class="highlight-python"><pre>git add buildout_&lt;user&gt;.cfg
git commit -m "add user buildout"</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>for SVN users:</p>
<div class="last highlight-python"><pre>svn add buildout_&lt;user&gt;.cfg
svn commit -m "add user buildout"</pre>
</div>
</div>
<p>Then you can build and install the application with the command:</p>
<div class="highlight-python"><pre>./buildout/bin/buildout -c buildout_&lt;user&gt;.cfg</pre>
</div>
<p>This previous command will do many things like:</p>
<blockquote>
<div><ul class="simple">
<li>download and install the project dependencies,</li>
<li>adapt the application configuration to your environment,</li>
<li>build the javascript and css resources into compressed files,</li>
<li>compile the translation files.</li>
</ul>
</div></blockquote>
<p>Once the application is built and installed, you now have to create and
populate the application tables, and directly set the version (details later):</p>
<div class="highlight-python"><pre>$ ./buildout/bin/create_db --populate
$ ./buildout/bin/manage_db version_control `./buildout/bin/manage_db version`</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>With c2cgeoportal 0.7 and lower, or if the app section is not <tt class="docutils literal"><span class="pre">[app:app]</span></tt>
in the production.ini file, you need to specify the app name on the
<tt class="docutils literal"><span class="pre">manage_db</span></tt> command line. For example, the above command would be as
follows:</p>
<div class="last highlight-python"><pre>$ ./buildout/bin/manage_db -n &lt;package_name&gt; version_control \
  `./buildout/bin/manage_db -n &lt;package_name&gt; version`</pre>
</div>
</div>
<p>A c2cgeoportal application makes use of <tt class="docutils literal"><span class="pre">sqlalchemy-migrate</span></tt> to version
control a database. It relies on a <strong>repository</strong> in source code which contains
upgrade scripts that are used to keep the database up to date with the
latest repository version.</p>
<p>After having created the application tables with the previous command,
the current database version correspond to the latest version available in
the repository, which can be obtained with:</p>
<div class="highlight-python"><pre>$ ./buildout/bin/manage_db version
&lt;current_version&gt;
$</pre>
</div>
<p>Note that future schema upgrades will only be done via change scripts from the
repository, and they will automatically increment the <tt class="docutils literal"><span class="pre">db_version</span></tt>.</p>
<p>Your application is now fully set up and the last thing to do is to configure
apache so that it will serve your WSGI c2cgeoportal application. So you just
have to include the application apache configuration available in the
<tt class="docutils literal"><span class="pre">apache</span></tt> directory. On servers managed by Camptocamp, add a <tt class="docutils literal"><span class="pre">.conf</span></tt> file in
<tt class="docutils literal"><span class="pre">/var/www[/vhost]/&lt;vhostname&gt;/conf/</span></tt> (<tt class="docutils literal"><span class="pre">[/vhost]</span></tt> means that the vhost folder
is optional, <tt class="docutils literal"><span class="pre">&lt;vhostname&gt;</span></tt> is a folder that should already exist (created by
the system administrator), that corresponds to the virtual host)
with the following content:</p>
<div class="highlight-python"><pre>Include /&lt;project_path&gt;/apache/*.conf</pre>
</div>
<p>where <tt class="docutils literal"><span class="pre">&lt;project_path&gt;</span></tt> is the path to your project.</p>
<p>Reload apache configuration and you&#8217;re done:</p>
<div class="highlight-python"><pre>$ sudo /usr/sbin/apache2ctl graceful</pre>
</div>
<p>Your application should be available at:
<tt class="docutils literal"><span class="pre">http://&lt;hostname&gt;/&lt;instanceid&gt;/wsgi</span></tt>.</p>
<p>Where the <tt class="docutils literal"><span class="pre">&lt;hostname&gt;</span></tt> is directly linked to the virtual host,
and the <tt class="docutils literal"><span class="pre">&lt;instanceid&gt;</span></tt> is the value you provided before.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Install an existing application</a><ul>
<li><a class="reference internal" href="#system-requirements">System requirements</a></li>
<li><a class="reference internal" href="#set-up-the-database">Set up the database</a><ul>
<li><a class="reference internal" href="#create-the-database">Create the database</a></li>
<li><a class="reference internal" href="#create-the-schema">Create the schema</a></li>
<li><a class="reference internal" href="#create-a-database-user">Create a database user</a></li>
</ul>
</li>
<li><a class="reference internal" href="#install-the-application">Install the application</a><ul>
<li><a class="reference internal" href="#get-the-application-source-tree">Get the application source tree</a></li>
<li><a class="reference internal" href="#windows-specific-configuration">Windows Specific Configuration</a><ul>
<li><a class="reference internal" href="#apache-wsgi-conf-in">apache/wsgi.conf.in</a></li>
<li><a class="reference internal" href="#apache-mapserver-conf-in">apache/mapserver.conf.in</a></li>
<li><a class="reference internal" href="#const-buildout-cfg">CONST_buildout.cfg</a></li>
<li><a class="reference internal" href="#buildout-cfg">buildout.cfg</a></li>
<li><a class="reference internal" href="#mapserver-c2cgeoportal-map-in">mapserver/c2cgeoportal.map.in</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rhel-6-specific-configuration">RHEL 6 Specific Configuration</a><ul>
<li><a class="reference internal" href="#id1">buildout.cfg</a></li>
<li><a class="reference internal" href="#id2">apache/mapserver.conf.in</a></li>
</ul>
</li>
<li><a class="reference internal" href="#apache2ctl">apache2ctl</a></li>
<li><a class="reference internal" href="#buildout-bootstrap">Buildout bootstrap</a></li>
<li><a class="reference internal" href="#integrator-install-application-install-application">Install the application</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="create_application.html"
                        title="previous chapter">Create a new application</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="features.html"
                        title="next chapter">Additional features</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/integrator/install_application.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="features.html" title="Additional features"
             >next</a> |</li>
        <li class="right" >
          <a href="create_application.html" title="Create a new application"
             >previous</a> |</li>
        <li><a href="../index.html">c2cgeoportal  documentation</a> &raquo;</li>
          <li><a href="index.html" >Integrator Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Camptocamp.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>