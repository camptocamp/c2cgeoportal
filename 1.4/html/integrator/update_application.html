

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Update a c2cgeoportal application &mdash; c2cgeoportal  documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="c2cgeoportal  documentation" href="../index.html" />
    <link rel="up" title="Integrator Guide" href="index.html" />
    <link rel="next" title="Deploy the application" href="deploy.html" />
    <link rel="prev" title="Internationalization" href="internationalization.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="deploy.html" title="Deploy the application"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="internationalization.html" title="Internationalization"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">c2cgeoportal  documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Integrator Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="update-a-c2cgeoportal-application">
<span id="integrator-update-application"></span><h1>Update a c2cgeoportal application<a class="headerlink" href="#update-a-c2cgeoportal-application" title="Permalink to this headline">¶</a></h1>
<div class="section" id="update-the-application-code">
<h2>Update the application code<a class="headerlink" href="#update-the-application-code" title="Permalink to this headline">¶</a></h2>
<p>To get the changes done by other people, we need to <tt class="docutils literal"><span class="pre">pull</span></tt> the new code:</p>
<div class="highlight-python"><pre>git pull
git submodule sync
git submodule update --init
git submodule foreach git submodule sync
git submodule foreach git submodule update --init</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The submodule command is used to have the right version of CGXP.</p>
</div>
<p>If you still use SVN:</p>
<div class="highlight-python"><pre>svn update</pre>
</div>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">This command will not update CGXP, and c2cgeoportal is not able to
fix the revision of CGXP.</p>
</div>
</div>
<div class="section" id="update-c2cgeoportal">
<h2>Update c2cgeoportal<a class="headerlink" href="#update-c2cgeoportal" title="Permalink to this headline">¶</a></h2>
<p>Upgrading an application to a new version of c2cgeoportal requires several
steps:</p>
<ol class="arabic">
<li><p class="first">It&#8217;s good to start an update in a clean repository, then:</p>
<ul>
<li><p class="first">See what&#8217;s not commited:</p>
<div class="highlight-python"><pre>git status</pre>
</div>
</li>
<li><p class="first">Reset non commited changes:</p>
<div class="highlight-python"><pre>git reset --hard</pre>
</div>
</li>
<li><p class="first">Remove all untracked files and directories:</p>
<div class="highlight-python"><pre>git clean -f -d</pre>
</div>
</li>
</ul>
</li>
<li><p class="first">If you are upgrading from version 1.3.1 or older, make your application
require the new version of the <tt class="docutils literal"><span class="pre">c2cgeoportal</span></tt> package by editing the
application&#8217;s Buildout config (<tt class="docutils literal"><span class="pre">buildout.cfg</span></tt>) and change the version of
<tt class="docutils literal"><span class="pre">c2cgeoportal</span></tt> in the <tt class="docutils literal"><span class="pre">[versions]</span></tt> section. Make sure the version
specifications in <tt class="docutils literal"><span class="pre">setup.py</span></tt> and <tt class="docutils literal"><span class="pre">buildout.cfg</span></tt> do not conflict.</p>
</li>
<li><p class="first">Now, to update the application&#8217;s other dependencies,
get the new <tt class="docutils literal"><span class="pre">version.cfg</span></tt> file:</p>
<div class="highlight-python"><pre>wget https://raw.github.com/camptocamp/c2cgeoportal/&lt;version&gt;/c2cgeoportal/scaffolds/create/versions.cfg -O versions.cfg</pre>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">&lt;version&gt;</span></tt> by a version number (branch) or release number (tag).
To get the last dev version, replace &lt;version&gt; by &#8220;master&#8221;.</p>
<p>For example to get the <tt class="docutils literal"><span class="pre">versions.cfg</span></tt> file of version 1.4, type:</p>
<div class="highlight-python"><pre>wget https://raw.github.com/camptocamp/c2cgeoportal/1.4/c2cgeoportal/scaffolds/create/versions.cfg -O versions.cfg</pre>
</div>
</li>
<li><p class="first">Execute <tt class="docutils literal"><span class="pre">buildout</span></tt> (<tt class="docutils literal"><span class="pre">eggs</span></tt> part) to get the new <tt class="docutils literal"><span class="pre">c2cgeoportal</span></tt> version:</p>
<div class="highlight-python"><pre>$ ./buildout/bin/buildout install eggs</pre>
</div>
</li>
<li><p class="first">Apply the <tt class="docutils literal"><span class="pre">c2cgeoportal_update</span></tt> scaffold:</p>
<div class="highlight-python"><pre>$ ./buildout/bin/pcreate --interactive -s c2cgeoportal_update \
  ../&lt;project_name&gt; package=&lt;package_name&gt;</pre>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Don&#8217;t add any &#8216;/&#8217; after the project name.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For <tt class="docutils literal"><span class="pre">c2cgeoportal</span></tt> 0.6 and lower:</p>
<div class="highlight-python"><pre>$ ./buildout/bin/paster create --template=c2cgeoportal_update \
  --output-dir=.. &lt;project_name&gt; package=&lt;package_name&gt;</pre>
</div>
<p class="last"><tt class="docutils literal"><span class="pre">&lt;project_name&gt;</span></tt> is the name of the application&#8217;s root directory,
including <tt class="docutils literal"><span class="pre">development.ini</span></tt>, etc.  <tt class="docutils literal"><span class="pre">&lt;package_name&gt;</span></tt> is the name of the
application&#8217;s root Python module, i.e. the name of the subdir including the
application&#8217;s Python code. If unsure, see the <tt class="docutils literal"><span class="pre">name</span></tt> argument to the
<tt class="docutils literal"><span class="pre">setup</span></tt> call in the application&#8217;s <tt class="docutils literal"><span class="pre">setup.py</span></tt> file.</p>
</div>
<ol class="arabic" start="6">
<li><p class="first">Do manual migration steps based on what&#8217;s in the <tt class="docutils literal"><span class="pre">CONST_CHANGELOG.txt</span></tt>
file.</p>
</li>
<li><p class="first">If it still exists, you can now entirely remove the <tt class="docutils literal"><span class="pre">[versions]</span></tt> section in your
<tt class="docutils literal"><span class="pre">buildout.cfg</span></tt> file.</p>
</li>
<li><p class="first">Execute <tt class="docutils literal"><span class="pre">buildout</span></tt> to rebuild and install the application:</p>
<div class="highlight-python"><pre>$ ./buildout/bin/buildout -c &lt;buildout_config_file&gt;</pre>
</div>
</li>
<li><p class="first">Update the database using the <tt class="docutils literal"><span class="pre">manage_db</span></tt> script:</p>
<div class="highlight-python"><pre>$ ./buildout/bin/manage_db upgrade</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>With c2cgeoportal 0.7 and lower, or if the app section is not <tt class="docutils literal"><span class="pre">[app:app]</span></tt>
in the production.ini file, you need to specify the app name on the
<tt class="docutils literal"><span class="pre">manage_db</span></tt> command line. For example, the above command would be as
follows:</p>
<div class="last highlight-python"><pre>$ ./buildout/bin/manage_db -n &lt;package_name&gt; upgrade</pre>
</div>
</div>
<p><tt class="docutils literal"><span class="pre">&lt;package_name&gt;</span></tt> is to be replaced by the name of the application module.
See above for more information.</p>
</li>
<li><p class="first">Add the new files in the repository:</p>
</li>
</ol>
<blockquote>
<div><p>Get informations on the status of the repository:</p>
<div class="highlight-python"><pre>git status</pre>
</div>
<p>Add the new files:</p>
<div class="highlight-python"><pre>git add &lt;file1&gt; &lt;file2&gt; ...</pre>
</div>
</div></blockquote>
</div>
<div class="section" id="update-cgxp">
<h2>Update CGXP<a class="headerlink" href="#update-cgxp" title="Permalink to this headline">¶</a></h2>
<p>To update CGXP to a release tag (like 1.3.0) use the following:</p>
<div class="highlight-python"><pre>cd &lt;package&gt;/static/lib/cgxp
git fetch
git checkout &lt;tag&gt;
git submodule sync
git submodule update --init</pre>
</div>
<p>To update CGXP to a version branch (like 1.3) use the following:</p>
<div class="highlight-python"><pre>cd &lt;package&gt;/static/lib/cgxp
git fetch
git checkout &lt;branch&gt;
git pull origin &lt;branch&gt;
git submodule sync
git submodule update --init</pre>
</div>
<p><tt class="docutils literal"><span class="pre">&lt;package&gt;</span></tt> is to be replaced by the name of your application package name,
<tt class="docutils literal"><span class="pre">&lt;tag&gt;</span></tt> is the name of the release (in Git we use a tag),
<tt class="docutils literal"><span class="pre">&lt;branch&gt;</span></tt> is the name of the version (in Git we use a branch).</p>
<p>If the application code is under Git you also need to update the application
to reference the new commit for the cgxp submodule:</p>
<div class="highlight-python"><pre>$ cd ..
$ git add cgxp
$ git commit -m "Update cgxp submodule"</pre>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">We have a major issue here for applications under SVN. When SVN, as
opposed to Git, is used for the application the version of CGXP is
not fixed in the application. This means that each installation of
an application may work with a different version of CGXP.</p>
</div>
<p>Do manual migration steps based on what&#8217;s in the
<a class="reference external" href="https://github.com/camptocamp/cgxp/blob/master/CHANGELOG.rst">CHANGELOG</a>.</p>
</div>
<div class="section" id="test-and-commit">
<h2>Test and commit<a class="headerlink" href="#test-and-commit" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">After the update process is done, do a final build of the application:</p>
<div class="highlight-python"><pre>./buildout/bin/buildout -c &lt;buildout_config_file&gt;</pre>
</div>
</li>
<li><p class="first">Reload Apache configuration:</p>
<div class="highlight-python"><pre>sudo /usr/sbin/apache2ctl graceful</pre>
</div>
</li>
<li><p class="first">Test your application</p>
</li>
<li><p class="first">Commit your changes:</p>
<div class="highlight-python"><pre>git commit -am "Update GeoMapFish to version &lt;version&gt;"</pre>
</div>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Update a c2cgeoportal application</a><ul>
<li><a class="reference internal" href="#update-the-application-code">Update the application code</a></li>
<li><a class="reference internal" href="#update-c2cgeoportal">Update c2cgeoportal</a></li>
<li><a class="reference internal" href="#update-cgxp">Update CGXP</a></li>
<li><a class="reference internal" href="#test-and-commit">Test and commit</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="internationalization.html"
                        title="previous chapter">Internationalization</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="deploy.html"
                        title="next chapter">Deploy the application</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/integrator/update_application.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="deploy.html" title="Deploy the application"
             >next</a> |</li>
        <li class="right" >
          <a href="internationalization.html" title="Internationalization"
             >previous</a> |</li>
        <li><a href="../index.html">c2cgeoportal  documentation</a> &raquo;</li>
          <li><a href="index.html" >Integrator Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Camptocamp.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>