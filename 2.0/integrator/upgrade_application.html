<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Upgrading a GeoMapFish application &#8212; c2cgeoportal  documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="c2cgeoportal  documentation" href="../index.html" />
    <link rel="up" title="Integrator Guide" href="index.html" />
    <link rel="next" title="Configuring Windows tools required to connect to our servers" href="windows_tools.html" />
    <link rel="prev" title="Install an existing application" href="install_application.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="upgrading-a-geomapfish-application">
<span id="integrator-upgrade-application"></span><h1>Upgrading a GeoMapFish application<a class="headerlink" href="#upgrading-a-geomapfish-application" title="Permalink to this headline">¶</a></h1>
<div class="section" id="using-the-c2ctool-command">
<h2>Using the c2ctool command<a class="headerlink" href="#using-the-c2ctool-command" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">c2ctool</span></code> is a tool to facilitate the common operations around GeoMapFish.</p>
</div>
<div class="section" id="easy-updating-an-application-code">
<h2>Easy updating an application code<a class="headerlink" href="#easy-updating-an-application-code" title="Permalink to this headline">¶</a></h2>
<p>Verify that you have in your <code class="docutils literal"><span class="pre">project.yaml.mako</span></code> file the following <code class="docutils literal"><span class="pre">template_vars</span></code>: <code class="docutils literal"><span class="pre">package</span></code>, <code class="docutils literal"><span class="pre">srid</span></code>, <code class="docutils literal"><span class="pre">extent</span></code>, <code class="docutils literal"><span class="pre">apache_vhost</span></code>, for example:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span>...
template_vars:
    package: ${package}
    srid: ${srid}
    extent: 489246, 78873, 837119, 296543
    apache_vhost: &lt;apache_vhost&gt;
</pre></div>
</div>
<p>Then run:</p>
<pre class="highlight"><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1">make -f &lt;makefile&gt; update</span>
<span class="prompt1">make -f &lt;makefile&gt; build</span>
</pre><p>Where <code class="docutils literal"><span class="pre">&lt;makefile&gt;</span></code> is your user make file (<code class="docutils literal"><span class="pre">&lt;user&gt;.mk</span></code>).</p>
</div>
<div class="section" id="easy-upgrading-an-application">
<h2>Easy upgrading an application<a class="headerlink" href="#easy-upgrading-an-application" title="Permalink to this headline">¶</a></h2>
<p>In the <code class="docutils literal"><span class="pre">setup.py</span></code> be sure not to specify a <code class="docutils literal"><span class="pre">c2cgeoportal</span></code> version,
because it will prevent the installation of the new <code class="docutils literal"><span class="pre">c2cgeoportal</span></code> egg.</p>
<p>We considers that your makefile is named <code class="docutils literal"><span class="pre">&lt;instanceid&gt;.mk</span></code>, if it is not the case
add in your Makefile <code class="docutils literal"><span class="pre">UPGRADE_MAKE_FILE</span> <span class="pre">=</span> <span class="pre">&lt;user.mk&gt;</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For Windows:</p>
<p class="last">You should add <code class="docutils literal"><span class="pre">UPGRADE_ARGS</span> <span class="pre">+=</span> <span class="pre">--windows</span></code> in your <code class="docutils literal"><span class="pre">&lt;package&gt;.mk</span></code> file.</p>
</div>
<p>Then to upgrade from 1.6 just run:</p>
<pre class="highlight"><span class="prompt1"><span class="nb">export</span> <span class="nv">VERSION</span><span class="o">=</span>&lt;target_version&gt;</span>
<span class="prompt1">make -f &lt;makefile&gt; upgrade_v2</span>
</pre><p>And for a minor upgrade run:</p>
<pre class="highlight"><span class="prompt1"><span class="nb">export</span> <span class="nv">VERSION</span><span class="o">=</span>&lt;target_version&gt;</span>
<span class="prompt1">make -f &lt;makefile&gt; upgrade</span>
</pre><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For Windows:</p>
<p class="last">You should replace <code class="docutils literal"><span class="pre">export</span> <span class="pre">VERSION=&lt;target_version&gt;</span></code> with
<code class="docutils literal"><span class="pre">SET</span> <span class="pre">VERSION=&lt;target_version&gt;</span></code>.</p>
</div>
<p>Where <code class="docutils literal"><span class="pre">&lt;makefile&gt;</span></code> is your user Makefile (<code class="docutils literal"><span class="pre">&lt;user&gt;.mk</span></code>),
<code class="docutils literal"><span class="pre">&lt;target_version&gt;</span></code> is the version that you wish to upgrade to
(for the development version it should be &#8216;master&#8217;).</p>
<p>And follow the instructions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For Windows:</p>
<p>If you are using Windows, you will have to execute some steps prior
to the instructions hereunder:</p>
<ul class="last">
<li><p class="first">Uninstall manually the old c2cgeoportal egg:</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">.build/venv/Scripts/pip</span> <span class="pre">uninstall</span> <span class="pre">c2cgeoportal</span></code></p>
</div></blockquote>
</li>
<li><p class="first">Clean / remove the generated files:</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">make</span> <span class="pre">-f</span> <span class="pre">&lt;makefile&gt;</span> <span class="pre">clean</span></code></p>
</div></blockquote>
</li>
<li><p class="first">Change the version in <code class="docutils literal"><span class="pre">setup.py</span></code> and <code class="docutils literal"><span class="pre">CONST_requirements.txt</span></code>
to the version you wish to install.</p>
</li>
<li><p class="first">Build your application:</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">make</span> <span class="pre">-f</span> <span class="pre">&lt;makefile&gt;</span> <span class="pre">build</span></code></p>
</div></blockquote>
</li>
<li><p class="first">Put your modifications under git revision:</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">setup.py</span></code></p>
<p><code class="docutils literal"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">CONST_requirements.txt</span></code></p>
<p><code class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-m</span> <span class="pre">&quot;Upgrade</span> <span class="pre">c2cgeoportal</span> <span class="pre">version&quot;</span></code></p>
<p><code class="docutils literal"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">&lt;remote&gt;</span> <span class="pre">&lt;branch&gt;</span></code></p>
</div></blockquote>
</li>
<li><p class="first">Follow the Windows instructions hereunder, note that you will have to use
<code class="docutils literal"><span class="pre">.build\venv\Scripts\...</span></code> instead of <code class="docutils literal"><span class="pre">.build\venv\bin\...</span></code> in all given
commands</p>
</li>
</ul>
</div>
</div>
<div class="section" id="upgrade-the-database">
<h2>Upgrade the database<a class="headerlink" href="#upgrade-the-database" title="Permalink to this headline">¶</a></h2>
<p>The database will be automatically upgraded during the upgrade process.</p>
<p>To upgrade only the database you can use alembic directly.</p>
<p>The help:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">build</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">alembic</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>Upgrade the main schema:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">build</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">alembic</span> <span class="o">--</span><span class="n">config</span> <span class="n">alembic</span><span class="o">.</span><span class="n">ini</span> <span class="n">upgrade</span> <span class="n">head</span>
</pre></div>
</div>
<p>Upgrade the static schema:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">build</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">alembic</span> <span class="o">--</span><span class="n">config</span> <span class="n">alembic_static</span><span class="o">.</span><span class="n">ini</span> <span class="n">upgrade</span> <span class="n">head</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/camptocamp.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Upgrading a GeoMapFish application</a><ul>
<li><a class="reference internal" href="#using-the-c2ctool-command">Using the c2ctool command</a></li>
<li><a class="reference internal" href="#easy-updating-an-application-code">Easy updating an application code</a></li>
<li><a class="reference internal" href="#easy-upgrading-an-application">Easy upgrading an application</a></li>
<li><a class="reference internal" href="#upgrade-the-database">Upgrade the database</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Integrator Guide</a><ul>
      <li>Previous: <a href="install_application.html" title="previous chapter">Install an existing application</a></li>
      <li>Next: <a href="windows_tools.html" title="next chapter">Configuring Windows tools required to connect to our servers</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/integrator/upgrade_application.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2016, Camptocamp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../_sources/integrator/upgrade_application.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/camptocamp/c2cgeoportal" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>