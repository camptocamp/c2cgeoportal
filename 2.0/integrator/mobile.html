<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Mobile Applications &mdash; c2cgeoportal  documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="c2cgeoportal  documentation" href="../index.html" />
    <link rel="up" title="Integrator Guide" href="index.html" />
    <link rel="next" title="Internationalization" href="internationalization.html" />
    <link rel="prev" title="Digital Elevation Tools" href="raster.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="mobile-applications">
<span id="integrator-mobile"></span><h1>Mobile Applications<a class="headerlink" href="#mobile-applications" title="Permalink to this headline">¶</a></h1>
<p>Any c2cgeoportal projet created with the <code class="docutils literal"><span class="pre">c2cgeoportal_create</span></code> and
<code class="docutils literal"><span class="pre">c2cgeoportal_update</span></code> scaffolds comes with a <a class="reference external" href="http://www.sencha.com/products/touch/">Sencha Touch</a> based mobile application.</p>
<p>The mobile application is available at the URLs <code class="docutils literal"><span class="pre">&lt;instance_id&gt;/wsgi/mobile_dev/</span></code> and
<code class="docutils literal"><span class="pre">&lt;instance_id&gt;/wsgi/mobile/</span></code>. Do not forget the trailing slash! The first URL should be used
during development, as non-minified resources are used. The second URL is for
production. The second URL is for production as well as its alias <code class="docutils literal"><span class="pre">&lt;apache_entry_point&gt;/mobile</span></code>.</p>
<p>This application includes the following features:</p>
<ul class="simple">
<li>Map with zoom buttons.</li>
<li>Geolocation.</li>
<li>Base layer selector.</li>
<li>Overlay selector.</li>
<li>Text search.</li>
<li>Map queries (long-press on the map).</li>
</ul>
<p>Current limitations:</p>
<ul class="simple">
<li>The overlays only are queryable.</li>
<li>Non-WMS overlays are not supported.</li>
<li>For map queries it is assumed that there a 1:1 relationship between WMS
layers and WFS feature types, which is not the case if a WMS layer is
actually a group in the mapfile.</li>
</ul>
<p>For map queries (long-press) to work a <a class="reference external" href="https://github.com/openlayers/openlayers/commit/f5aae88a3141dc94863791e500253b8a89ccd7ce">specific OpenLayers commit</a>
is required. Commit <a class="reference external" href="https://github.com/camptocamp/cgxp/commit/444ba161fa67cdb503479da12dda71a82a70f310">444ba16</a>
of CGXP includes this OpenLayers commit. So make sure your c2cgeoportal
application uses this commit (or better) of CGXP.</p>
<div class="section" id="infrastructure">
<h2>Infrastructure<a class="headerlink" href="#infrastructure" title="Permalink to this headline">¶</a></h2>
<p>Creating and building a mobile application requires the <a class="reference external" href="http://www.sencha.com/products/sencha-cmd/download/">Sencha Cmd</a> tools and <a class="reference external" href="http://compass-style.org/">Compass</a> to be installed on the target machine.</p>
<p>On Camptocamp server we just need the Debian packages <code class="docutils literal"><span class="pre">sencha-cmd</span></code>
and <code class="docutils literal"><span class="pre">ruby-compass</span></code> (The <code class="docutils literal"><span class="pre">sencha-cmd</span></code> package was created by
the Camptocamp sysadmins).</p>
<p>On Camptocamp servers, in case you have both <code class="docutils literal"><span class="pre">sencha-sdk-tools</span></code> and
<code class="docutils literal"><span class="pre">sencha-cmd</span></code> installed, commands are named respectively <code class="docutils literal"><span class="pre">sencha-sdk</span></code>
and <code class="docutils literal"><span class="pre">sencha-cmd</span></code>. By default the <code class="docutils literal"><span class="pre">sencha-cmd</span></code> command is used, if
it&#8217;s not the case on your host put the following configuration variables
in your <cite>&lt;package&gt;.mk</cite> file:</p>
<div class="code make highlight-default"><div class="highlight"><pre><span></span><span class="n">SENCHA_CMD</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">sencha</span><span class="o">-</span><span class="n">command</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal"><span class="pre">&lt;sencha-command&gt;</span></code> by <code class="docutils literal"><span class="pre">sencha-sdk</span></code> if you want to build the
mobile app using a version of GeoMapFish older than 1.4.</p>
</div>
<div class="section" id="adding-mobile-routes-and-views">
<h2>Adding mobile routes and views<a class="headerlink" href="#adding-mobile-routes-and-views" title="Permalink to this headline">¶</a></h2>
<p>The last step involves adding <em>routes</em> and <em>views</em> specific to the mobile
application. Edit the project&#8217;s <code class="docutils literal"><span class="pre">__init__.py</span></code> file and add the following
lines before the <code class="docutils literal"><span class="pre">main</span></code> function&#8217;s return statement:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="c1"># mobile views and routes</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;mobile_index_dev&#39;</span><span class="p">,</span> <span class="s1">&#39;/mobile_dev/&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;c2cgeoportal.views.entry.Entry&#39;</span><span class="p">,</span>
                <span class="n">attr</span><span class="o">=</span><span class="s1">&#39;mobile&#39;</span><span class="p">,</span>
                <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;&lt;package&gt;:static/mobile/index.html&#39;</span><span class="p">,</span>
                <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;mobile_index_dev&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;mobile_config_dev&#39;</span><span class="p">,</span> <span class="s1">&#39;/mobile_dev/config.js&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;c2cgeoportal.views.entry.Entry&#39;</span><span class="p">,</span>
                <span class="n">attr</span><span class="o">=</span><span class="s1">&#39;mobileconfig&#39;</span><span class="p">,</span>
                <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;&lt;package&gt;:static/mobile/config.js&#39;</span><span class="p">,</span>
                <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;mobile_config_dev&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="s1">&#39;mobile_dev&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;package&gt;:static/mobile&#39;</span><span class="p">)</span>

<span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;mobile_index_prod&#39;</span><span class="p">,</span> <span class="s1">&#39;/mobile/&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;c2cgeoportal.views.entry.Entry&#39;</span><span class="p">,</span>
                <span class="n">attr</span><span class="o">=</span><span class="s1">&#39;mobile&#39;</span><span class="p">,</span>
                <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;&lt;package&gt;:static/mobile/build/production/App/index.html&#39;</span><span class="p">,</span>
                <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;mobile_index_prod&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;mobile_config_prod&#39;</span><span class="p">,</span> <span class="s1">&#39;/mobile/config.js&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="s1">&#39;c2cgeoportal.views.entry.Entry&#39;</span><span class="p">,</span>
                <span class="n">attr</span><span class="o">=</span><span class="s1">&#39;mobileconfig&#39;</span><span class="p">,</span>
                <span class="n">renderer</span><span class="o">=</span><span class="s1">&#39;&lt;package&gt;:static/mobile/build/production/App/config.js&#39;</span><span class="p">,</span>
                <span class="n">route_name</span><span class="o">=</span><span class="s1">&#39;mobile_config_prod&#39;</span><span class="p">)</span>
<span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="s1">&#39;mobile&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;package&gt;:static/mobile/build/production/App&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal"><span class="pre">&lt;package&gt;</span></code> with the project&#8217;s actual package name.</p>
<p>Now switch to the next section.</p>
</div>
<div class="section" id="building-the-mobile-application">
<h2>Building the mobile application<a class="headerlink" href="#building-the-mobile-application" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">CONST_Makefile</span></code> file includes the part <code class="docutils literal"><span class="pre">sencha-touch</span></code> and
<code class="docutils literal"><span class="pre">mobile</span></code> that are dedicated to building the mobile application.</p>
<p>For the <code class="docutils literal"><span class="pre">mobile</span></code> part to work Sencha SDK Tools and Compass should be
installed on the build machine. (See above.)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>On Windows you will need to override the values of the <code class="docutils literal"><span class="pre">mobile</span></code> part
<code class="docutils literal"><span class="pre">SENCHA_CMD</span></code> variables as such:</p>
<div class="code make highlight-default"><div class="highlight"><pre><span></span><span class="n">SENCHA_CMD</span> <span class="o">=</span> <span class="n">sencha</span><span class="o">.</span><span class="n">bat</span>
</pre></div>
</div>
<p class="last">You would add this in <code class="docutils literal"><span class="pre">&lt;package&gt;.mk</span></code>, or any make configuration file
that extends <code class="docutils literal"><span class="pre">&lt;package&gt;.mk</span></code>.</p>
</div>
<p>Once built the mobile application should be available on <code class="docutils literal"><span class="pre">&lt;instance_id&gt;/wsgi/mobile_dev/</span></code> and
<code class="docutils literal"><span class="pre">&lt;instance_id&gt;/wsgi/mobile/</span></code> in the browser.</p>
</div>
<div class="section" id="configuring-the-map-and-the-layers">
<h2>Configuring the map and the layers<a class="headerlink" href="#configuring-the-map-and-the-layers" title="Permalink to this headline">¶</a></h2>
<p>To change the map configuration and the layers for the mobile application edit
the project&#8217;s <code class="docutils literal"><span class="pre">static/mobile/config.js</span></code> and modify the config object passed
to the <code class="docutils literal"><span class="pre">OpenLayers.Map</span></code> constructor. The execution of the <code class="docutils literal"><span class="pre">config.js</span></code>
script should result in <code class="docutils literal"><span class="pre">App.map</span></code> being set to an <code class="docutils literal"><span class="pre">OpenLayers.Map</span></code>
instance.</p>
<div class="section" id="theme">
<h3>Theme<a class="headerlink" href="#theme" title="Permalink to this headline">¶</a></h3>
<p>The list of themes and layers shown in the mobile application is dynamically
generated. See <a class="reference internal" href="../administrator/index.html#administrator-guide"><span class="std std-ref">Administrator Guide</span></a>.</p>
</div>
</div>
<div class="section" id="raster-service">
<h2>Raster service<a class="headerlink" href="#raster-service" title="Permalink to this headline">¶</a></h2>
<p>When querying the map (longpress), the c2cgeoportal <code class="docutils literal"><span class="pre">raster</span></code> service can be
used to retrieve data from raster file (elevation, slope, etc...) and display
it in the <code class="docutils literal"><span class="pre">Query</span> <span class="pre">view</span></code> above query results.</p>
<p>If the raster service is already configured on the server, you can activate it
in the mobile application by adding the following to the config.js file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">App</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
</pre></div>
</div>
<p>You&#8217;ll also need to add a template string to each translation object. It needs
to be adapted to the data retrieved from the server:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="n">OpenLayers</span><span class="o">.</span><span class="n">Lang</span><span class="o">.</span><span class="n">fr</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
    <span class="s1">&#39;rasterTpl&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">&#39;&lt;div class=&quot;coordinates&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&lt;p&gt;X : </span><span class="si">{x}</span><span class="s1"> - Y : </span><span class="si">{y}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&lt;p&gt;Altitude terrain : </span><span class="si">{mnt}</span><span class="s1"> m&lt;/p&gt;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&lt;p&gt;Altitude surface : </span><span class="si">{mns}</span><span class="s1"> m&lt;/p&gt;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;&lt;/div&gt;&#39;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="p">};</span>
</pre></div>
</div>
<p>In the example above <code class="docutils literal"><span class="pre">mns</span></code> and <code class="docutils literal"><span class="pre">mnt</span></code> are the keys used in the server
config for the <code class="docutils literal"><span class="pre">raster</span> <span class="pre">web</span> <span class="pre">services</span></code>.</p>
</div>
<div class="section" id="permalink-crosshair">
<h2>Permalink crosshair<a class="headerlink" href="#permalink-crosshair" title="Permalink to this headline">¶</a></h2>
<p>A crosshair can be shown on the map when requesting the mobile application. To
do so, the following parameters have to be defined in the called URL:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">map_zoom</span></code>: map some level</li>
<li><code class="docutils literal"><span class="pre">map_x</span></code>: x coordinate on which the marker will be placed</li>
<li><code class="docutils literal"><span class="pre">map_y</span></code>: y coordinate on which the marker will be placed</li>
<li><code class="docutils literal"><span class="pre">map_crosshair</span></code>: set to a value (e.g. <code class="docutils literal"><span class="pre">map_crosshair=1</span></code>)</li>
</ul>
<p>By default, the OpenLayers default marker will be used.</p>
<p>To use a custom marker, do the following changes in the <code class="docutils literal"><span class="pre">static/mobile/config.js</span></code>
file:</p>
<ul>
<li><p class="first">Set <code class="docutils literal"><span class="pre">OpenLayers.ImgPath</span></code> to the path where you custom marker is.</p>
</li>
<li><p class="first">Define the following new variable:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">App</span><span class="o">.</span><span class="n">crosshair_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">OpenLayers</span><span class="o">.</span><span class="n">ImgPath</span><span class="o">+</span><span class="s1">&#39;custom_marker.png&#39;</span><span class="p">,</span>
    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">image_width</span><span class="p">,</span> <span class="n">image_height</span><span class="p">]</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
</ul>
<p>Where <code class="docutils literal"><span class="pre">image_width</span></code> and <code class="docutils literal"><span class="pre">image_height</span></code> are respectively the width and the
height of the crosshair image.</p>
</div>
<div class="section" id="settings-view">
<h2>Settings view<a class="headerlink" href="#settings-view" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">Settings</span></code> view, located in <code class="docutils literal"><span class="pre">app/view/Settings.js</span></code>, can be customized
to suit the project needs. The <code class="docutils literal"><span class="pre">Settings.js</span></code> file is part of c2cgeoportal&#8217;s
<code class="docutils literal"><span class="pre">c2cgeoportal_create</span></code> scaffold, it will therefore not be overwritten when
applying the <code class="docutils literal"><span class="pre">c2cgeoportal_update</span></code> scaffold during an update of c2cgeoportal.</p>
<p>If style customization is also required for components in this view, use the
<code class="docutils literal"><span class="pre">custom.scss</span></code> file.</p>
<div class="section" id="permalink">
<h3>Permalink<a class="headerlink" href="#permalink" title="Permalink to this headline">¶</a></h3>
<p>If a permalink field is needed, just add the following component in the
Settings view:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="n">xtype</span><span class="p">:</span> <span class="s1">&#39;map_permalink&#39;</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="login-logout">
<h3>Login/logout<a class="headerlink" href="#login-logout" title="Permalink to this headline">¶</a></h3>
<p>The mobile application includes a <code class="docutils literal"><span class="pre">Login</span></code> view component that the
<code class="docutils literal"><span class="pre">Settings</span></code> view can include as one of its items. This component enables login
and logout. If the user is not authenticated the <code class="docutils literal"><span class="pre">Login</span></code> component adds
a &#8220;log in&#8221; button, that, when clicked, redirects the user to a login form view.
If the user is authenticated the <code class="docutils literal"><span class="pre">Login</span></code> component adds a welcome message,
and a &#8220;log out&#8221; button.</p>
<p>Here&#8217;s an example of a <code class="docutils literal"><span class="pre">Settings</span></code> view that includes a <code class="docutils literal"><span class="pre">Login</span></code> view
component:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="n">Ext</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="s2">&quot;App.view.Settings&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">extend</span><span class="p">:</span> <span class="s1">&#39;Ext.Container&#39;</span><span class="p">,</span>
    <span class="n">xtype</span><span class="p">:</span> <span class="s1">&#39;settingsview&#39;</span><span class="p">,</span>
    <span class="n">requires</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">//</span> <span class="n">Do</span> <span class="ow">not</span> <span class="n">forget</span> <span class="n">this</span> <span class="n">requirement</span><span class="p">,</span> <span class="ow">or</span> <span class="n">Sencha</span> <span class="n">Touch</span>
        <span class="o">//</span> <span class="n">will</span> <span class="n">complain</span> <span class="n">that</span> <span class="s2">&quot;widget.login&quot;</span> <span class="ow">is</span> <span class="n">an</span>
        <span class="o">//</span> <span class="n">unrecognized</span> <span class="n">alias</span><span class="o">.</span>
        <span class="s1">&#39;App.view.Login&#39;</span>
    <span class="p">],</span>
    <span class="n">config</span><span class="p">:</span> <span class="p">{</span>
        <span class="n">items</span><span class="p">:</span> <span class="p">[{</span>
            <span class="n">xtype</span><span class="p">:</span> <span class="s1">&#39;toolbar&#39;</span><span class="p">,</span>
            <span class="n">docked</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
            <span class="n">items</span><span class="p">:</span> <span class="p">[{</span>
                <span class="n">xtype</span><span class="p">:</span> <span class="s1">&#39;spacer&#39;</span>
            <span class="p">},</span> <span class="p">{</span>
                <span class="n">xtype</span><span class="p">:</span> <span class="s1">&#39;button&#39;</span><span class="p">,</span>
                <span class="n">iconCls</span><span class="p">:</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span>
                <span class="n">iconMask</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
                <span class="n">action</span><span class="p">:</span> <span class="s1">&#39;home&#39;</span>
            <span class="p">}]</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="n">xtype</span><span class="p">:</span> <span class="s1">&#39;container&#39;</span><span class="p">,</span>
            <span class="n">cls</span><span class="p">:</span> <span class="s1">&#39;settings&#39;</span><span class="p">,</span>
            <span class="n">items</span><span class="p">:</span> <span class="p">[{</span>
                <span class="n">xtype</span><span class="p">:</span> <span class="s1">&#39;component&#39;</span><span class="p">,</span>
                <span class="n">html</span><span class="p">:</span> <span class="s1">&#39;&lt;p&gt;Some text&lt;/p&gt;&#39;</span>
            <span class="p">},</span> <span class="p">{</span>
                <span class="o">//</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">login</span> <span class="n">view</span> <span class="n">component</span><span class="o">.</span>
                <span class="n">xtype</span><span class="p">:</span> <span class="s1">&#39;login&#39;</span>
            <span class="p">}]</span>
        <span class="p">}]</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The i18n keys relative to the login/logout functionality are: <code class="docutils literal"><span class="pre">welcomeText</span></code>,
<code class="docutils literal"><span class="pre">loginLabel</span></code>, <code class="docutils literal"><span class="pre">passwordLabel</span></code>, <code class="docutils literal"><span class="pre">loginSubmitButtonText</span></code>, and
<code class="docutils literal"><span class="pre">loginCancelButtonText</span></code>. The last four pertain to the login form, they should
be self-explanatory. <code class="docutils literal"><span class="pre">welcomeText</span></code> is the text displayed above the &#8220;log out&#8221;
button when the user is authenticated, it typically includes the variable
<code class="docutils literal"><span class="pre">{username}</span></code>, which is changed to the actual username at render time. By
default, <code class="docutils literal"><span class="pre">config.js</span></code> includes the following english translations:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="n">OpenLayers</span><span class="o">.</span><span class="n">Lang</span><span class="o">.</span><span class="n">en</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="o">//</span> <span class="n">login</span><span class="o">/</span><span class="n">logout</span>
    <span class="s1">&#39;loginButtonText&#39;</span><span class="p">:</span> <span class="s1">&#39;Log in&#39;</span><span class="p">,</span>
    <span class="s1">&#39;welcomeText&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;p&gt;You are </span><span class="si">{username}</span><span class="s1">.&lt;/p&gt;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;logoutButtonText&#39;</span><span class="p">:</span> <span class="s1">&#39;Log out&#39;</span><span class="p">,</span>
    <span class="s1">&#39;loginLabel&#39;</span><span class="p">:</span> <span class="s1">&#39;Login&#39;</span><span class="p">,</span>
    <span class="s1">&#39;passwordLabel&#39;</span><span class="p">:</span> <span class="s1">&#39;Password&#39;</span><span class="p">,</span>
    <span class="s1">&#39;loginSubmitButtonText&#39;</span><span class="p">:</span> <span class="s1">&#39;Submit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;loginCancelButtonText&#39;</span><span class="p">:</span> <span class="s1">&#39;Cancel&#39;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>For the <code class="docutils literal"><span class="pre">Login</span></code> component to work the <code class="docutils literal"><span class="pre">App.info</span></code> JavaScript variable should
be set. The setting of this variable should be done anywhere in the
<code class="docutils literal"><span class="pre">config.js</span></code> file, with this:</p>
<div class="code javascript highlight-default"><div class="highlight"><pre><span></span><span class="n">App</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;${info | n}&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>By default <code class="docutils literal"><span class="pre">config.js</span></code> includes it.</p>
</div>
</div>
<div class="section" id="multiple-mobile-applications">
<h2>Multiple mobile applications<a class="headerlink" href="#multiple-mobile-applications" title="Permalink to this headline">¶</a></h2>
<p>This section discusses the possibility of having multiple mobile applications
within a c2cgeoportal application.</p>
<p>As you will find out by reading the rest of this section creating multiple
mobile applications is a clear violation of the &#8220;don&#8217;t repeat yourself&#8221;
principle. It is therefore discouraged; creating multiple <em>profiles</em> of the
mobile application should be done through multiple themes. However you may need
multiple mobile applications if you want, for example, different base layers,
and/or a high degree of customization, for each application.</p>
<p>Any c2cgeoportal application includes a mobile application in the
<code class="docutils literal"><span class="pre">&lt;package&gt;/static/mobile/</span></code> directory.  The mobile application is created
by the <code class="docutils literal"><span class="pre">c2cgeoportal_create</span></code> and <code class="docutils literal"><span class="pre">c2cgeoportal_update</span></code> scaffolds. To create
another mobile application, the easiest is to copy the existing <code class="docutils literal"><span class="pre">mobile</span></code>
directory into a new directory. For example:</p>
<pre class="highlight"><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1"><span class="nb">cd</span> &lt;package&gt;/static</span>
<span class="prompt1">cp -r mobile mobile2</span>
</pre><div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is important to note that the <code class="docutils literal"><span class="pre">c2cgeoportal_update</span></code> scaffold, which is
used when updating a c2cgeoportal application to a new c2cgeoportal
version, will update the <code class="docutils literal"><span class="pre">mobile</span></code> directory only. This further means that
any other mobile application will need to be manually updated (by copying
files).</p>
</div>
<p>Other things need to be duplicated:</p>
<ul>
<li><p class="first">The <code class="docutils literal"><span class="pre">jsbuild</span></code> mobile config file should be duplicated.</p>
<p>For this copy
<code class="docutils literal"><span class="pre">jsbuild/mobile.cfg</span></code> into <code class="docutils literal"><span class="pre">jsbuild/mobile2.cfg</span></code>, for example. You may
want to adapt the new config file, based on your needs.</p>
</li>
<li><p class="first">The <code class="docutils literal"><span class="pre">sencha-touch</span></code> make part should be duplicated.</p>
<p>For this copy the <code class="docutils literal"><span class="pre">[jsbuild-mobile]</span></code> and <code class="docutils literal"><span class="pre">[mobile]</span></code> sections of
<code class="docutils literal"><span class="pre">CONST_buildout.cfg</span></code>, them into the application&#8217;s <code class="docutils literal"><span class="pre">buildout.cfg</span></code> file,
rename them (to <code class="docutils literal"><span class="pre">[jsbuild-mobile2]</span></code> and <code class="docutils literal"><span class="pre">[mobile2]</span></code>), and adapt their
contents so they reference the new mobile directory (<code class="docutils literal"><span class="pre">static/mobile2</span></code>), and
the new <code class="docutils literal"><span class="pre">jsbuild</span></code> mobile config file (<code class="docutils literal"><span class="pre">jsbuild/mobile2.cfg</span></code>).</p>
<p>You also need to add <code class="docutils literal"><span class="pre">jsbuild-mobile2</span></code> and <code class="docutils literal"><span class="pre">mobile2</span></code> to the list
of parts that are run by Buildout by default:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">buildout</span><span class="p">]</span>
<span class="n">extends</span> <span class="o">=</span> <span class="n">CONST_buildout</span><span class="o">.</span><span class="n">cfg</span>
<span class="n">parts</span> <span class="o">+=</span> <span class="n">jsbuild</span><span class="o">-</span><span class="n">mobile</span> <span class="n">mobile</span> <span class="n">jsbuild</span><span class="o">-</span><span class="n">mobile2</span> <span class="n">mobile2</span>
</pre></div>
</div>
<p>At this point you should be able to successfully run Buildout again.</p>
</li>
<li><p class="first">The mobile routes and views should be duplicated.</p>
<p>For that edit the application&#8217;s main <code class="docutils literal"><span class="pre">__init__.py</span></code> file and copy the entire
<code class="docutils literal"><span class="pre">#</span> <span class="pre">mobile</span> <span class="pre">views</span> <span class="pre">and</span> <span class="pre">routes</span></code> block, and paste it right below the original.
Now change the route names, for example from <code class="docutils literal"><span class="pre">mobile_index_dev</span></code> to
<code class="docutils literal"><span class="pre">mobile_index_dev2</span></code>. Change the route URLs, for example from
<code class="docutils literal"><span class="pre">/mobile_dev/</span></code> to <code class="docutils literal"><span class="pre">/mobile_dev2/</span></code>. Change the paths to the templates
files, for example from
<code class="docutils literal"><span class="pre">renderer='&lt;package&gt;:static/mobile/index.html'</span></code> to
<code class="docutils literal"><span class="pre">renderer='&lt;package&gt;:static/mobile2/index.html'</span></code>.  Do this for every
route and view.</p>
<p>You should be done.</p>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/camptocamp.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Mobile Applications</a><ul>
<li><a class="reference internal" href="#infrastructure">Infrastructure</a></li>
<li><a class="reference internal" href="#adding-mobile-routes-and-views">Adding mobile routes and views</a></li>
<li><a class="reference internal" href="#building-the-mobile-application">Building the mobile application</a></li>
<li><a class="reference internal" href="#configuring-the-map-and-the-layers">Configuring the map and the layers</a><ul>
<li><a class="reference internal" href="#theme">Theme</a></li>
</ul>
</li>
<li><a class="reference internal" href="#raster-service">Raster service</a></li>
<li><a class="reference internal" href="#permalink-crosshair">Permalink crosshair</a></li>
<li><a class="reference internal" href="#settings-view">Settings view</a><ul>
<li><a class="reference internal" href="#permalink">Permalink</a></li>
<li><a class="reference internal" href="#login-logout">Login/logout</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multiple-mobile-applications">Multiple mobile applications</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Integrator Guide</a><ul>
      <li>Previous: <a href="raster.html" title="previous chapter">Digital Elevation Tools</a></li>
      <li>Next: <a href="internationalization.html" title="next chapter">Internationalization</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/integrator/mobile.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2014, Camptocamp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="../_sources/integrator/mobile.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/camptocamp/c2cgeoportal" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>