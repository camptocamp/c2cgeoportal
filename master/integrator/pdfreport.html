
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>PDF Reporting &#8212; c2cgeoportal  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/c2c.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Routing interface" href="routing.html" />
    <link rel="prev" title="URL login" href="urllogin.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pdf-reporting">
<span id="integrator-pdfreport"></span><h1>PDF Reporting<a class="headerlink" href="#pdf-reporting" title="Permalink to this headline">¶</a></h1>
<p>c2cgeoportal offers a <em>pdfreport</em> webservice that can be used to generate
advanced PDF reports about a given feature.</p>
<p>It is based upon <a class="reference external" href="https://mapfish.github.io/mapfish-print-doc/">Mapfish Print version 3</a>
and <a class="reference external" href="https://community.jaspersoft.com/project/jasperreports-library">Jasper Reports</a>.</p>
<p>The webservice is called using the following URL schema:
<code class="docutils literal notranslate"><span class="pre">https://&lt;host&gt;&lt;entrypoint&gt;/pdfreport/&lt;layername&gt;/&lt;featureid&gt;</span></code>.</p>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>The service is configured in the main <code class="docutils literal notranslate"><span class="pre">vars.yaml</span></code> file of the project, as shown in the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">vars</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="n">pdfreport</span><span class="p">:</span>
        <span class="n">print_url</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{print_url}</span><span class="s1">&#39;</span>
        <span class="n">layer</span><span class="o">-</span><span class="n">defaults</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">pdfreport</span><span class="o">-</span><span class="n">layer</span><span class="o">-</span><span class="n">default</span>
            <span class="n">ogcserver</span><span class="p">:</span> <span class="n">source</span> <span class="k">for</span> <span class="n">image</span><span class="o">/</span><span class="n">png</span>
            <span class="n">check_credentials</span><span class="p">:</span> <span class="kc">True</span>
            <span class="n">srs</span><span class="p">:</span> <span class="n">EPSG</span><span class="p">:</span><span class="mi">2056</span>
            <span class="nb">map</span><span class="p">:</span>
                <span class="n">backgroundlayers</span><span class="p">:</span> <span class="p">[</span><span class="n">grp_ly_tilegenerierung_landeskarte</span><span class="p">]</span>
                <span class="n">imageformat</span><span class="p">:</span> <span class="n">image</span><span class="o">/</span><span class="n">png</span>
        <span class="nb">map</span><span class="o">-</span><span class="n">defaults</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">pdfreport</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="n">default</span>
            <span class="n">backgroundlayers</span><span class="p">:</span> <span class="p">[]</span>
            <span class="n">imageformat</span><span class="p">:</span> <span class="n">image</span><span class="o">/</span><span class="n">png</span>
            <span class="n">zoomType</span><span class="p">:</span> <span class="n">extent</span>
            <span class="n">minScale</span><span class="p">:</span> <span class="mi">1000</span>
            <span class="n">style</span><span class="p">:</span>
                <span class="n">fillColor</span><span class="p">:</span> <span class="n">red</span>
                <span class="n">fillOpacity</span><span class="p">:</span> <span class="mf">0.2</span>
                <span class="n">symbolizers</span><span class="p">:</span>
                <span class="o">-</span>   <span class="n">strokeColor</span><span class="p">:</span> <span class="n">red</span>
                    <span class="n">strokeWidth</span><span class="p">:</span> <span class="mi">1</span>
                    <span class="nb">type</span><span class="p">:</span> <span class="n">point</span>
                    <span class="n">pointRadius</span><span class="p">:</span> <span class="mi">10</span>
        <span class="n">layers</span><span class="p">:</span>
            <span class="n">ly_a020_belastete_standorte_point</span><span class="p">:</span>
                <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">pdfreport</span><span class="o">-</span><span class="n">layer</span><span class="o">-</span><span class="n">default</span>
                <span class="nb">map</span><span class="p">:</span>
                    <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">pdfreport</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="n">default</span>
                    <span class="n">backgroundlayers</span><span class="p">:</span>
                        <span class="o">-</span> <span class="n">grp_ly_tilegenerierung_landeskarte</span>
                        <span class="o">-</span> <span class="n">ly_a020_belastete_standorte_point</span>
                    <span class="n">imageformat</span><span class="p">:</span> <span class="n">image</span><span class="o">/</span><span class="n">jpeg</span>
            <span class="n">some_template_with_no_map</span><span class="p">:</span>
                <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">pdfreport</span><span class="o">-</span><span class="n">layer</span><span class="o">-</span><span class="n">default</span>
                <span class="n">spec</span><span class="p">:</span>
                    <span class="n">layout</span><span class="p">:</span> <span class="n">some_template_name</span>
                    <span class="n">outputFormat</span><span class="p">:</span> <span class="n">pdf</span>
                    <span class="n">attributes</span><span class="p">:</span>
                        <span class="n">ids</span><span class="p">:</span> <span class="o">%</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span><span class="n">s</span>
            <span class="n">some_template_with_multi_map</span><span class="p">:</span>
                <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">pdfreport</span><span class="o">-</span><span class="n">layer</span><span class="o">-</span><span class="n">default</span>
                <span class="n">maps</span><span class="p">:</span>
                    <span class="o">-</span>   <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">pdfreport</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="n">default</span>
                        <span class="n">backgroundlayers</span><span class="p">:</span>
                            <span class="o">-</span> <span class="n">grp_ly_tilegenerierung_landeskarte</span>
                    <span class="o">-</span>   <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">pdfreport</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="n">default</span>
                        <span class="n">backgroundlayers</span><span class="p">:</span>
                            <span class="o">-</span> <span class="n">ly_a020_belastete_standorte_point</span>
<span class="n">update_paths</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">pdfreport</span>
</pre></div>
</div>
<p>Regarding the configuration parameters,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">print_url</span></code> is the local URL of the MapFish Print instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">defaults</span></code> contains the default values of parameters not provided explicitly for a given layer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">layers</span></code> is an optional per-layer list of settings specific to the listed layers. The entries of the
list are the layernames provided as argument of the webservice. If a layer is not listed, the default
parameters above are used.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">defaults</span></code> and <code class="docutils literal notranslate"><span class="pre">layers</span></code>-specific parameters are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ogcserver</span></code>: the name of OGC server to use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">check_credentials</span></code>: boolean, defines whether layer credentials are checked before generating the report.
Defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">srs</span></code>: projection code (required when showing the map).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spec</span></code>: optional template used to build the <code class="docutils literal notranslate"><span class="pre">spec</span></code> argument sent to the MapFish Print webapp.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">map</span></code>: optional, the map configuration.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maps</span></code>: optional, a list of map configurations.</p></li>
</ul>
<p>The map configuration can contains the following:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">backgroundlayers</span></code>: string containing a comma-separated list of WMS layers that should be displayed on
the map. If the current layer must also be displayed, it should be added to the list. Please note that
layernames must be embedded in double-quotes (“). Defaults to <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">imageformat</span></code>: format of the generated map. Defaults to <code class="docutils literal notranslate"><span class="pre">image/png</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zoomType</span></code>: The type of zoom, default is <code class="docutils literal notranslate"><span class="pre">extent</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">minScale</span></code>: The minimum zoom scale, default is <code class="docutils literal notranslate"><span class="pre">1000</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">style</span></code>: The style used, default is:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">fillColor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">red</span><span class="w"></span>
<span class="nt">fillOpacity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.2</span><span class="w"></span>
<span class="nt">symbolizers</span><span class="p">:</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">strokeColor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">red</span><span class="w"></span>
<span class="w">  </span><span class="nt">strokeWidth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">point</span><span class="w"></span>
<span class="w">  </span><span class="nt">pointRadius</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"></span>
</pre></div>
</div>
</li>
</ul>
<p>The variables are passed to the <code class="docutils literal notranslate"><span class="pre">spec</span></code> template using the <code class="docutils literal notranslate"><span class="pre">%(&lt;variable</span> <span class="pre">name&gt;)s</span></code> syntax:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">layername</span></code>: name of the layer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ids</span></code>: JSON representation of the features id.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">srs</span></code>: projection code.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mapserv_url</span></code>: URL of the MapServer proxy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vector_request_url</span></code>: URL of the WFS GetFeature request retrieving the feature geometry in GML.</p></li>
</ul>
</section>
<section id="configuration-of-the-reports">
<h2>Configuration of the reports<a class="headerlink" href="#configuration-of-the-reports" title="Permalink to this headline">¶</a></h2>
<p>If you use the <code class="docutils literal notranslate"><span class="pre">ids</span></code> in an SQL query, you should use <code class="docutils literal notranslate"><span class="pre">$X{IN,</span> <span class="pre">&lt;column_name&gt;,</span> <span class="pre">$P{ids}}</span></code>
to avoid SQL injection, <a class="reference external" href="https://jasperreports.sourceforge.net/sample.reference/query/">see also the JasperReports documentation</a>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/camptocamp.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">c2cgeoportal</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=camptocamp&repo=c2cgeoportal&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../administrator/index.html">Administrator Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Integrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Guide</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Integrator Guide</a><ul>
  <li><a href="features.html">Additional features</a><ul>
      <li>Previous: <a href="urllogin.html" title="previous chapter">URL login</a></li>
      <li>Next: <a href="routing.html" title="next chapter">Routing interface</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2021, Camptocamp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/integrator/pdfreport.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/camptocamp/c2cgeoportal" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>