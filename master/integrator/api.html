<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>JavaScript API &#8212; c2cgeoportal  documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="HTTPS" href="https.html" />
    <link rel="prev" title="Print" href="print.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="javascript-api">
<span id="integrator-api"></span><h1>JavaScript API<a class="headerlink" href="#javascript-api" title="Permalink to this headline">¶</a></h1>
<p>Any c2cgeoportal application exposes a JavaScript API. This API can be used in
third-party applications, like CMS applications. A c2cgeoportal application
actually exposes two JavaScript APIs: the <em>Simple</em> API, and the <em>Extended</em> API.
Both expose the same programming interface.</p>
<p><strong>Simple API</strong></p>
<blockquote>
<div><p>The Simple API does not include any Ext-related code, it is based on
OpenLayers only. This API is to be used when a <em>simple</em> map only is needed.
Also, the Simple API works in touch devices, while the Extended API does
not.</p>
<p>To load the Simple API in a page the following script tag should be added:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;http://example.com/path-to-wsgi-app/api.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Extended API</strong></p>
<blockquote>
<div><p>The Extended API is based on the CGXP stack (Ext/GeoExt/GXP) and plugins,
just like the main (desktop) viewer. It provides more functionality than
the Simple API, but it is heavier than the Simple API, and does not on
mobile.</p>
<p>To load the Extended API in a page the following script tag should be
added:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;http://example.com/path-to-wsgi-app/xapi.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">CGXP commit <a class="reference external" href="https://github.com/camptocamp/cgxp/commit/5c0628d05f4239ebf45419b19140badda9046c8b">5c0628d</a>
or better is required in the project for the APIs.</p>
</div>
<div class="section" id="updating-an-existing-project">
<h2>Updating an existing project<a class="headerlink" href="#updating-an-existing-project" title="Permalink to this headline">¶</a></h2>
<p>You can skip this section if your project has been created using c2cgeoportal
1.2 or better. If your project was created using an older c2cgeoportal, and if
you have just upgraded your project to c2cgeoportal 1.2, then you need to follow
the below instructions.</p>
<p>New directories and files are provided by the <code class="docutils literal"><span class="pre">c2cgeoportal_create</span></code> and need
to be added manually to the project. The easiest way to get all the necessary
files involves creating a temporary c2cgeoportal project of the same name as
the target project, and copying the missing files from there:</p>
<pre class="highlight"><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1"><span class="nb">cd</span> &lt;project&gt;</span>
<span class="prompt1">.build/venv/bin/pcreate -s c2cgeoportal_create <span class="se">\</span>
        /tmp/&lt;project&gt; --package-name &lt;package&gt;</span>
<span class="prompt1">cp -r /tmp/&lt;project&gt;/&lt;package&gt;/templates/api &lt;project&gt;/templates/</span>
<span class="prompt1">cp -r /tmp/&lt;project&gt;/&lt;package&gt;/static/apihelp &lt;project&gt;/static/</span>
<span class="prompt1">rm -rf /tmp/&lt;project&gt;</span>
</pre></div>
<div class="section" id="configuring-the-api">
<h2>Configuring the API<a class="headerlink" href="#configuring-the-api" title="Permalink to this headline">¶</a></h2>
<p>As the integrator you will edit four Mako template files to configure the
APIs:</p>
<p><code class="docutils literal"><span class="pre">&lt;package&gt;/templates/api/mapconfig.js</span></code></p>
<blockquote>
<div>Includes the map configuration, i.e. the resolutions, the base layers, the
controls, etc. Used for both the Simple and the Extended APIs.</div></blockquote>
<p><code class="docutils literal"><span class="pre">&lt;package&gt;/templates/api/viewer.js</span></code></p>
<blockquote>
<div>Contains the GXP/CGXP viewer and plugins configuration. Used for the
Extended API only.</div></blockquote>
<div class="section" id="gotchas-limitations-and-hints">
<h3>Gotchas, limitations and hints<a class="headerlink" href="#gotchas-limitations-and-hints" title="Permalink to this headline">¶</a></h3>
<p>Below are a few things that c2cgeoportal integrators should know and take into
account when setting up their projects&#8217; APIs.</p>
<p>Background/base layers</p>
<blockquote>
<div><p>Several notes about background/base layers.</p>
<p>As mentioned already the background/base layers are defined in the map
configuration, in <code class="docutils literal"><span class="pre">&lt;package&gt;/templates/api/mapconfig.js</span></code>.</p>
<p>Any <code class="docutils literal"><span class="pre">displayLayerSwitcher</span></code> option set in the <code class="docutils literal"><span class="pre">args</span></code> property of the
base layers defined in the map config is ignored. The API itself is
responsible for setting this option. The Simple API sets
<code class="docutils literal"><span class="pre">displayLayerSwitcher</span></code> to <code class="docutils literal"><span class="pre">true</span></code>, while the Extended API sets it to
<code class="docutils literal"><span class="pre">false</span></code>.</p>
<p>To control the display of base layers through the UI when the Extended API
is used the <code class="docutils literal"><span class="pre">MapOpacitySlider</span></code> plugin should be set in the viewer. The
OpenLayers <code class="docutils literal"><span class="pre">LayerSwitcher</span></code> control will indeed not include base layers
(and radio buttons) in the case of the Extended API.</p>
<p>The API user can also have some control on his map&#8217;s base layers, through
the <code class="docutils literal"><span class="pre">backgroundLayers</span></code> option, which is optional.</p>
<p>The <code class="docutils literal"><span class="pre">backgroundLayers</span></code> option references an array of layer
names/references, which should correspond to the <code class="docutils literal"><span class="pre">ref</span></code> values in the map
config.</p>
<p>The <code class="docutils literal"><span class="pre">backgroundLayers</span></code> option determines the set of layers to add to the
map. It also determines the order of layers in the map, but the behavior is
different in API and XAPI.</p>
<p>For the Simple API every layer in the map config is an OpenLayers base
layer. By setting <code class="docutils literal"><span class="pre">backgroundLayers</span></code> the API user specifies the base
layers the map will work with, and the order of the base layers in the
map&#8217;s layers array.  The first layer in the <code class="docutils literal"><span class="pre">backgroundLayers</span></code> option is
the base layer that will be displayed by default.</p>
<p>For the Extended API, if the viewer includes a map opacity slider plugin
(<code class="docutils literal"><span class="pre">cgxp_mapopacityslider</span></code>), the backgroundLayers option has no effect on
the layer order, and the background layer that is displayed by default.
When the viewer includes a map opacity slider plugin the &#8220;background layer
behavior&#8221; is indeed entirely determined by the plugin, and the user that
controls the plugin through the UI.</p>
<p>If the map opacity slider plugin (<code class="docutils literal"><span class="pre">cgxp_mapopacityslider</span></code>) is enabled,
the layer visibility is managed by the plugin. Else the  layer
<code class="docutils literal"><span class="pre">visibility</span></code> must be set  to <code class="docutils literal"><span class="pre">true</span></code> in
<code class="docutils literal"><span class="pre">&lt;package&gt;/templates/api/mapconfig.js</span></code>.</p>
<p>When the viewer does not include a map opacity slider plugin the
<code class="docutils literal"><span class="pre">backgroundLayers</span></code> option determines the order of layers in the map/layer
store. But the layers marked as background layers in the map config are
always before the other layers (non-background layers) in the map/layer
store.</p>
</div></blockquote>
<p>Layer tree</p>
<blockquote>
<div>Using the <code class="docutils literal"><span class="pre">LayerTree</span></code> plugin in the API viewer is highly discouraged.
The API user (application developer) is responsible for declaring the
layers he wants in his map. Adding a <code class="docutils literal"><span class="pre">LayerTree</span></code> plugin would conflict
with that behavior, as the <code class="docutils literal"><span class="pre">LayerTree</span></code> plugin adds layers to the map
based on the <code class="docutils literal"><span class="pre">THEMES</span></code> configuration.</div></blockquote>
<p>Plugins compatible with the API</p>
<blockquote>
<div><p>Here is the list of CGXP plugins that are known to currently work with the
Extended API:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">FullTextSearch</span></code></li>
<li><code class="docutils literal"><span class="pre">Legend</span></code></li>
<li><code class="docutils literal"><span class="pre">MapOpacitySlider</span></code></li>
<li><code class="docutils literal"><span class="pre">Measure</span></code></li>
<li><code class="docutils literal"><span class="pre">MenuShortcut</span></code></li>
<li><code class="docutils literal"><span class="pre">Zoom</span></code></li>
<li><code class="docutils literal"><span class="pre">ZoomToExtent</span></code></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="css">
<h2>CSS<a class="headerlink" href="#css" title="Permalink to this headline">¶</a></h2>
<p>Any c2cgeoportal application has its own CSS styles in
<code class="docutils literal"><span class="pre">&lt;package&gt;/static/css/proj.css</span></code>, <code class="docutils literal"><span class="pre">&lt;package&gt;/static/css/proj-map.css</span></code>, and
<code class="docutils literal"><span class="pre">&lt;package&gt;/static/css/proj-widgets.css</span></code>. For the APIs it is important
that these files have appropriate contents.</p>
<p><code class="docutils literal"><span class="pre">&lt;package&gt;/static/css/proj.css</span></code></p>
<blockquote>
<div>This file includes CSS that is specific to the application viewers. This
file is not used for the APIs, so it should not contain CSS that pertains
to OpenLayers and CGXP components used by the Simple and Extended APIs.</div></blockquote>
<p><code class="docutils literal"><span class="pre">&lt;package&gt;/static/css/proj-map.css</span></code></p>
<blockquote>
<div>This file should include CSS that is relative to the OpenLayers map. This
file is used by the Simple API. It should include OpenLayers-specific CSS,
and should not include Ext-related CSS.</div></blockquote>
<p><code class="docutils literal"><span class="pre">&lt;package&gt;/static/css/proj-widgets.css</span></code></p>
<blockquote>
<div>This file should include CSS for CGXP plugins/components used by the
Extended API. This file is not used by the Simple API.</div></blockquote>
</div>
<div class="section" id="internationalization">
<span id="integrator-api-i18n"></span><h2>Internationalization<a class="headerlink" href="#internationalization" title="Permalink to this headline">¶</a></h2>
<p>The Simple API loads the files <code class="docutils literal"><span class="pre">&lt;package&gt;/static/js/Proj/Lang/&lt;code&gt;.js</span></code>
(where <code class="docutils literal"><span class="pre">&lt;code&gt;</span></code> is the language code, <code class="docutils literal"><span class="pre">fr</span></code> for example). This means that
these files should not include GeoExt-based translations. More specifically
they should use <code class="docutils literal"><span class="pre">OpenLayers.Util.extend(OpenLayers.Lang.&lt;code&gt;,</span> <span class="pre">{})</span></code> and they
should not use <code class="docutils literal"><span class="pre">GeoExt.Lang.add(&quot;&lt;code&gt;&quot;,</span> <span class="pre">{})</span></code>. GeoExt-based translations
should go in <code class="docutils literal"><span class="pre">&lt;package&gt;/static/js/Proj/Lang/GeoExt-&lt;code&gt;.js</span></code> files, which
are used for the application viewers and for the Extended API.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/camptocamp.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">JavaScript API</a><ul>
<li><a class="reference internal" href="#updating-an-existing-project">Updating an existing project</a></li>
<li><a class="reference internal" href="#configuring-the-api">Configuring the API</a><ul>
<li><a class="reference internal" href="#gotchas-limitations-and-hints">Gotchas, limitations and hints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#css">CSS</a></li>
<li><a class="reference internal" href="#internationalization">Internationalization</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Integrator Guide</a><ul>
  <li><a href="features.html">Additional features</a><ul>
      <li>Previous: <a href="print.html" title="previous chapter">Print</a></li>
      <li>Next: <a href="https.html" title="next chapter">HTTPS</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/integrator/api.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2016, Camptocamp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/integrator/api.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/camptocamp/c2cgeoportal" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>