<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Create a cluster &mdash; c2cgeoportal  documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="c2cgeoportal  documentation" href="../index.html" />
    <link rel="up" title="Integrator Guide" href="index.html" />
    <link rel="next" title="Specific Backend Documentation" href="backend.html" />
    <link rel="prev" title="Internationalization" href="internationalization.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="create-a-cluster">
<span id="integrator-cluster"></span><h1>Create a cluster<a class="headerlink" href="#create-a-cluster" title="Permalink to this headline">Â¶</a></h1>
<p>A cluster is a configuration where several servers are used to serve the application
in production.</p>
<p>Creating a cluster implies to separate the database and the application to
make sure that the data are the same on all servers.</p>
<p>A possibility is to have the same database for all servers (integration, production).
A single schema for static data is shared, whereas a dedicated main schema will
be used for each server.</p>
<p>Deploying data from integration to production may be done by
<a class="reference external" href="https://wiki.postgresql.org/wiki/Clone_schema">cloning the main integration schema</a>.</p>
<p>For the next steps it is important to figure out if the main goal is the scalability
or the robustness of the application.</p>
<p>In general the scalability is more important because the main cause of
down time is due of too much traffic.</p>
<p>In this case the first thing to do is to separate the services:</p>
<blockquote>
<div><ul class="simple">
<li>PostgreSQL / PostGIS</li>
<li>Print</li>
<li>WSGI application</li>
<li>MapServer / MapCache / Memcached</li>
</ul>
</div></blockquote>
<p>To have better DB performances, one can setup multiple Postgres servers in a
<a class="reference external" href="https://wiki.postgresql.org/wiki/Binary_Replication_Tutorial">master/replica</a>
configuration. To enable this feature on GeoMapFish, you must add this to your
<code class="docutils literal"><span class="pre">vars_&lt;project&gt;.yaml</span></code>:</p>
<div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">dbhost_replica</span><span class="p">:</span> <span class="n">my_db_replica_hostname</span>
<span class="n">sqlalchemy_replica</span><span class="p">:</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">postgresql</span><span class="p">:</span><span class="o">//</span><span class="p">{</span><span class="n">dbuser</span><span class="p">}:{</span><span class="n">dbpassword</span><span class="p">}</span><span class="o">@</span><span class="p">{</span><span class="n">dbhost_replica</span><span class="p">}:{</span><span class="n">dbport</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">db</span><span class="p">}</span>
</pre></div>
</div>
<p>Add in your project Makefile <code class="docutils literal"><span class="pre">&lt;package&gt;.mk</span></code>:</p>
<div class="code makefile highlight-default"><div class="highlight"><pre><span></span><span class="n">CONFIG_VARS</span> <span class="o">+=</span> <span class="n">sqlalchemy_replica</span><span class="o">.</span><span class="n">url</span>
</pre></div>
</div>
<p>Then, all the GET and OPTIONS requests will use one of the replica Postgres instances and the
rest will use the master instance.
It is assumed, here, that the views handling the GET and OPTIONS queries don&#8217;t cause write
operations to the database (not supported by replica instances). If it is not the case in your
application (bad practice), add entries to <code class="docutils literal"><span class="pre">db_chooser/master</span></code> in your <code class="docutils literal"><span class="pre">vars_&lt;project&gt;.yaml</span></code>.
For forcing the use of a replica for a POST/PUT/DELETE, add entries to the <code class="docutils literal"><span class="pre">db_chooser/replica</span></code>
configuration.</p>
<p>For having more than one instance of replica and having an automatic election of a new
master in case of failure, you must setup an high availability proxy (HAProxy, for example).
This is out of the scope of this document. If you don&#8217;t care about failover, you can use one
DNS entry with multiple IP entries for the replicas.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/camptocamp.png" alt="Logo"/>
            </a></p><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Integrator Guide</a><ul>
      <li>Previous: <a href="internationalization.html" title="previous chapter">Internationalization</a></li>
      <li>Next: <a href="backend.html" title="next chapter">Specific Backend Documentation</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/integrator/cluster.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2016, Camptocamp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../_sources/integrator/cluster.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/camptocamp/c2cgeoportal" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>