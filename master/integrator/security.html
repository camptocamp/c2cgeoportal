
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Security &#8212; c2cgeoportal  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Additional features" href="features.html" />
    <link rel="prev" title="Customise the application" href="customise.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="security">
<span id="integrator-security"></span><h1>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h1>
<div class="section" id="authentication">
<h2>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-default-policy">
<h3>The default policy<a class="headerlink" href="#the-default-policy" title="Permalink to this headline">¶</a></h3>
<p>By default, <code class="docutils literal notranslate"><span class="pre">c2cgeoportal</span></code> applications use an <em>auth ticket</em> authentication
policy (<code class="docutils literal notranslate"><span class="pre">AuthTktAuthenticationPolicy</span></code>). With this policy, the user name is
obtained from the “auth ticket” cookie set in the request.
The policy is created, and added to the application’s configuration, in the
application’s main <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file.</p>
</div>
<div class="section" id="using-another-policy">
<h3>Using another policy<a class="headerlink" href="#using-another-policy" title="Permalink to this headline">¶</a></h3>
<p>When using <code class="docutils literal notranslate"><span class="pre">AuthTktAuthenticationPolicy</span></code>, an “auth ticket” cookie should be
set in the request for the user to be identified. In some applications, using
a custom identification mechanism may be needed instead, for instance to use SSO.
Our knowledge base has an example of how this can be achieved.</p>
</div>
<div class="section" id="user-validation">
<h3>User validation<a class="headerlink" href="#user-validation" title="Permalink to this headline">¶</a></h3>
<p>For logging in, <code class="docutils literal notranslate"><span class="pre">c2cgeoportal</span></code> validates the user credentials
(username/password) by reading the user information from the <code class="docutils literal notranslate"><span class="pre">user</span></code> database
table. If a c2cgeoportal application should work with another user information
source, like LDAP, a custom <em>client validation</em> mechanism can be set up.
Our knowledge base has an example of how this can be achieved.</p>
</div>
</div>
<div class="section" id="https">
<h2>HTTPS<a class="headerlink" href="#https" title="Permalink to this headline">¶</a></h2>
<p>If your application is accessed in HTTPS, you have to make sure that all URLs
generated by the application (CSS and Javascript files, images, MapServer
requests, etc.) use the HTTPS scheme as well. Otherwise the browser will
prompt “unsecure content” warnings.</p>
<p>There are two ways to manage this:</p>
<ul class="simple">
<li>application behind a proxy</li>
<li>application and SSL certificate on the same server</li>
</ul>
<div class="section" id="application-behind-a-proxy">
<h3>Application behind a proxy<a class="headerlink" href="#application-behind-a-proxy" title="Permalink to this headline">¶</a></h3>
<p>If the application is placed behind some proxy that removes the SSL encryption
(plain HTTP is used between the proxy and the server) then some specific
configuration is required both on the c2cgeoportal application, and on the
proxy:</p>
<ul>
<li><p class="first">The proxy should add a specific header to the requests. For example <code class="docutils literal notranslate"><span class="pre">X-Https</span>
<span class="pre">on</span></code> (<code class="docutils literal notranslate"><span class="pre">X-Https</span></code> is the header name, and <code class="docutils literal notranslate"><span class="pre">on</span></code> is the header value).</p>
</li>
<li><p class="first">To make c2cgeoportal generate HTTPS URLs when requests with this header are
received you will set the <cite>HTTPS</cite> environment variable by adding the
following in the <code class="docutils literal notranslate"><span class="pre">apache/wsgi.conf.mako</span></code> file in the <code class="docutils literal notranslate"><span class="pre">&lt;location</span> <span class="pre">...&gt;</span></code>
section, in our example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SetEnvIf</span>    <span class="n">X</span><span class="o">-</span><span class="n">Https</span> <span class="n">on</span> <span class="n">HTTPS</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
</li>
</ul>
<p>In Mako templates, if you need to know what scheme is used, you may test the
value of <code class="docutils literal notranslate"><span class="pre">request.scheme</span></code>. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">WMTS_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
<span class="o">%</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s1">&#39;https&#39;</span><span class="p">:</span>
    <span class="n">url</span><span class="p">:</span> <span class="s1">&#39;https://my.wmts.server/&#39;</span>
<span class="o">%</span> <span class="k">else</span><span class="p">:</span>
    <span class="n">url</span><span class="p">:</span> <span class="s1">&#39;http://my.wmts.server/&#39;</span>
<span class="o">%</span> <span class="n">endif</span>
<span class="o">/*</span> <span class="o">...</span> <span class="o">*/</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="application-and-ssl-certificate-on-the-same-server">
<h3>Application and SSL certificate on the same server<a class="headerlink" href="#application-and-ssl-certificate-on-the-same-server" title="Permalink to this headline">¶</a></h3>
<p>If the SSL certificate and the application are located on the same server, all
requests will be redirect to https. So you should change the scheme to https
for all url except for some parameters that should always use http (actually
all request on localhost): <em>url</em> parameter in tilegeneration configuration.</p>
<p>If you apply ssl encryption on your application, you should take care of the
tiles url to use https scheme to avoid secure and insecure contents: change
<em>tiles_url</em> in the vars_xxx.yaml file.</p>
<p>Finally, you should redirect all http request to https scheme. On Camptocamp’s
server, this should be asked to our sysadmin team.</p>
<p>In case you load http external resources into your application, you should use
resourceproxy service as described below.</p>
</div>
<div class="section" id="loading-non-https-external-resources">
<h3>Loading non https external resources<a class="headerlink" href="#loading-non-https-external-resources" title="Permalink to this headline">¶</a></h3>
<p>If you want to load non https external resources in your https application, you
must use the resourceproxy service and add the list of hosts you want to access
in your project <cite>vars_&lt;project&gt;.yaml</cite> configuration file:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span>resourceproxy:
    # list of urls from which it is safe to load content
    targets:
      #exempletargetname: http://www.camptocamp.com/?param1=%s&amp;param2=%s
      rfinfo: http://www.rfinfo.vd.ch/rfinfo.php?no_commune=%s&amp;no_immeuble=%s
</pre></div>
</div>
<p>Then you can access resources by building urls using the following schema:
<code class="docutils literal notranslate"><span class="pre">http://&lt;host&gt;/wsgi/resourceproxy?target=&lt;targetname&gt;&amp;values=(&lt;valueparam1&gt;,...)</span></code>.</p>
<p>For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">http://geoportail.camptocamp.com/main/wsgi/resourceproxy?target=rfinfo&amp;values=(175,2633)</span></code></p>
</div>
</div>
<div class="section" id="reset-password">
<h2>Reset password<a class="headerlink" href="#reset-password" title="Permalink to this headline">¶</a></h2>
<p>When a user has forgotten his/her password, a new one may be sent by email if some additional
GeoMapFish configuration is provided.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">&lt;package&gt;/template/*.js</span></code> files, in the <code class="docutils literal notranslate"><span class="pre">cgxp_login</span></code> plugin you should add the
service URL with the following configuration:</p>
<div class="code javascript highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">loginResetPasswordURL</span><span class="p">:</span> <span class="s2">&quot;${request.route_url(&#39;loginresetpassword&#39;) | n}&quot;</span><span class="p">,</span>
</pre></div>
</div>
<p>And to generate the required e-mail, in the <code class="docutils literal notranslate"><span class="pre">vars_&lt;package&gt;.yaml</span></code> file, add the following configuration:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># SMTP configuration could be already there if needed by other feature</span>
<span class="n">smtp</span><span class="p">:</span>
    <span class="n">host</span><span class="p">:</span> <span class="n">smtp</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">465</span>
    <span class="n">ssl</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">user</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span>
    <span class="n">password</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span>
    <span class="n">starttls</span><span class="p">:</span> <span class="n">false</span>

<span class="n">reset_password</span><span class="p">:</span>
    <span class="c1"># Used to send a confirmation email</span>
    <span class="n">email_from</span><span class="p">:</span> <span class="n">info</span><span class="nd">@camptocamp</span><span class="o">.</span><span class="n">com</span>
    <span class="n">email_subject</span><span class="p">:</span> <span class="n">New</span> <span class="n">password</span> <span class="n">generated</span> <span class="k">for</span> <span class="n">GeoMapFish</span>
    <span class="n">email_body</span><span class="p">:</span> <span class="o">|</span>
        <span class="n">Hello</span> <span class="p">{</span><span class="n">user</span><span class="p">},</span>

        <span class="n">You</span> <span class="n">have</span> <span class="n">asked</span> <span class="k">for</span> <span class="n">an</span> <span class="n">new</span> <span class="n">password</span><span class="p">,</span>
        <span class="n">the</span> <span class="n">newly</span> <span class="n">generated</span> <span class="n">password</span> <span class="ow">is</span><span class="p">:</span> <span class="p">{</span><span class="n">password</span><span class="p">}</span>

        <span class="n">Sincerely</span> <span class="n">yours</span>
        <span class="n">The</span> <span class="n">GeoMapfish</span> <span class="n">team</span>
</pre></div>
</div>
<p>If the SMTP host ends with a colon (<cite>:</cite>) followed by a number, and
there is no port specified, that suffix will be stripped off and the
number interpreted as the port number to use.</p>
<p>Replace the <code class="docutils literal notranslate"><span class="pre">smtp.example.com</span></code> value by a working SMTP server name.</p>
</div>
<div class="section" id="access-to-wms-getcapability">
<h2>Access to WMS GetCapability<a class="headerlink" href="#access-to-wms-getcapability" title="Permalink to this headline">¶</a></h2>
<p>Set <code class="docutils literal notranslate"><span class="pre">hide_capabilities</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> in your <code class="docutils literal notranslate"><span class="pre">vars_&lt;project&gt;.yaml</span></code> to disable
the WMS GetCapability when accessing the Mapserver proxy (mapserverproxy).</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
</div>
<div class="section" id="access-to-the-admin-interface">
<h2>Access to the admin interface<a class="headerlink" href="#access-to-the-admin-interface" title="Permalink to this headline">¶</a></h2>
<p>To disable the admin interface, set <code class="docutils literal notranslate"><span class="pre">enable_admin_interface</span></code> to <code class="docutils literal notranslate"><span class="pre">false</span></code>
in your <code class="docutils literal notranslate"><span class="pre">vars_&lt;project&gt;.yaml</span></code> file.</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">true</span></code></p>
</div>
<div class="section" id="access-to-the-ogc-proxy">
<h2>Access to the OGC proxy<a class="headerlink" href="#access-to-the-ogc-proxy" title="Permalink to this headline">¶</a></h2>
<p>To enable the OGC proxy, set <code class="docutils literal notranslate"><span class="pre">ogcproxy_enable</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> in your
<code class="docutils literal notranslate"><span class="pre">vars_&lt;project&gt;.yaml</span></code> file.</p>
<p>Default: <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
<p>And adding the <code class="docutils literal notranslate"><span class="pre">papyrus_ogcproxy</span></code> package in the <code class="docutils literal notranslate"><span class="pre">install_requires</span></code> of the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">viewer.js</span></code> files you should also add the <code class="docutils literal notranslate"><span class="pre">OpenLayers.ProxyHost</span></code> configuration:</p>
<div class="code javascript highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OpenLayers</span><span class="o">.</span><span class="n">ProxyHost</span> <span class="o">=</span> <span class="s2">&quot;${request.route_url(&#39;ogcproxy&#39;) | n}?url=&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Working without this proxy implies that all external WMS services (from the database and from the WMS browser) should
have the CORS headers (<a class="reference external" href="http://enable-cors.org/server.html">enable-cors.org</a>).</p>
</div>
<div class="section" id="access-to-services-by-external-servers">
<h2>Access to services by external servers<a class="headerlink" href="#access-to-services-by-external-servers" title="Permalink to this headline">¶</a></h2>
<p>By default, only localhost can access c2c’s services.
To permit access to a specific service by an external server, you must set headers CORS (Access-Control-Allow-Origin) in your <code class="docutils literal notranslate"><span class="pre">vars_&lt;project&gt;.yaml</span></code> file.</p>
<p>Add or modify the structure like that:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">headers</span><span class="p">:</span>
    <span class="o">&lt;</span><span class="n">service_name</span><span class="o">&gt;</span><span class="p">:</span>
        <span class="n">access_control_allow_origin</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;domain1&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;domain2&gt;&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
        <span class="n">access_control_max_age</span><span class="p">:</span> <span class="mi">3600</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">&quot;*&quot;</span></code> can be included in <code class="docutils literal notranslate"><span class="pre">access_control_allow_origin</span></code> to allow everybody to
access, but no credentials will be passed in the case.</p>
<p>Available services are:</p>
<p>Entry:</p>
<ul class="simple">
<li>index</li>
<li>config</li>
<li>api</li>
</ul>
<p>Services:</p>
<ul class="simple">
<li>themes</li>
<li>login</li>
<li>mapserver</li>
<li>print</li>
<li>profile</li>
<li>raster</li>
<li>layers</li>
<li>login</li>
<li>error</li>
</ul>
</div>
<div class="section" id="authorized-referrers">
<h2>Authorized referrers<a class="headerlink" href="#authorized-referrers" title="Permalink to this headline">¶</a></h2>
<p>To mitigate <a class="reference external" href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">CSRF</a>
attacks, the server validates the referer against a list of authorized referrers.</p>
<p>By default, only the pages coming from the server are allowed. You can change
that list by adding an <code class="docutils literal notranslate"><span class="pre">authorized_referers</span></code> list in your
<code class="docutils literal notranslate"><span class="pre">vars_&lt;project&gt;.yaml</span></code> file.</p>
<p>This solution is not the most secure (some people have browser extensions that
reset the referer), but that is the easiest to implement with all our different
JS frameworks.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/camptocamp.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Security</a><ul>
<li><a class="reference internal" href="#authentication">Authentication</a><ul>
<li><a class="reference internal" href="#the-default-policy">The default policy</a></li>
<li><a class="reference internal" href="#using-another-policy">Using another policy</a></li>
<li><a class="reference internal" href="#user-validation">User validation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#https">HTTPS</a><ul>
<li><a class="reference internal" href="#application-behind-a-proxy">Application behind a proxy</a></li>
<li><a class="reference internal" href="#application-and-ssl-certificate-on-the-same-server">Application and SSL certificate on the same server</a></li>
<li><a class="reference internal" href="#loading-non-https-external-resources">Loading non https external resources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reset-password">Reset password</a></li>
<li><a class="reference internal" href="#access-to-wms-getcapability">Access to WMS GetCapability</a></li>
<li><a class="reference internal" href="#access-to-the-admin-interface">Access to the admin interface</a></li>
<li><a class="reference internal" href="#access-to-the-ogc-proxy">Access to the OGC proxy</a></li>
<li><a class="reference internal" href="#access-to-services-by-external-servers">Access to services by external servers</a></li>
<li><a class="reference internal" href="#authorized-referrers">Authorized referrers</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Integrator Guide</a><ul>
      <li>Previous: <a href="customise.html" title="previous chapter">Customise the application</a></li>
      <li>Next: <a href="features.html" title="next chapter">Additional features</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/integrator/security.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2018, Camptocamp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/integrator/security.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/camptocamp/c2cgeoportal" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>