
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Application debugging &#8212; c2cgeoportal  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/c2c.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Transifex" href="transifex.html" />
    <link rel="prev" title="Server-side development" href="server_side.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="application-debugging">
<span id="developer-debugging"></span><h1>Application debugging<a class="headerlink" href="#application-debugging" title="Permalink to this headline">¶</a></h1>
<p>The goal of this document is to give some troubleshooting tips.</p>
<div class="section" id="browser">
<h2>Browser<a class="headerlink" href="#browser" title="Permalink to this headline">¶</a></h2>
<p>You can use the browser-integrated debugging tool, usually available with the <code class="docutils literal notranslate"><span class="pre">F12</span></code> key.</p>
</div>
<div class="section" id="sources-map">
<h2>Sources map<a class="headerlink" href="#sources-map" title="Permalink to this headline">¶</a></h2>
<p>For debugging purposes, it is better to have all the JavaScript and Style Sheets in separated, non-minified
files. To achieve this, you can use the sources maps, a function activable in the browsers debugging
tool.</p>
</div>
<div class="section" id="webpack">
<h2>Webpack<a class="headerlink" href="#webpack" title="Permalink to this headline">¶</a></h2>
<p>To have faster builds, you need to use the Webpack dev server; you can achieve this as follows.</p>
<p>In the file <code class="docutils literal notranslate"><span class="pre">geoportal/demo_geoportal/static-ngeo/js/apps/&lt;interface&gt;.html.ejs</span></code>,
remove the <code class="docutils literal notranslate"><span class="pre">ng-strict-di</span></code> in the <code class="docutils literal notranslate"><span class="pre">html</span></code> tag.</p>
<p>If it is not already done, copy the file <code class="docutils literal notranslate"><span class="pre">docker-compose.override.sample.yaml</span></code> to
<code class="docutils literal notranslate"><span class="pre">docker-compose.override.yaml</span></code>.
Be sure that the service <code class="docutils literal notranslate"><span class="pre">webpack_dev_server</span></code> is present and uncommented.</p>
<p>Restart your application as usual.</p>
<p>Open the application at the following URL: <code class="docutils literal notranslate"><span class="pre">https://172.17.0.1:8484/dev/&lt;interface&gt;.html</span></code>.</p>
</div>
<div class="section" id="pyramid-debugtoolbar">
<h2>Pyramid debugtoolbar<a class="headerlink" href="#pyramid-debugtoolbar" title="Permalink to this headline">¶</a></h2>
<p>If it is not already done, copy the file <code class="docutils literal notranslate"><span class="pre">docker-compose.override.sample.yaml</span></code> to
<code class="docutils literal notranslate"><span class="pre">docker-compose.override.yaml</span></code>.</p>
<p>Then the error is directly shown in the query that fails.</p>
<p>You can also open the debugtoolbar at <a class="reference external" href="https://172.17.0.1:8484/_debug_toolbar/">https://172.17.0.1:8484/_debug_toolbar/</a></p>
</div>
<div class="section" id="authentication">
<h2>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h2>
<p>For better security, the session cookie is accessible only via http protocol (meaning, not in JavaScript),
and is secure (meaning, the cookie is transmitted only in https requests, not in http requests).
For this reason, you should have your application running on https also in your development environment.</p>
<p>To achieve that, if it is not already done, copy the file <code class="docutils literal notranslate"><span class="pre">docker-compose.override.sample.yaml</span></code>
to <code class="docutils literal notranslate"><span class="pre">docker-compose.override.yaml</span></code>.</p>
<p>Then access the application on <a class="reference external" href="https://172.17.0.1:8484/">https://172.17.0.1:8484/</a>.</p>
</div>
<div class="section" id="mapserver">
<h2>Mapserver<a class="headerlink" href="#mapserver" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, more information can be obtained by using this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><style type="text/css">
span.prompt1:before {
  content: "$ ";
}
</style><span class="prompt1">docker-compose <span class="nb">exec</span> mapserver shp2img -m &lt;mapfile&gt; -o test.png -e &lt;minx&gt; &lt;miny&gt; &lt;maxx&gt; &lt;maxy&gt; <span class="se">\</span>
    -s &lt;sizex&gt; &lt;sizey&gt; -l &lt;layers&gt;</span>
</pre></div></div><p>You may also activate MapServer’s debug mode and set the environment variable <code class="docutils literal notranslate"><span class="pre">MS_DEBUGLEVEL</span></code>
of the MapServer container <code class="docutils literal notranslate"><span class="pre">MS_DEBUGLEVEL</span></code> to <code class="docutils literal notranslate"><span class="pre">5</span></code> (most verbose level, default is 0).</p>
<p><a class="reference external" href="https://mapserver.org/optimization/debugging.html?highlight=debug#debug-levels">More information</a></p>
</div>
<div class="section" id="postgresql">
<h2>PostgreSQL<a class="headerlink" href="#postgresql" title="Permalink to this headline">¶</a></h2>
<p>In the configuration file <code class="docutils literal notranslate"><span class="pre">/etc/postgresql/9.*/main/postgresql.conf</span></code>,
you can set <code class="docutils literal notranslate"><span class="pre">log_statement</span></code> to <code class="docutils literal notranslate"><span class="pre">all</span></code> to see all the called statements.
This file must be edited using the <code class="docutils literal notranslate"><span class="pre">postgres</span></code> user.</p>
<p>Reloading PostgreSQL is required so that the new configuration is taken into
account:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">sudo /etc/init.d/postgres reload</span>
</pre></div></div><p>Logs are available in the <code class="docutils literal notranslate"><span class="pre">/var/log/postgresql/postgresql-9.*-main.log</span></code> file.</p>
</div>
<div class="section" id="makefile">
<h2>Makefile<a class="headerlink" href="#makefile" title="Permalink to this headline">¶</a></h2>
<p>To obtain additional debug messages, you can rebuild your project as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">./docker-run --env<span class="o">=</span><span class="nv">DEBUG</span><span class="o">=</span>TRUE make ...</span>
</pre></div></div><p>This will add a message at the start of each rule with the list of files that required an update, e.-g.:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Build</span> <span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">c2ctemplate</span><span class="o">-</span><span class="n">cache</span><span class="o">.</span><span class="n">json</span> <span class="n">due</span> <span class="n">modification</span> <span class="n">on</span> <span class="nb">vars</span><span class="o">.</span><span class="n">yaml</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">sbrunner</span> <span class="n">geomapfish</span> <span class="mi">1321</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span> <span class="mi">16</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mf">20.845623078</span> <span class="o">+</span><span class="mi">0000</span> <span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">c2ctemplate</span><span class="o">-</span><span class="n">cache</span><span class="o">.</span><span class="n">json</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">sbrunner</span> <span class="n">geomapfish</span> <span class="mi">1299</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span> <span class="mi">08</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mf">35.707376156</span> <span class="o">+</span><span class="mi">0000</span> <span class="nb">vars</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</div>
<div class="section" id="docker-compose">
<h2>Docker-compose<a class="headerlink" href="#docker-compose" title="Permalink to this headline">¶</a></h2>
<div class="section" id="logs">
<h3>Logs<a class="headerlink" href="#logs" title="Permalink to this headline">¶</a></h3>
<p>With the following command, you can access the logs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">docker-compose logs <span class="o">[</span>&lt;service_name&gt;<span class="o">]</span></span>
</pre></div></div></div>
<div class="section" id="go-inside-a-container">
<h3>Go inside a container<a class="headerlink" href="#go-inside-a-container" title="Permalink to this headline">¶</a></h3>
<p>With the following command, you can get a terminal in a container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">docker-compose <span class="nb">exec</span> <span class="o">[</span>--user<span class="o">=</span>root<span class="o">]</span> &lt;service_name&gt; bash</span>
</pre></div></div></div>
<div class="section" id="multiple-dev-on-one-server">
<h3>Multiple dev on one server<a class="headerlink" href="#multiple-dev-on-one-server" title="Permalink to this headline">¶</a></h3>
<p>When you want to run multiple instances on the same server, you should:</p>
<ul class="simple">
<li>Use a different docker tag for each instance</li>
<li>Use a different project name for each instance</li>
</ul>
</div>
<div class="section" id="use-a-different-docker-tag">
<h3>Use a different docker tag<a class="headerlink" href="#use-a-different-docker-tag" title="Permalink to this headline">¶</a></h3>
<p>To use a different docker tag, define an environment variable in the build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1"><span class="nv">DOCKER_TAG</span><span class="o">=</span>&lt;tag&gt; ./docker-run make build</span>
</pre></div></div></div>
</div>
<div class="section" id="developing-in-python">
<h2>Developing in Python<a class="headerlink" href="#developing-in-python" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-a-development-docker-compose-override-yaml">
<h3>Create a development docker-compose.override.yaml<a class="headerlink" href="#create-a-development-docker-compose-override-yaml" title="Permalink to this headline">¶</a></h3>
<p>If it is not already done, copy the file <code class="docutils literal notranslate"><span class="pre">docker-compose.override.sample.yaml</span></code> to
<code class="docutils literal notranslate"><span class="pre">docker-compose.override.yaml</span></code>.</p>
<p>Be sure that the volume for the project is not commented.</p>
<p>You can also do a graceful restart of the running webserver (gunicorn in this case):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">docker-compose <span class="nb">exec</span> geoportal bash</span>
<span class="prompt1"><span class="nb">kill</span> -s HUP <span class="sb">`</span>ps aux<span class="p">|</span>grep gunicorn<span class="p">|</span>head --lines<span class="o">=</span><span class="m">1</span><span class="p">|</span>awk <span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>  <span class="c1"># graceful</span></span>
</pre></div></div><p>And finally, if you restart the container, you will see your modifications:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">docker-compose restart geoportal</span>
</pre></div></div></div>
<div class="section" id="working-on-c2cgeoportal-itself">
<h3>Working on c2cgeoportal itself<a class="headerlink" href="#working-on-c2cgeoportal-itself" title="Permalink to this headline">¶</a></h3>
<p>Clone and build c2cgeoportal, see <a class="reference internal" href="server_side.html#developer-server-side"><span class="std std-ref">Server-side development</span></a>.</p>
<p>If it is not already done, copy the file <code class="docutils literal notranslate"><span class="pre">docker-compose.override.sample.yaml</span></code> to
<code class="docutils literal notranslate"><span class="pre">docker-compose.override.yaml</span></code>.
Be sure that the volumes for c2cgeoportal are uncommented.</p>
</div>
</div>
<div class="section" id="access-to-a-hidden-service">
<h2>Access to a hidden service<a class="headerlink" href="#access-to-a-hidden-service" title="Permalink to this headline">¶</a></h2>
<p>Within the Docker composition, you can access a port of a container; you can achieve this via curl, e.-g.:</p>
<p>You can also expose a service out of the Docker composition. For that, add a port in your
<code class="docutils literal notranslate"><span class="pre">docker-compose.yaml</span></code>, e.g.:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">services</span><span class="p">:</span>
  <span class="o">&lt;</span><span class="n">service</span><span class="o">&gt;</span><span class="p">:</span>
    <span class="n">port</span><span class="p">:</span>
      <span class="o">-</span> <span class="mi">8086</span><span class="p">:</span><span class="mi">8080</span>
</pre></div>
</div>
<p>Be careful, one port can be open only one time on a server.</p>
</div>
<div class="section" id="use-a-specific-version-of-ngeo">
<h2>Use a specific version of ngeo<a class="headerlink" href="#use-a-specific-version-of-ngeo" title="Permalink to this headline">¶</a></h2>
<p>Clone ngeo and build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1"><span class="nb">cd</span> geoportal</span>
<span class="prompt1">git clone https://github.com/camptocamp/ngeo.git</span>
<span class="prompt1"><span class="nb">cd</span> ngeo</span>
<span class="prompt1">git check &lt;branch&gt;</span>
<span class="prompt1">npm install</span>
<span class="prompt1">npm prepublish</span>
<span class="prompt1"><span class="nb">cd</span> ../..</span>
</pre></div></div><p>Add the following alias in your <code class="docutils literal notranslate"><span class="pre">webpack.apps.js.mako</span></code> file:</p>
<div class="code js highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">resolve</span><span class="p">:</span> <span class="p">{</span>
   <span class="n">alias</span><span class="p">:</span> <span class="p">{</span>
     <span class="o">&lt;</span><span class="n">package</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
<span class="o">+</span>    <span class="n">ngeo</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">__dirname</span><span class="p">,</span> <span class="s1">&#39;ngeo/src&#39;</span><span class="p">),</span>
<span class="o">+</span>    <span class="n">gmf</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">__dirname</span><span class="p">,</span> <span class="s1">&#39;ngeo/contribs/gmf/src&#39;</span><span class="p">),</span>
   <span class="p">}</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>Force rebuild the application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="prompt1">./docker-run rm /build/apps.&lt;interface&gt;.timestamp</span>
<span class="prompt1">./docker-run make build</span>
</pre></div></div></div>
<div class="section" id="performance-or-network-error">
<h2>Performance or network error<a class="headerlink" href="#performance-or-network-error" title="Permalink to this headline">¶</a></h2>
<p>For performance and proxy issues, make sure that all internal URLs in the config file
use localhost (use <code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">&quot;http://localhost/&lt;path&gt;&quot;</span> <span class="pre">--header</span> <span class="pre">Host:&lt;server_name&gt;</span></code>
to test it).</p>
<div class="section" id="tilecloud-chain">
<h3>TileCloud chain<a class="headerlink" href="#tilecloud-chain" title="Permalink to this headline">¶</a></h3>
<p>Points to check with TileCloud chain:</p>
<ul class="simple">
<li>Disabling metatiles should be avoided.</li>
<li>Make sure that <code class="docutils literal notranslate"><span class="pre">empty_metatile_detection</span></code> and <code class="docutils literal notranslate"><span class="pre">empty_tile_detection</span></code> are configured correctly.</li>
<li>Make sure to not generate tiles with a resolution higher than the one in the raster sources.</li>
</ul>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/camptocamp.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">c2cgeoportal</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=camptocamp&repo=c2cgeoportal&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../administrator/index.html">Administrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integrator/index.html">Integrator Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Developer Guide</a><ul>
      <li>Previous: <a href="server_side.html" title="previous chapter">Server-side development</a></li>
      <li>Next: <a href="transifex.html" title="next chapter">Transifex</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2019, Camptocamp.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/developer/debugging.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/camptocamp/c2cgeoportal" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>